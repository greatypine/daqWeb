<!DOCTYPE HTML>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>国安侠分布图</title>
    <link rel="shortcut icon" type="image/x-icon" href="../icon.png" />
    <link rel="stylesheet" href="https://cache.amap.com/lbs/static/main1119.css"/>
    
      <!-- Bootstrap 3.3.6 -->
	  <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
	  <!-- Font Awesome -->
	  <link rel="stylesheet" href="bootstrap/css/font-awesome.min.css">
	  <!-- Ionicons -->
	  <link rel="stylesheet" href="bootstrap/css/ionicons.min.css">
	  <!-- Theme style -->
	  <link rel="stylesheet" href="dist/css/AdminLTE.min.css">
	  <!-- AdminLTE Skins. Choose a skin from the css/skins
	       folder instead of downloading all of them to reduce the load. -->
	  <link rel="stylesheet" href="dist/css/skins/_all-skins.min.css">
  	<link rel="stylesheet" href="plugins/bootstrp-datarangepicker/daterangepicker.css">
	<script type="text/javascript" src="https://webapi.amap.com/maps?v=1.4.4&key=f52a1bb11408e8a46dc884b2aaa44edc"></script>
    <style type="text/css">
      body {
          margin: 0;
          height: 100%;
          width: 100%;
          position: absolute;
          font-size: 12px;;
      }

      #mapContainer {
          position: absolute;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
      } 
      	.content-header{padding-top: 0;}
	    .form-group{line-height: 34px;}
	   	.form-group label{font-size: 12px; margin: 0; display: block; height: 30px;}
	   	
      .checkboxFive {width: 20px;position: relative; margin: 20px 20px 20px 0; padding-left: 10px;}
		.checkboxFive label {
		    width: 20px;
		    height: 20px;
		    cursor: pointer;
		    position: absolute;
		    top: -3px;
		    left: 0;
		    background: -moz-linear-gradient(top, #f4f4f4 0%, #f9f8f8 100%);
		    background: -webkit-linear-gradient(top, #f4f4f4 0%, #f9f8f8 100%);
		    background: linear-gradient(to bottom, #f4f4f4 0%, #f9f8f8 100%);
		    -moz-border-radius: 4px;
		    -webkit-border-radius: 4px;
		    border-radius: 4px;
		    -moz-box-shadow: inset 0px 1px 1px rgba(0, 0, 0, 0.5), 0px 1px 0px rgba(255, 255, 255, 0.4);
		    -webkit-box-shadow: inset 0px 1px 1px rgba(0, 0, 0, 0.5), 0px 1px 0px rgba(255, 255, 255, 0.4);
		    box-shadow: inset 0px 1px 1px rgba(0, 0, 0, 0.5), 0px 1px 0px rgba(255, 255, 255, 0.4);
		}
		.checkboxFive label:after {
		    content: '';
		    width: 12px;
		    height: 7px;
		    position: absolute;
		    top: 5px;
		    left: 4px;
		    border: 3px solid #5a5a5a;
		    border-top: none;
		    border-right: none;
		    background: transparent;
		    filter: progid:DXImageTransform.Microsoft.Alpha(Opacity=0);
		    opacity: 0;
		    -moz-transform: rotate(-45deg);
		    -ms-transform: rotate(-45deg);
		    -webkit-transform: rotate(-45deg);
		    transform: rotate(-45deg);
		}
		.checkboxFive label:hover::after {
		    filter: progid:DXImageTransform.Microsoft.Alpha(Opacity=30);
		    opacity: 0.3;
		}
		.checkboxFive input[type=checkbox] {
		    visibility: hidden;
		}
		.checkboxFive input[type=checkbox]:checked + label:after {
		    filter: progid:DXImageTransform.Microsoft.Alpha(enabled=false);
		    opacity: 1;
		}
     #process_div{ 
		background-color:#292a2b; 
		display:inline; 
		z-index:100000;  
		left:0px; 
		opacity:0.3; top:0; left:0;height:100%; width:100%; z-index:999; position:fixed; _position:absolute; _left: expression_r(documentElement.scrollLeft + documentElement.clientWidth - this.offsetWidth); _top: expression_r(documentElement.scrollTop + documentElement.clientHeight - this.offsetHeight);
		filter:Alpha(Opacity=30); 
		opacity: 0.3; 
	} 
	
	#process_div_pic{
		position:fixed;
		top:50%;
		left:50%; 
		z-index:100000000; 
		margin:-16px 0 0 -50px; 
		width:100px; 
		height:32px;
		color: #fff;
	}
	
	 	.info {
            border: solid 1px silver;
        }
        div.info-top {
            position: relative;
            background: none repeat scroll 0 0 #F9F9F9;
            border-bottom: 1px solid #CCC;
            border-radius: 5px 5px 0 0;
        }
        div.info-top div {
            display: inline-block;
            color: #333333;
            font-size: 14px;
            font-weight: bold;
            line-height: 31px;
            padding: 0 10px;
        }
        div.info-top img {
            position: absolute;
            top: 10px;
            right: 10px;
            transition-duration: 0.25s;
        }
        div.info-top img:hover {
            box-shadow: 0px 0px 5px #000;
        }
        div.info-middle {
            font-size: 12px;
            padding: 6px;
            line-height: 20px;
        }
        div.info-bottom {
            height: 0px;
            width: 100%;
            clear: both;
            text-align: center;
        }
        span {
            margin-left: 5px;
            font-size: 11px;
        }
        
        /*全屏按钮*/
        .pull-right-fullscreen {
        	position:absolute;
        	z-index:10;
        	right:20px;
        }
        /*全屏样式*/
	    #mask{width:100%; height:100%; position:fixed; top:0; left:0; display: none; z-index:9999999; background-color: rgba(0,0,0,0.7);}
	    #mask-body{ position: absolute; top: 50px; left: 50px; height: 600px; opacity: 1; z-index: 99; }
	    #mask-header{ position: absolute; top: 50px; left: 0px; height: 50px; opacity: 1; z-index: 999; }
	    #mask-header>button{ padding: 3px 5px;  position: absolute; left: 15px; top: -45px; cursor: pointer; }
	    
	    /*图例*/
	    .menu_1{position: absolute; top:30px;  right: 20px; width: 180px; background-color: #fff;}
		.legend_1{font-size: 15px; padding: 15px 0 0 15px;}
		.menu_list_1{ width: 180px; padding-top: 10px; box-shadow: 1px 2px 1px rgba(0,0,0,.15);-webkit-transition: all .3s ease-in-out;-o-transition: all .3s ease-in-out;transition: all .3s ease-in-out;padding-bottom:15px}
	
		.menu_list_1 li{line-height: 22px; font-size: 12px; padding-bottom: 10px;}
		.menu_list_1 li:nth-last-child(1){border: none;}
		.menu_list_1 li p:nth-child(1){padding-bottom: 2px; color: #333;}
		p{margin: 0;}
	    .menu_list_1 li a{color: #999; display: inline-block; width: 100%; text-decoration: none; padding-top: 5px;}
	
		.no-padding{padding: 0;}
	    /* .menu_list_1 .col-sm-3{ height: 15px;} */
		.menu_list_1 .col-sm-9 b{padding-left: 10px;}
     </style>  
</head>
<body>
<!-- Site wrapper -->
<div class="wrapper">
	<div id="mask" style="width: 100%;height:100%;z-index:120px">
	    <div id="mask-header"><button class="btn btn-primary">退出</button></div>
	    <div id="mask-body"></div>
  	</div>
  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
  <div id="process_div" ></div>
  <div id="process_div_pic" ><img style="width:50px;height: 50px;" src="dist/img/376884043677306248.png"><i class="fa fa-refresh fa-spin"></i></div>
    <div class="container">
      <!-- Main content -->

      <section class="content-header">
        <div class="box-header" style="padding:10px 0">
          <div class="form-group col-sm-2 no-padding">
            <label>城市</label>
            <select class="form-control select2" id="cityName">
              <!-- <option>北京</option> -->
            </select>
          </div>
          <div class="form-group col-sm-2">
            <label>门店</label>
            <select class="form-control select2" id="storeName">
              <!-- <option>北京</option> -->
            </select>
          </div>
          <div class="form-group col-sm-2">
            <label style="overflow:hidden">国安侠<span style="color:#a9a9a9;float:right;font-size:12px;" id="employeeonline"></span></label>
              <select class="form-control select2" id="employee">
              </select>
          </div>
          <div class="form-group col-sm-2">
            <label style="overflow:hidden">时间段<span style="color:#a9a9a9;float:right;font-size:12px;"></span></label>
              <select class="form-control select2" id="datatype">
              		<option value="realtime">实时分布</option>
                    <option value="history">历史轨迹</option>
              </select>
          </div>
          <div class="form-group col-sm-3 no-padding" id="datetime">
            <label>时间</label>
            <div class="input-group" id="time">
              <div class="input-group-addon">
                <i class="fa fa-calendar"></i>
              </div>
                 <input type="text" class="form-control pull-right" id="auto_date"  placeholder="点击选择日期" readonly="readonly">
            </div>
          </div>
          <div class="form-group col-sm-1">
            <label></label>
            <button type="button" class="btn btn-block btn-primary btn-sm" onclick="showEmployeeRecode()">查看</button>
          </div>
        </div>
        
        <span class="pull-right-fullscreen" onclick="fullscreen();">
         	<img src="dist/img/fullscreen.png">
         </span>
         <input id="fscreen" hidden="hidden">
        <div class="box-body" style="position:relative" id="mapHeight">

          <div id="mapContainer" style="background-color:rgba(0,0,0,0.5)"></div>
          <div class="menu_1">
			   <div class="legend_1"><b>图例：</b></div>
			   <div class="menu_list_1 clearfix">
				   <ul  id="imgExample" class="no-padding">
				   		<li id="store">
						   <div class="col-sm-3" id="storeimg" style="display:none;width:50px;"><img style="width:100%;" src="dist/img/storelogo.png"></div>
						   <div class="col-sm-3" id="cityimg" style="width:45px;"><img style="width:100%;" src="dist/img/splogo.png"></div>
						   <div class="col-sm-9" style="width:60%">
							   <p>门店 </p>
						   </div>
					   </li>
					   <li id="online">
						   <div class="col-sm-3"><img src="dist/img/gaxlogo.png"></div>
						   <div class="col-sm-9">
							   <p id="onlinetext">在线国安侠</p>
						   </div>
					   </li>
					   <li id="offline" style="display:none">
						   <div class="col-sm-3"><img src="dist/img/exceptiongaxlogo.png"></div>
						   <div class="col-sm-9">
							   <p>已下线国安侠</p>
						   </div>
					   </li>
					   <li id="offservice" style="display:none">
						   <div class="col-sm-3"><img src="dist/img/offservicegaxlogo.png"></div>
						   <div class="col-sm-9">
							   <p>服务范围外国安侠</p>
						   </div>
					   </li>
				   </ul>
			   </div>
			   <div></div>
		   </div>
	    <div class='button-group' id="example"  style="background-color: #fff;box-shadow: 1px 2px 1px rgba(0,0,0,.15);border-radius: 2px; padding: 7px 10px 10px 10px;">
		    <span class="checkboxFive">
		        <input type='checkbox' id="driveClick" onclick='employeeDrive()' name='bg'>国安侠行驶路线
		        <label for="driveClick"></label>
		    </span>
		</div>
        </div>

</section>

    </div>
  </div>
  <!-- /.content-wrapper -->


</div>
<!-- ./wrapper -->
     
<!-- jQuery 2.2.0 -->
<script src="../crm/plugins/jQuery/jQuery-2.2.0.min.js"></script>
<!-- Bootstrap 3.3.6 -->
<script src="../crm/bootstrap/js/bootstrap.min.js"></script>
<!-- Morris.js charts -->
<script src="../crm/bootstrap/js/raphael-min.js"></script>
<!-- FastClick -->
<script src="../crm/plugins/fastclick/fastclick.js"></script>
<!-- AdminLTE App -->
<script src="../crm/dist/js/app.min.js"></script>
<!-- AdminLTE for demo purposes -->
<script src="../crm/dist/js/demo.js"></script>
<script type="text/javascript" src="../scripts/bidLibjsjquery3.0.js"></script>
<!-- bootstrap datepicker -->
<script type="text/javascript" src="plugins/bootstrp-datarangepicker/moment.min.js"></script>
<script src="plugins/bootstrp-datarangepicker/daterangepicker.js"></script>
<script type="text/javascript">
    autodivheight();
    function autodivheight(){ //函数：获取尺寸
        //获取浏览器窗口高度
        var winHeight=0;
        if (window.innerHeight)
            winHeight = window.innerHeight;
        else if ((document.body) && (document.body.clientHeight))
            winHeight = document.body.clientHeight;
        //通过深入Document内部对body进行检测，获取浏览器窗口高度
        if (document.documentElement && document.documentElement.clientHeight)
            winHeight = document.documentElement.clientHeight;
        //DIV高度为浏览器窗口的高度
        //document.getElementById("test").style.height= winHeight +"px";
        //DIV高度为浏览器窗口高度的一半
        document.getElementById("mapHeight").style.height= winHeight - 130 +"px";
    }
    window.onresize=autodivheight; //浏览器窗口发生变化时同时变化DIV高度
</script>
<script type="text/javascript">
//格式化日期格式
Date.prototype.format=function(fmt) {        
    var o = {        
    "M+" : this.getMonth()+1, //月份        
    "d+" : this.getDate(), //日        
    "h+" : this.getHours()%12 == 0 ? 12 : this.getHours()%12, //小时        
    "H+" : this.getHours(), //小时        
    "m+" : this.getMinutes(), //分        
    "s+" : this.getSeconds(), //秒        
    "q+" : Math.floor((this.getMonth()+3)/3), //季度        
    "S" : this.getMilliseconds() //毫秒        
    };        
    var week = {        
    "0" : "\u65e5",        
    "1" : "\u4e00",        
    "2" : "\u4e8c",        
    "3" : "\u4e09",        
    "4" : "\u56db",        
    "5" : "\u4e94",        
    "6" : "\u516d"       
    };        
    if(/(y+)/.test(fmt)){        
        fmt=fmt.replace(RegExp.$1, (this.getFullYear()+"").substr(4 - RegExp.$1.length));        
    }        
    if(/(E+)/.test(fmt)){        
        fmt=fmt.replace(RegExp.$1, ((RegExp.$1.length>1) ? (RegExp.$1.length>2 ? "\u661f\u671f" : "\u5468") : "")+week[this.getDay()+""]);        
    }        
    for(var k in o){        
        if(new RegExp("("+ k +")").test(fmt)){        
            fmt = fmt.replace(RegExp.$1, (RegExp.$1.length==1) ? (o[k]) : (("00"+ o[k]).substr((""+ o[k]).length)));        
        }        
    }        
    return fmt;        
} 

//设置全屏样式
$("#mask-header>button").click(function(){ 
	$("#mask").css('display',"none");
	document.getElementById("mapHeight").style.height= "600px";
	$("#mapHeight").removeAttr("style");
    $("#mapHeight").css({"position":"relative","top":"0px"});
    autodivheight();
	$("#fscreen").after($("#mapHeight"));
  
});
//debugger;
//获得参数
var cityId = decode64(getUrlParamByKey("c"));     /**城市ID*/
var cityName = decode64(getUrlParamByKey("cn")); /**城市名称*/
var employeeId = decode64(getUrlParamByKey("e")); /**员工编号*/
var target = decode64(getUrlParamByKey("t"));   /**1.城市；2.门店**/
var storeIdNo = decode64(getUrlParamByKey("id"));    /**门店编号*/
var type = decode64(getUrlParamByKey("ty")); /**查询类型*/
var employeeNo = decode64(getUrlParamByKey("eno")); /**国安侠编号**/
if(employeeNo == "null"){
	employeeNo = null;
}
var iscity;
var storeId;
var storeNo;
if(storeIdNo !="null"){
	storeId = storeIdNo.split(",")[0].trim();
	storeNo = storeIdNo.split(",")[1].trim();
	iscity = 2;
	$("#storeimg").show();
	$("#cityimg").hide();
}else{
	$("#storeimg").hide();
	$("#cityimg").show();
	iscity = 1;
}
var beginDate = decode64(getUrlParamByKey("be"));
var endDate = decode64(getUrlParamByKey("endti"));
//存放国安侠Id的数组
var employeeArray = new Array;
//存放国安侠所有信息的数组
var diverRecodeArray = new Array;
//请求参数对象
var requestInfoDto = {};
var getRequestParam = function(){
	if(target==1){
		if(storeIdNo.trim() == "null"){
			requestInfoDto = {//城市
			        cityId:cityId,
			        beginDate:beginDate,
			        endDate:endDate,
			        employeeNo:employeeNo
			}
		}else{
			requestInfoDto = {//城市
			        cityId:cityId,
			        storeId:storeId,
			        beginDate:beginDate,
			        endDate:endDate,
			        employeeNo:employeeNo
			}
		}
	}else if(target==2){//门店
		requestInfoDto = {
	        storeId:storeId,
	        beginDate:beginDate,
	        endDate:endDate,
	        employeeNo:employeeNo
	    }
	}
	return requestInfoDto;
}


//初始化地图对象，加载地图
var map = new AMap.Map("mapContainer", {
    resizeEnable : true,
    doubleClickZoom : false
});


map.plugin(["AMap.ToolBar"],function(){
    //加载工具条
    var toolBaropt = {
        offset :new AMap.Pixel(10,55),//相对于地图容器左上角的偏移量，正数代表向右下偏移。默认为AMap.Pixel(10,10)
        position : 'LT',//工具放置位置RT:右上角;
        ruler : true,//标尺键盘是否可见，默认为true
        noIpLocate : false,//定位失败后，是否开启IP定位，默认为false
        locate : true,//是否显示定位按钮，默认为false
        liteStyle : false,//是否使用精简模式，默认为false
        direction : true,//方向键盘是否可见，默认为true
        autoPosition : false,//是否自动定位，即地图初始化加载完成后，是否自动定位的用户所在地，在支持HTML5的浏览器中有效，默认为false
        useNative : false
    }
    var tool = new AMap.ToolBar(toolBaropt);
    map.addControl(tool);
});

$(function(){
	var firstDate = new Date();
 	firstDate.setDate(firstDate.getDate()-29);
    var curDate = new Date();
  	//设置最大日期
    var cDate = curDate.format('yyyy/MM/dd HH:mm');
  //设置最小日期
    var mdate = firstDate.format('yyyy/MM/dd')+" 00:00";
  	//设置时间插件
	$('#auto_date').daterangepicker({
		//singleDatePicker: true,
		"locale": {
	        "format": "YYYY/MM/DD HH:mm",
	        "separator": " - ",
	        "applyLabel": "确定",
	        "cancelLabel": "取消",
	        "fromLabel": "From",
	        "toLabel": "To",
	        "iscity":iscity
    	},
		timePicker: true,
		minDate: mdate,
    	maxDate: cDate,
		timePicker24Hour:true,
		});
  	if(beginDate != null &&　endDate != null){
  		$($("#datatype").children("option:last-child")).attr("selected","selected");
  		$('#auto_date').data('daterangepicker').setStartDate(beginDate);
  		$('#auto_date').data('daterangepicker').setEndDate(endDate);
  	}else{
  		$('#auto_date').data('daterangepicker').setStartDate(new Date().setDate(1));
  		$('#auto_date').data('daterangepicker').setEndDate(new Date());
  		
  	}
	requestInfoDto = getRequestParam();
	initcurruser();
	getPageContent(requestInfoDto);
	$("#cityName").change(function(){
		  changeStoreName();
	});
  	//选择门店名称改变时
  	$("#storeName").change(function(){
  		var isAll = $("#storeName option:selected").text() == "全部门店"?true:false;
  		daterangechange(isAll);
  		$("#employeeonline").html("");
  		if(!isAll){
  			getEmployee();
  			/* $("#employee").attr("disabled",false); */
  		}else{
  			$("#employee").empty();
  			$("#employee").append("<option value='null'>"+"全部国安侠"+"</option>");
  			/* $("#employee").attr("disabled",true); */
  		}
  	});
  	$("#employee").change(function(){
  		var employeeno = $("#employee").val();
  		if(employeeno != "null"){
  			getEmployeeStatus(employeeno);
  			
  		}else{
  			$("#employeeonline").html("");
  		}
  	});
  	$("#datatype").change(function(){
  		if($("#datatype").val() == "realtime"){
  			$("#datetime").hide();
  		}else if($("#datatype").val() == "history"){
  			$("#datetime").show();
  		}
  	});
  	$("#storeName option[value='del']").remove();
	
});


var getPageContent = function(requestInfoDto){
	$("#process_div").show();
	$("#process_div_pic").show();
	//debugger;
	//国安侠位置设置 1.获得国安侠实时位置；2.获得国安侠历史位置
	if(requestInfoDto.beginDate != null &&　requestInfoDto.endDate　!= null){
		$("#example").show();
		$("#datetime").show();
		$("#offline").show();
		$("#offservice").hide();
		$("#onlinetext").html("在线国安侠");
		//门店服务范围设置
		getStoreServiceAndPosition(requestInfoDto);
		getEmployeeDriverRecodeHistory(requestInfoDto);
	}else{
		$("#example").hide();
		$("#datetime").hide();
		$("#offline").hide();
		$("#offservice").show();
		$("#onlinetext").html("服务范围内国安侠");
		//门店服务范围设置
		getStoreServiceAndPosition(requestInfoDto);
		getEmployeeDriverRecodeRealtime(requestInfoDto);
	}
	$("#process_div").hide();
	$("#process_div_pic").hide();
	
	//setTimeout(dynamicDrawDriverRecode(),60000);
	/*setTimeout(function(){
		console.log(maxlocationIndex);
		 for(var z = 0; z < maxlocationIndex; z++){
			 (function(){
				 var x = z;
			 setTimeout(function (){
				 console.log(new Date());
					for(var i = 0; i < diverRecodeArray.length; i++){
						var empDiver = diverRecodeArray[i];
						var locations = empDiver.locations;
						var platformid = empDiver.platformid;
						var employeeId = empDiver.id;
						var online = empDiver.online;
						var length = locations.length;
						var locationIndex = empDiver.locationIndex;
						var marker = empDiver.marker;
						var polyline = empDiver.polyline;
						if(typeof(marker) != "undefined" && typeof(polyline) != "undefined"){
							if(length > locationIndex){
								empDiver.marker.setPosition(locations[locationIndex]);
								empDiver.polyline.getPath().push(locations[locationIndex]);
								empDiver.polyline.setPath(empDiver.polyline.getPath());
								if(empDiver.storearea != null && !empDiver.storearea.contains(locations[locationIndex])){
									empDiver.polyline.setOptions({"strokeColor":"#000"});
									empDiver.marker.setIcon('dist/img/offservicegaxlogo.png');
						   		}else{
						   			empDiver.polyline.setOptions({"strokeColor":"#f00"});
						   			empDiver.marker.setIcon('dist/img/gaxlogo.png');
						   		}
								empDiver.locationIndex++;
							}
						}
					}
					console.log(x);
					if(x == maxlocationIndex - 1){
					 	
						timeout= window.setInterval(refreshEmployeeRrcode,60000);
				 	}
				},z*500);
			 })();
		}
	},1000);*/

    var flag = true;
    var x= 0;
    var reatimeinterval = setInterval(function(){
        if(flag){
            x++;
            for(var i = 0; i < diverRecodeArray.length; i++){
                var empDiver = diverRecodeArray[i];
                var locations = empDiver.locations;
                var platformid = empDiver.platformid;
                var employeeId = empDiver.id;
                var online = empDiver.online;
                var length = locations.length;
                var locationIndex = empDiver.locationIndex;
                var marker = empDiver.marker;
                var polyline = empDiver.polyline;
                if(typeof(marker) != "undefined" && typeof(polyline) != "undefined"){
                    if(length > locationIndex){
                        empDiver.marker.setPosition(locations[locationIndex]);
                        empDiver.polyline.getPath().push(locations[locationIndex]);
                        empDiver.polyline.setPath(empDiver.polyline.getPath());
                        if(empDiver.storearea != null && !empDiver.storearea.contains(locations[locationIndex])){
                            empDiver.polyline.setOptions({"strokeColor":"#000"});
                            empDiver.marker.setIcon('dist/img/offservicegaxlogo.png');
                        }else{
                            empDiver.polyline.setOptions({"strokeColor":"#f00"});
                            empDiver.marker.setIcon('dist/img/gaxlogo.png');
                        }
                        empDiver.locationIndex++;
                    }
                }
            }
            if(x == maxlocationIndex - 1){
                flag = false;
                timeout= window.setInterval(refreshEmployeeRrcode,60000);
                window.clearInterval(reatimeinterval);
            }
        }
    },500);
}

function getEmployeeStatus(employeeno){
	doManager("GAXDriveRecodeManager", "getEmployeeStatus",[employeeno],function(data, textStatus, XMLHttpRequest) {
			if (data.result) {
				var statusData = JSON.parse(data.data);
				if(statusData.data == null){
					$("#employeeonline").html("无信息");
				}else{
					var status = statusData.data.online;
					if(status == 'online'){
						$("#employeeonline").html("在线");
					}else if(status == 'offline'){
						$("#employeeonline").html("已下线");
					}
				}
			}
	 },false);
}

//设置每10秒刷新一次国安侠位置
function refreshEmployeeRrcode(){
	doManager("GAXDriveRecodeManager", "getDynamicDriveRecode",[requestInfoDto], function(data, textStatus,XMLHttpRequest) {
       if(data.result){
			var jsonData = JSON.parse(data.data);
			var employeeArr = new Array;
		  	if(typeof(jsonData.diverRecode) != "undefined"){
		  		employeeArr = jsonData.diverRecode.data; 
		  	}
   		   	if(employeeArr != null && employeeArr.length > 0){
   			   var empIdArray = new Array();
   			   for(var x = 0; x < employeeArr.length; x++){
   					empIdArray.push(employeeArr[x].id);
   			   }
   			   for(var i = 0; i < employeeArr.length; i++){
					var empDiver = employeeArr[i];
					var locations = empDiver.locations;
       				var employeeNo = empDiver.employeeNo;
       				var employeeName = empDiver.employeeName;
       				var nameNo = empDiver.storeName;
       				var storeName = nameNo;
       				var employeeId = empDiver.id;
       				var platformid = empDiver.platformid;
					if($.inArray(employeeId, employeeArray) == -1){
						employeeArray.push(employeeId);
	   					if(serviceArray.length >0){
	   					 	for(var z = 0; z <serviceArray.length; z++){
	   							var storeService = serviceArray[z];
	   							if(storeService.platformid == platformid){
	   								 empDiver["storearea"]=storeService.servicePolygon;
	   								 break;
	   							}
	   							if(platformid == null || platformid.trim() == ""){
	   								 empDiver["storearea"] = null;
	   							}
	   						}
	   				 	}else{
	   					 	empDiver["storearea"]=storeServicePolygon;
	   				 	}
	   					if(empDiver.storearea !=null && !empDiver.storearea.contains(locations)){
	   						var diverPolyline = drawEmployeeDiverPolyline(locations,"offline");
	   						empDiver["polyline"] = diverPolyline;
	   						var marker =  drawEmployeePosition(locations,empDiver,"offservice")
	   						empDiver["marker"] = marker;
	   					}else if(empDiver.storearea !=null && empDiver.storearea.contains(locations)){
	   						var diverPolyline = drawEmployeeDiverPolyline(locations,"online");
	   						empDiver["polyline"] = diverPolyline;
	   						var marker =  drawEmployeePosition(locations,empDiver,"online")
	   						empDiver["marker"] = marker;
	   					}else{
	   						console.log("store service area is null !");
	   					}
        				diverRecodeArray.push(empDiver);
				   }else{
					   for(var j = diverRecodeArray.length-1; j >= 0; j--){
	   					   var employeeDrive = diverRecodeArray[j];
	   					   var empid = employeeDrive.id;
	   					   if($.inArray(empid, empIdArray) == -1){
	   							employeeArray.splice(jQuery.inArray(empid,employeeArray),1);
	   							var marker = employeeDrive.marker;
	   							var polyline = employeeDrive.polyline;
	   							if(typeof(marker) != "undefined"){
	   								map.remove(marker);
	   							}
	   							if(typeof(polyline) != "undefined"){
	   								map.remove(polyline);
	   							}
	   							diverRecodeArray.splice(j,1);
	   					   }else{ 
	   							if(employeeId == employeeDrive.id){
	   								var marker = employeeDrive.marker;
		   							var polyline = employeeDrive.polyline;
		   							if(typeof(marker) != "undefined" && typeof(polyline) != "undefined"){
		   								employeeDrive.marker.setPosition(locations);
		   								employeeDrive.polyline.getPath().push(locations);
				   						employeeDrive.polyline.setPath(employeeDrive.polyline.getPath());
				   						if(employeeDrive.storearea != null && !employeeDrive.storearea.contains(locations)){
				   							employeeDrive.polyline.setOptions({"strokeColor":"#000"});
				   							employeeDrive.marker.setIcon('dist/img/offservicegaxlogo.png');
									   	}else{
										  	employeeDrive.polyline.setOptions({"strokeColor":"#f00"});
				   							employeeDrive.marker.setIcon('dist/img/gaxlogo.png');
									   	}
				   						break ;
		   							}
		   					   }
	   					   }
	   				   }
				   }
				}
   		   }else{
   			   for(var j = diverRecodeArray.length-1; j >= 0; j--){
  					   	var employeeDrive = diverRecodeArray[j];
					employeeArray.splice(jQuery.inArray(empid,employeeArray),1);
					var marker = employeeDrive.marker;
					var polyline = employeeDrive.polyline;
					if(typeof(marker) != "undefined"){
						map.remove(marker);
					}
					if(typeof(polyline) != "undefined"){
						map.remove(polyline);
					}
					diverRecodeArray.splice(j,1);
  				   }
   		   }
       }else{
       		crm_alert(0,"数据加载异常！");
       } 
   });
}


//门店服务范围数组
var serviceArray = new Array();
//单个门店时，门店服务范围
var storeServicePolygon;
//获取门店服务范围
var getStoreServiceAndPosition = function(requestInfoDto){
	doManager("GAXDriveRecodeManager", "getStoreServiceAreaAndPosition",[requestInfoDto], function(data, textStatus,XMLHttpRequest) {
		if(data.result){
        	var jsonData = JSON.parse(data.data);
        	if(storeIdNo.trim() == "null"){//城市
        		map.setCity(cityName);
        		serviceArray = jsonData.serviceArea;
               	for(var i=0;i<serviceArray.length;i++){
               		var polygonArray = serviceArray[i];
               		var servicePolygon =  drawStoreService(polygonArray.storeServiceArea);
             			polygonArray["servicePolygon"] = servicePolygon;
               	}
               	//debugger;
               	var positionArray = jsonData.position;
               	for(var j=0;j<positionArray.length;j++){
          				drawStorePosition(positionArray[j].position,positionArray[j].storeName);
               	}
        	}else{//门店
	        	var serviceArea = jsonData.serviceArea;
        		if(serviceArea.code == 200){
        			storeServicePolygon =  drawStoreService(serviceArea.serviceArea);
        			map.setZoom(14);
          			map.setCenter(storeServicePolygon.getBounds().getCenter());
          			drawStorePosition(serviceArea.position,null); 
                }else if(serviceArea.code == 9000003){
                	crm_alert(0,"门店服务范围不存在！");
                }
        	}
        }else{
        	crm_alert(0,"门店数据加载异常！");
        }
    },false);
}

//画门店服务员范围
var drawStoreService = function(storePath){
	var servicePolygon = new AMap.Polygon({
		   path:storePath,
	       strokeColor: "#5c69cc", //线颜色
	       strokeOpacity: 0.9, //线透明度
	       strokeWeight: 2,    //线宽
	       fillColor: "#046ad3", //填充色
	       fillOpacity: 0.2//填充透明度
	 	});
	servicePolygon.setMap(map);
	return servicePolygon;
}

//画门店坐标位置
var drawStorePosition = function(storePosition,storeName){
	if(storeName != null){
		var marker = new AMap.Marker({
			map:map,
	        icon: "dist/img/splogo.png",
	        offset: new AMap.Pixel(-10, -10),
	        //content:'<div style="width:40px"><img  style="width:100%" src="dist/img/storelogo.png"></div>',
		    position: storePosition,
		    
		}); 
		marker.setExtData({"storeName":storeName});
		marker.on("mouseover",function(e){
			var storeName = e.target.getExtData().storeName;           		
			e.target.setTitle(storeName);
		});
		$("#storeimg").hide();
		$("#cityimg").show();
	}else{
		var marker = new AMap.Marker({
			map:map,
	        //icon: "dist/img/splogo.png",
	        offset: new AMap.Pixel(-10, -10),
	        content:'<div style="width:40px"><img  style="width:100%" src="dist/img/storelogo.png"></div>',
		    position: storePosition,
		    
		});
		$("#storeimg").show();
		$("#cityimg").hide();
	}
	
}
//画国安侠线路图
var drawEmployeeDiverPolyline = function(diverLocations,online){
	var diverPolyline  = null;
	if(online == 'online'){
		diverPolyline = new AMap.Polyline({
	        path: diverLocations,          //设置线覆盖物路径
	        strokeColor: "#f00", //线颜色
	        strokeOpacity: 0.8,       //线透明度
	        strokeWeight: 0.8,        //线宽
	        strokeStyle: "solid"   //线样式
	    });
		diverPolyline.setMap(map);
	}else if(online == 'offline'){
		diverPolyline = new AMap.Polyline({
	        path: diverLocations,          //设置线覆盖物路径
	        strokeColor: "#000", //线颜色
	        strokeOpacity: 0.8,       //线透明度
	        strokeWeight: 0.8,        //线宽
	        strokeStyle: "solid"   //线样式
	    });
		diverPolyline.setMap(map);
	}else{
		console.log("polyline:employee online status is error!employee status is "+online);
	}
	return diverPolyline;
}

//画国安侠坐标位置
var drawEmployeePosition = function(diverLocations,employeeInfo,online){
	var marker  = null;
	if(online == 'online'){
		marker = new AMap.Marker({
			 map:map,
			 icon:"dist/img/gaxlogo.png",
			 position: diverLocations,
			 offset: new AMap.Pixel(-10, -20),
			 extData:{
				 "storeName":employeeInfo.storeName,
				 "employeeName":employeeInfo.employeeName,
				 "employeeNo":employeeInfo.employeeNo
			 }
		 });
	}else if(online == 'offline'){
		marker = new AMap.Marker({
			 map:map,
			 icon:"dist/img/exceptiongaxlogo.png",
			 position: diverLocations,
			 offset: new AMap.Pixel(-10, -20),
			 extData:{
				 "storeName":employeeInfo.storeName,
				 "employeeName":employeeInfo.employeeName,
				 "employeeNo":employeeInfo.employeeNo
			 }
		 });
	}else if(online == 'offservice'){
		marker = new AMap.Marker({
			 map:map,
			 icon:"dist/img/offservicegaxlogo.png",
			 position: diverLocations,
			 offset: new AMap.Pixel(-10, -20),
			 extData:{
				 "storeName":employeeInfo.storeName,
				 "employeeName":employeeInfo.employeeName,
				 "employeeNo":employeeInfo.employeeNo
			 }
		 });
	}else{
		console.log("marker:employee online status is error!employee status is "+online);
	}
	if(marker != null){
		marker.on("mouseover",function(e){
			 //实例化信息窗体
			    var title = '门店名称：'+e.target.getExtData().storeName,
			        content = [];
			    content.push("员工姓名："+e.target.getExtData().employeeName);
			    var empno = e.target.getExtData().employeeNo;
			    if(typeof(empno) == "undefined"){
			    	content.push("员工编号："+"暂无");
			    }else{
			    	content.push("员工编号："+e.target.getExtData().employeeNo);
			    }
			    var infoWindow = new AMap.InfoWindow({
			        isCustom: true,  //使用自定义窗体
			        content: createInfoWindow(title, content.join("<br/>")),
			        offset: new AMap.Pixel(16, -45)
			    });
			 	infoWindow.open(map, e.target.getPosition());
		 })
		 marker.on("mouseout",function(e){
			 closeInfoWindow();
		 });
	}
	return marker;
}

function getEmployeeDriverRecodeHistory(){
	employeeArray.splice(0,employeeArray.length);
	diverRecodeArray.splice(0,diverRecodeArray.length);
	doManager("GAXDriveRecodeManager", "getDriveRecode",[requestInfoDto], function(data, textStatus,XMLHttpRequest) {
		//debugger;
		if(data.result){
        	var jsonData = JSON.parse(data.data);
    		var diverRecode = jsonData.diverRecode;
    		if(typeof(diverRecode.data) != "undefined"){
    			diverRecodeArray = diverRecode.data; 
    		}
    		if(diverRecodeArray != null && diverRecodeArray.length > 0){
    			var diverPolyline;
    			var marker;
    			for(var i = 0; i < diverRecodeArray.length; i++){
    				var empDiver = diverRecodeArray[i];
    				var locations = empDiver.locations;
    				var platformid = empDiver.platformid;
    				var employeeId = empDiver.id;
    				var online = empDiver.online;
    				employeeArray.push(employeeId);
    				var diverPolyline =  drawEmployeeDiverPolyline(locations,online);
    				empDiver["polyline"] = diverPolyline;
    				  if(!$("#driveClick").is(':checked')){
    					 diverPolyline.hide();
    				 } 
    				 var marker =  drawEmployeePosition(locations[locations.length-1],empDiver,online);
    				 empDiver["marker"] = marker;
    			}
    		}
        }else{
        	crm_alert(0,"数据加载异常！");
        }
    },false);
}

var timeout;
var maxlocationIndex = 0;
function getEmployeeDriverRecodeRealtime(){
	employeeArray.splice(0,employeeArray.length);
	requestInfoDto["beginDate"] = new Date().format('yyyy/MM/dd')+" 00:00";
	requestInfoDto["endDate"] = new Date().format('yyyy/MM/dd HH:mm');
	//requestInfoDto["beginDate"] = "2017/12/18 00:00";
	//requestInfoDto["endDate"] = '2017/12/18 23:00';
	requestInfoDto["isRealtime"] = "realtime";
	doManager("GAXDriveRecodeManager", "getDriveRecode",[requestInfoDto], function(data, textStatus,XMLHttpRequest) {
		//debugger;
		if(data.result){
        	var jsonData = JSON.parse(data.data);
    		var diverRecode = jsonData.diverRecode;
    		if(typeof(diverRecode.data) != "undefined"){
    			diverRecodeArray = diverRecode.data; 
    		}
    		if(diverRecodeArray != null && diverRecodeArray.length > 0){
    			var diverPolyline;
    			var marker;
    			for(var i = 0; i < diverRecodeArray.length; i++){
    				var empDiver = diverRecodeArray[i];
    				var locations = empDiver.locations;
    				var platformid = empDiver.platformid;
    				var employeeId = empDiver.id;
    				var online = empDiver.online;
    				var length = locations.length;
    				if(maxlocationIndex < length){
    					maxlocationIndex = length;
    				}
    				employeeArray.push(employeeId);
    				if(serviceArray.length>0){
   						for(var j = 0; j <serviceArray.length; j++){
   							var locationIndex = 0;
   							var storeService = serviceArray[j];
   							if(storeService.platformid == platformid){
   								 empDiver["storearea"]=storeService.servicePolygon;
   								if(!empDiver.storearea.contains(locations[locationIndex])){
   									var diverPolyline =  drawEmployeeDiverPolyline(locations[locationIndex],"offline");
   		        				 	empDiver["polyline"] = diverPolyline;
   		        				 	var marker = drawEmployeePosition(locations[locationIndex],empDiver,"offservice");
            						empDiver["marker"] = marker;
            						locationIndex++;
            						empDiver["locationIndex"] = locationIndex;
   								}else{
   									var diverPolyline =  drawEmployeeDiverPolyline(locations[locationIndex],"online");
   		        				 	empDiver["polyline"] = diverPolyline;
   		        				 	var marker = drawEmployeePosition(locations[locationIndex],empDiver,"online");
            						empDiver["marker"] = marker;
            						locationIndex++;
            						empDiver["locationIndex"] = locationIndex;
   								}
   								 break;
   							}
   							if(platformid == null || platformid.trim() == ""){
   								empDiver["storearea"] = null;
   							}
   						}
    				}else{
    					var locationIndex = 0;
    					empDiver["storearea"]= storeServicePolygon;
    					if(!empDiver.storearea.contains(locations[locationIndex])){
    						var diverPolyline =  drawEmployeeDiverPolyline(locations[locationIndex],"offline");
	        				empDiver["polyline"] = diverPolyline;
	        				var marker = drawEmployeePosition(locations[locationIndex],empDiver,"offservice");
    						empDiver["marker"] = marker;
    						locationIndex++;
    						empDiver["locationIndex"] = locationIndex;
						}else{
							var diverPolyline =  drawEmployeeDiverPolyline(locations[locationIndex],"online");
	        				empDiver["polyline"] = diverPolyline;
	        				var marker = drawEmployeePosition(locations[locationIndex],empDiver,"online");
    						empDiver["marker"] = marker;
    						locationIndex++;
    						empDiver["locationIndex"] = locationIndex;
						}
    				}
    			}
    		}
        }else{
        	crm_alert(0,"数据加载异常！");
        }
    },false);
}

 

var curr_user;
function initcurruser(){
		//取得当前登录人的门店
	doManager("UserManager", "getCurrentUserDTO",null,function(data, textStatus, XMLHttpRequest) {
		if (data.result) {
			var employeeID="";
			curr_user = JSON.parse(data.data);
			$("#employee_no").html(curr_user.employeeId);
			$('span[class="hidden-xs"]').html(curr_user.name);
			$("#card_name").html(curr_user.name);
			if(curr_user.employeeId==null||curr_user.employeeId=="null"){
				employeeID = "";
			}else{
				employeeID = curr_user.employeeId;
			}
			getCityName();
			changeStoreName();
			 $("#card_no").html(curr_user.zw+" "+employeeID);
		}
  	},false);
}


function employeeDrive(){ 
	var length = diverRecodeArray.length;
	if($("#driveClick").is(':checked')){
		for(var i = 0; i < length; i++){
			diverRecodeArray[i].polyline.show();
		}
	}else{
		for(var i = 0; i < length; i++){
			diverRecodeArray[i].polyline.hide();
		}
	}
}

//构建自定义信息窗体
function createInfoWindow(title, content) {
    var info = document.createElement("div");
    info.className = "info";

    //可以通过下面的方式修改自定义窗体的宽高
    //info.style.width = "400px";
    // 定义顶部标题
    var top = document.createElement("div");
    var titleD = document.createElement("div");
    var closeX = document.createElement("img");
    top.className = "info-top";
    titleD.innerHTML = title;
    closeX.src = "https://webapi.amap.com/images/close2.gif";
    closeX.onclick = closeInfoWindow;

    top.appendChild(titleD);
    top.appendChild(closeX);
    info.appendChild(top);

    // 定义中部内容
    var middle = document.createElement("div");
    middle.className = "info-middle";
    middle.style.backgroundColor = 'white';
    middle.innerHTML = content;
    info.appendChild(middle);

    // 定义底部内容
    var bottom = document.createElement("div");
    bottom.className = "info-bottom";
    bottom.style.position = 'relative';
    bottom.style.top = '0px';
    bottom.style.margin = '0 auto';
    var sharp = document.createElement("img");
    sharp.src = "https://webapi.amap.com/images/sharp.png";
    bottom.appendChild(sharp);
    info.appendChild(bottom);
    return info;
}

//关闭信息窗体
function closeInfoWindow() {
    map.clearInfoWindow();
}


//门店发生改变时时间的改变
function daterangechange(isAll){
	if(isAll){
	  	var date = new Date();
  		var bdate = date.format('yyyy/MM/dd');
  		var cDate = date.format('yyyy/MM/dd HH:mm');
  		bdate = bdate + " 00:00";
  		$('#auto_date').data('daterangepicker').setStartDate(bdate);
  		$('#auto_date').data('daterangepicker').setEndDate(cDate);
  		$('#auto_date').data('daterangepicker').setLocale(1);
  	}else{
	  	$('#auto_date').data('daterangepicker').setLocale(2);
  	}
}

//城市发生改变时重新加载门店
function changeStoreName(){
	var regex_cs = new RegExp("^(CS|cs)\w*");//城市级别
	var regex_zb = new RegExp("^(ZB|zb)\w*");//城市级别
	 var regex_yw = new RegExp("^(YW|yw)\w*");
    if(regex_cs.test(curr_user.usergroup.code) || regex_yw.test(curr_user.usergroup.code)){
		target = 1;
		var options=$("#cityName option:selected");
		var cityId = options.val();
		getStoreName(curr_user,cityId);
	}else if(regex_zb.test(curr_user.usergroup.code)){
		target = 1;
		var options=$("#cityName option:selected");
		var cityId = options.val();
		getStoreName(curr_user,cityId);
	}else if(curr_user.usergroup.code == "QYJLJSZ"){
		target = 1;
		getStoreName(curr_user,null);
	}else{
		target = 2;
		getStoreName(curr_user,null);
	}
}

//获得当前用户所在及所管理的城市
function getCityName(){
	doManager("UserManager", "getCurrentUserCity",null,function(data, textStatus, XMLHttpRequest) {
		if (data.result) {
			var citylist= JSON.parse(data.data);
			if(citylist.length == 0){
				crm_alert(0,"该账号未分配城市！");
				$("#cityName").attr("disabled",true);
				return;
			}
			//var real_current_city = init_city_id==null?cityinfo.city:"";
			var citylistLength = citylist.length;
			if(citylistLength == 0){
				$("#cityName").attr("disabled",true);
			}
			if(citylistLength == 1){
				var cityName = citylist[0].cityname==null?"":citylist[0].cityname;
				var cityid = citylist[0].cityid;
				$("#cityName").append("<option value='"+cityid+"'>"+cityName+"</option>");
				$("#cityName").attr("disabled",true);
			}
			if(citylistLength > 1){
				for(var i = 0; i<citylistLength; i++){
					var cityInfo = citylist[i];
					var cityName = cityInfo.cityname;
					var cityid = cityInfo.cityid;
					$("#cityName").append("<option value='"+cityid+"'>"+cityName+"</option>");
					if(cityid == cityId){
						$($("#cityName").find("option")[i]).attr("selected","selected");
					}
				}
			}
		}
	},false);   
}
//获得城市下的所有门店  
function getStoreName(curr_user,cityId){
	doManager("StoreManager", "findStoreByCurUser",[curr_user,cityId],function(data, textStatus, XMLHttpRequest) {
		if (data.result) {
			var storeList= JSON.parse(data.data);
			$("#storeName").empty();
			if(storeList.length == 0){
				crm_alert(0,"该账号未分配门店！");
				$("#storeName").attr("disabled",true);
				return;
			}
			if(storeList.length == 1){
				var storeName = storeList[0].name;
				var storeid = storeList[0].store_id;
				var storeno = storeList[0].storeno;
				$("#storeName").append("<option value='"+storeid+","+storeno+"'>"+storeName+"</option>");
				$("#storeName").attr("disabled",true);
			}
			if(storeList.length > 1){
				if(target == 1){
					$("#storeName").append("<option value='null'>"+"全部门店"+"</option>");
					if(storeIdNo.trim() == "null"){
						$($("#storeName").children("option:first-child")).attr("selected","selected");
					}
					for(var i = 0; i< storeList.length; i++){
						var store =  storeList[i];
						var storeName = store.name;
						var storeid = store.store_id;
						var storeno = storeList[i].storeno;
						if(storeid != 9900228 && storeno != "0021Y0020"){
							$("#storeName").append("<option value='"+storeid+","+storeno+"'>"+storeName+"</option>");
							if(storeid == storeId){
								$($("#storeName").find("option")[i+1]).attr("selected","selected");
							}
						}else{
							$("#storeName").append("<option value='del'></option>");
						}
						
					}
				}else{
					for(var i = 0; i< storeList.length; i++){
						var store =  storeList[i];
						var storeName = store.name;
						var storeid = store.store_id;
						var storeno = storeList[i].storeno;
						if(storeid != 9900228 && storeno != "0021Y0020"){
							$("#storeName").append("<option value='"+storeid+","+storeno+"'>"+storeName+"</option>");
							if(storeid == storeId){
								$($("#storeName").find("option")[i]).attr("selected","selected");
							}
						}else{
							$("#storeName").append("<option value='del'></option>");
						}
						
					}
				}
			}
		}
		getEmployee();
	},false);
}

//获得当前门店下的所有国安侠
function getEmployee(){
	var storeIdNo = $("#storeName").val();
	if(storeIdNo == "null"){
		$("#employee").empty();
		$("#employee").append("<option value='null'>"+"全部国安侠"+"</option>");
		$("#employee").attr("disabled",true);
		return ;
	}
	if(typeof(storeIdNo) != "undefined"){
		$("#employee").empty();
		$("#employee").attr("disabled",false);
		storeId = storeIdNo.split(",")[0].trim();
		doManager("HumanresourcesManager", "queryHumanresourceGAXListByStoreId",[storeId],function(data, textStatus, XMLHttpRequest) {
			if (data.result) {
				var employeeList= JSON.parse(data.data);
				if(employeeList != null && employeeList.length>0){
					for(var i = 0; i < employeeList.length; i++){
						var employee = employeeList[i];
						var employeeName = employee.name;
						var employeeno = employee.employee_no;
						if(i == 0){
							$("#employee").append("<option value='null'>"+"全部国安侠"+"</option>");
							/* if(employeeNo == null){
								$($("#employee").children("option:frist-child")).attr("selected","selected");
							} */
						}
						$("#employee").append("<option value='"+employeeno+"'>"+employeeName+"</option>");
						if(employeeno == employeeNo){
							$($("#employee").find("option")[i+1]).attr("selected","selected");
							getEmployeeStatus(employeeno);
						}
					}
				}else{
					$("#employee").append("<option value='null'>"+"暂无"+"</option>");
				}
			}
		},false);
	}
}

function showEmployeeRecode(){
	window.clearInterval(timeout);
	var cityoptions=$("#cityName option:selected");
	cityId = cityoptions.val();
	cityName = cityoptions.text();
	var storeoptions = $("#storeName option:selected");
	storeName =  storeoptions.text();
	if(storeoptions.text() != "全部门店"){
		storeIdNo = storeoptions.val();
		storeId = storeIdNo.split(",")[0];
		storeNo = storeIdNo.split(",")[1];
	}else{
		storeIdNo = "null";
		storeId = null;
	}
	employeeNo = $("#employee").val();
	if(employeeNo == "null"){
		employeeNo = null;
	}
	if($("#datatype").val() == "realtime"){
		beginDate = null;
		endDate = null;
	}else if($("#datatype").val() == "history"){
		var date = $("#auto_date").val();
	   	beginDate = date.split("-")[0];
	   	endDate = date.split("-")[1];
	}
   	requestInfoDto = getRequestParam();
   	serviceArray.splice(0,serviceArray.length);
   	$("#driveClick").prop("checked",false);
   	map.clearMap();
   	getPageContent(requestInfoDto);
	
}

function automaxheight(){ //函数：获取尺寸
    //获取浏览器窗口高度
    var winHeight=0;
    var winWidth=0;
    if (window.innerHeight){
        winHeight = window.innerHeight;
        winWidth= window.innerWidth;}
    else if ((document.body) && (document.body.clientHeight)){
        winHeight = document.body.clientHeight;
        winWidth = document.body.clientWidth;}
    //通过深入Document内部对body进行检测，获取浏览器窗口高度
    else if (document.documentElement && document.documentElement.clientHeight){
        winHeight = document.documentElement.clientHeight;
        winWidth = document.documentElement.clientWidth;}
    //DIV高度为浏览器窗口的高度
    //document.getElementById("test").style.height= winHeight +"px";
    //DIV高度为浏览器窗口高度的一半
    document.getElementById("mapHeight").style.height= winHeight+"px";
    document.getElementById("mapHeight").style.width= winWidth+"px";
    $("#mask-body").css({"top":"0px"});
    $("#mask-body").css({"left":"0px"});
    $("#mapContainer").css({"border-radius":"0"});
    
}	

function fullscreen(){
	automaxheight();
    $("#mask").css("display","block");
   	$("#mapHeight").show();
   	var copyMap = $("#mapHeight");
   	$("#mask-body").html(copyMap);
}
</script>

</body>
</html>