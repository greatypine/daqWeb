<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>区域热力图</title>
  <!-- Tell the browser to be responsive to screen width -->
  <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
  <link rel="shortcut icon" type="image/x-icon" href="../icon.png" />
  <!-- Tell the browser to be responsive to screen width -->
  <meta content="width=device-width, initial-scale=0.3, maximum-scale=1, user-scalable=no" name="viewport">
  <!-- Bootstrap 3.3.6 -->
  <link rel="stylesheet" href="../crm/bootstrap/css/bootstrap.min.css">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="../crm/bootstrap/css/font-awesome.min.css">
  <!-- Ionicons -->
  <link rel="stylesheet" href="../crm/bootstrap/css/ionicons.min.css">
  <!-- Theme style -->
  <link rel="stylesheet" href="../crm/dist/css/AdminLTE.min.css">
  <!-- AdminLTE Skins. Choose a skin from the css/skins
       folder instead of downloading all of them to reduce the load. -->
  <link rel="stylesheet" href="../crm/dist/css/skins/_all-skins.min.css">
  <link rel="stylesheet" href="../crm/dist/css/tTurnover-head-scoll.css">
  <!--map style-->
  <link rel="stylesheet" href="../crm/dist/css/map-style.css">
  <link rel="stylesheet" href="../crm/dist/css/onoffset.css">
  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
  <script src="IE 9/html5shiv.min.js"></script>
  <script src="IE 9/respond.min.js"></script>
  <![endif]-->
  <style>
        .dl-horizontal dt{width: 100px;}
    .dl-horizontal dd{margin-left: 120px;}
    .box{width: 100%; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.6); background: none; color: #fff; height: 135px; overflow: hidden; z-index:90;position: absolute;}
    .box-header{color: #fff;}
   
    .text-muted h3{font-family: "Helvetica Neue",Helvetica,"PingFang SC","Hiragino Sans GB","Microsoft YaHei","微软雅黑",Arial,sans-serif; color: #fff; font-size: 16px; margin-bottom: 20px;}
    .box:hover{box-shadow: 0 2px 10px rgba(0, 0, 0, 0.6);min-height: 135px;height:auto;  background-color: #11214e;}
    /*
    .box{width: 100%; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.6); background: none; color: #fff; height: 140px; overflow: hidden; position: absolute; z-index: 90; margin-bottom: 0;}
	.box-header{color: #fff;}
	.box:hover{box-shadow: 0 2px 10px rgba(0, 0, 0, 0.6);min-height: 140px; height: auto; background-color: #11214e;}
	*/
    .navbar-custom-menu{margin-right: 20px;}
	.logo-lg img:nth-child(1){width: auto; height: 30px;margin-right: 10px;}
	.logo-lg img:nth-child(2){width: auto; height: 20px; margin-top: 5px;}
    .logo-lg > ul > li:hover > a{color: #46a3ff; font-weight: bold;}
    .logo-lg > ul > li:hover i{ transform: rotate(180deg); transition: all 0.3s linear; color: #46a3ff;}
     #mainprovinces div,#city_name{display: none;}
    .crumbs a{padding: 3px 10px; background-color: #3c8dbc; color: #fff; margin-right: 10px; border-radius: 5px;}
    .crumbs a:nth-last-child(3){background: none;}
    .crumbs span{ cursor: pointer;}
        
        /*全屏样式*/
    #mask{width:100%; height:100%; position:fixed; top:0; left:0; display: none; z-index:9999999; background-color: rgba(0,0,0,0.7);}
    /*#mask-body{ position: absolute; top: 50px; left: 50px; height: 600px; opacity: 1; z-index: 99; }
    #mask-header{ position: absolute; top: 50px; left: 0px; height: 50px; opacity: 1; z-index: 999; }
    #mask-header>button{ padding: 3px 5px;  position: absolute; left: 15px; top: -45px; cursor: pointer; }*/

    /*黑色背景*/
    body{background: url("dist/img/home-bg.jpg") no-repeat center;background-size: cover;}
    .content-wrapper,.skin-blue .wrapper{background: none;}
    .skin-blue .main-header .navbar{background-color: #11214e;}
    .nav_dropdown{background-color: #11214e;}
    .nav_dropm,.nav_mark_bg{background-color: #0f1937;}
    .nav-mark > a,.nav-mark > i,.sidebar_active > a,.sidebar_active > a >i{color: #46a3ff!important;}
    .skin-blue .main-header li.user-header{background-color: #11214e;}

	#process_div{ 
		background-color:#292a2b; 
		display:inline; 
		z-index:100000;  
		left:0px; 
		opacity:0.3; top:0; left:0;height:100%; width:100%; z-index:999; position:fixed; _position:absolute; _left: expression_r(documentElement.scrollLeft + documentElement.clientWidth - this.offsetWidth); _top: expression_r(documentElement.scrollTop + documentElement.clientHeight - this.offsetHeight);
		filter:Alpha(Opacity=30); 
		opacity: 0.3; 
	} 
	
	#process_div_pic{
		position:fixed;
		top:50%;
		left:50%; 
		z-index:100000000; 
		margin:-16px 0 0 -50px; 
		width:100px; 
		height:32px;
		color: #fff;
	}
    /*翻页效果*/
    /*翻页效果*/
    .dataStatistics{cursor: pointer; color: #fff; font-family: futura_mdcn_btmedium; text-align: center; font-size: 70px; position: relative;}
	.data_new{position: relative; float: left; left: 50%;}
	.digit_set{border: 1px solid #078dff; border-radius: 4px; perspective: 200px; height: 90px!important; margin: 0 5px!important; width: 57px!important; right: 50%;}
    .dataStatistics .digit > div.digit_top, .dataStatistics .digit > div.shadow_top{background-color: #11214e; border-radius: 4px;}
    .dataStatistics .digit > div.digit_bottom, .dataStatistics .digit > div.shadow_bottom{background-color: #11214e; border-radius: 4px; text-align: center;}
    .dataStatistics:hover .digit_set{box-shadow: 0 0 16px 2px #186ff0}
    .dataStatistics .digit > div.digit_bottom .digit_wrap, .dataStatistics .digit > div.shadow_bottom .digit_wrap{margin-top: -80%;}
    /*逗号*/
    .douhao{width: 16px; height: 21px; background: url("dist/img/douhao.png") no-repeat; float: left; position: relative; right: 50%;bottom: -70px;}
    #mapContainer {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
     }
     
     .menu{position: absolute; bottom: 10px;  right: 6px;min-width:150px; background-color: #fff;border-radius:4px}
	.legend{font-size: 14px; padding: 15px 0 0 15px;}
	.menu_list{ width: 150px; padding-top: 0px; box-shadow: 1px 2px 1px rgba(0,0,0,.15);-webkit-transition: all .3s ease-in-out;-o-transition: all .3s ease-in-out;transition: all .3s ease-in-out;}

	.menu_list li{
/* 	line-height: 22px;  */
	font-size: 6px; 
	padding-right:0;
/* 	padding-bottom: 10px; */
	}
	.menu_list li:nth-last-child(1){border: none;}
	/*.menu_list li span{color: #0a67f2; font-weight: bold; font-size: 16px; padding-right: 5px;}*/
	.menu_list li p:nth-child(1){padding-bottom: 2px; color: #333;}
	p{margin: 0;}
	.menu_list li a{color: #999; display: inline-block; width: 100%; text-decoration: none; padding-top: 5px;}

	.no-padding{padding: 0;}
	.menu_list .col-sm-3{ height: 10px; margin: 5px 0 0 0; background-color: #00a7d0;}
	.menu_list .col-sm-9 b{padding-left: 10px;}
     .marker-route {
          position: absolute;
          padding: 5px 10px;
          color: #e90000;
          background:#4598e0;
          cursor: pointer;
          white-space:nowrap;
          position: relative;
          color: #fff;
          border-radius: 3px;
          font-size:14px;
        }
     .marker-route:after {
       	content:'';
        position: absolute;
       	width: 0;
	    height: 0;
	    border-left: 5px solid transparent;
	    border-right: 5px solid transparent;
	    border-top: 6px solid #4598e0;
      	bottom: -6px;
       	left:50%;
       	margin-left:-5px;
      }
  </style>
</head>
<body>
<div class="wrapper">

  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper" style="padding-bottom:50px;">
      <!-- Main content -->
      <section class="content-header clearfix"  style="margin-top: 15px;">
        <div class="col-sm-3">
        <div id="main1" style="width: 100%;height:400px;"></div>
      </div>
      <div class="col-sm-7 no-padding" style="height: 420px;">
        <div class="crumbs"><a href="javascript:initChinaMap()">全国</a>
          <a id="city_name"></a>
          <span class="pull-right" onclick="fullscreen()"><img src="dist/img/fullscreen.png"> </span>
          <input id="fscreen" hidden="hidden">
        </div>
        <div id="mainchina" style="width: 100%;height:600px;"></div>
        <div class="box-body" style="position:relative;height:600px;top:7px;display:none" id="mapHeight">
          <div id="mapContainer" style="background-color:rgba(0,0,0,0.5);border-radius:20px;z-index:120"></div>
          <div class="menu" id="TULI" style="display:none">
			  <div class="legend" ><b>--</b></div>
			  <div class="menu_list clearfix" id="test">
			  	<ul id="areas_ul" class="no-padding">
			  
			  	</ul>
			 </div>
		 	<div></div>
		 </div>
        </div>
      </div>
    </section>
    </div>
  <!-- /.content-wrapper -->

</div>

<!-- jQuery 2.2.0 -->
<script src="../crm/plugins/jQuery/jQuery-2.2.0.min.js"></script>
<script type="text/javascript" src="../scripts/bidLibjsjquery3.0.js"></script>
<!-- Bootstrap 3.3.6 -->
<script src="../crm/bootstrap/js/bootstrap.min.js"></script>
<!-- Morris.js charts -->
<script src="../crm/bootstrap/js/raphael-min.js"></script>
<script src="../crm/plugins/morris/morris.min.js"></script>
<!-- FastClick -->
<script src="../crm/plugins/fastclick/fastclick.js"></script>
<!-- AdminLTE App -->
<script src="../crm/dist/js/app.min.js"></script>
<!-- AdminLTE for demo purposes -->
<script src="../crm/dist/js/demo.js"></script>
<script type="text/javascript" src="../scripts/bidLibjsjquery3.0.js"></script>
<!-- page script -->
<script src="../crm/dist/js/jquery.dataStatistics.js"></script>
<script type="text/javascript" src="https://webapi.amap.com/maps?v=1.4.2&key=f52a1bb11408e8a46dc884b2aaa44edc&plugin=AMap.PolyEditor"></script>

<script>
layer.config({
	
	  extend: 'skin/crmskin/style.css' //加载新皮肤
	  
	});

jQuery(document).ready(function($) {
	  
  $(".map_city").mouseover(function(){
    $(this).find(".wave").show();
  }).mouseout(function(){
    $(this).find(".wave").hide();

  });
  
  
   $(".sidebar-menu > li").mouseenter(function(){
	    $(this).children(".nav_dropdown").show();
	    $(this).addClass("sidebar_active");

	    $(".nav_dropdown li").removeClass("nav_mark_bg");
	  });
	  $(".sidebar-menu > li").mouseleave(function(){
	    $(this).children(".nav_dropdown").hide();
	    $(this).removeClass("sidebar_active");
	  });
	  $(".nav_dropdown > li").mouseenter(function(){
	    $(this).children(".nav_dropm").show();
	  });
	  $(".nav_dropdown > li").mouseleave(function(){
	    $(this).children(".nav_dropm").hide();
	  });

	  $(".nav_dropdown li").hover(function(){
	    $(".nav_dropdown li").removeClass("nav_mark_bg");
	    $(this).addClass("nav_mark_bg");
	  });
	  
});

//简单设置JS缓存
//1. 将数据设置到缓存：
//JsCache.set(key,value,expirs), expirs也可以不设置，默认是60秒
//读取缓存：JsCache._cacheData.key
var JsCache = {
  _cacheEndTime: 0, //缓存截止时间
  _cacheData: {}, //以JSON对象存储
  _currTime: 0, //当前时间戳，是毫秒数

  set: function(key,value,timeOut) {
      this._currTime = Date.parse(new Date()) / 1000;
      timeOut = arguments[2] ? arguments[2] : 60;
      this._cacheEndTime = this._currTime + timeOut;
      this._cacheData[key] = value;
  },

  get: function(key) {
      this._currTime = Date.parse(new Date()) / 1000;
      if (this._cacheEndTime < this._currTime) {  //过期了
          this.del(key);
          return null;
      } else {
          return this._cacheData[key];
      }
  },

  del: function(key) {
      delete this._cacheData[key];
  }
};

//加载数据列表的展示
function initData(){
	
}

</script>
<script src="../crm/dist/js/echarts.common.min.js"></script>
<script src="../crm/dist/js/china.js"></script>
<script type="text/javascript">
//初始化地图对象，加载地图
var map = new AMap.Map("mapContainer", {
      resizeEnable : true,
      zoom : 13
});

map.plugin(["AMap.MapType"],function(){
      //地图类型切换
 var type= new AMap.MapType({
    defaultType:0 //使用2D地图
 });
 map.addControl(type);
});
map.setMapStyle('amap://styles/light');


//该数组用于该小区操作坐标
var polygonArray = [];
var polygonArrayCopy = [];
//服务区域
var polygonArea = [];
//存放所有小区的数组
var tinyAreaArray = [];//小区区域数组
var storeno="";
var coordinate;//小区坐标
var storeService;//服务范围

/**获取门店的服务范围以及中心点**/
var aboutArea = {};
var arrayObj = new Array();//片区色块数组
var areaColor = {};//片区色块
var colorOther = "#080000";//灰色（超出20个片区的范围的）
var colorArrar = new Array("#007979","#00FFFF","#796400","#FFD306","#009100","#5151A2","#8F4586","#F75000","#FF0000","#FF9797","#FF0080","#600000","#820041","#4B0091","#A8FF24","#63B8FF","#5E5E5E","#bf88113d","#0000FF","#7CCD7C");
function getStorePositionAndServiceArea(){
	 doManager("areaManager", "getTinyVillageCoord",[STORE_ID], function(data, textStatus,XMLHttpRequest) {
	        if(data.result){
	            
	        	var resultJson= JSON.parse(data.data);
	        	if(resultJson!=null&&resultJson.code==200){
	        		$("#areas_ul").empty();	
	        		coordinate = resultJson.coordinate;//小区坐标
	        		storeService = resultJson.serviceArea;//服务范围
	        		var areas = resultJson.areas;//片区
	        		var store = resultJson.store;
	        		$(".legend").html('<b style="color:red">'+store.name+'</b>');
	        		for(var i=0;i<areas.length;i++){
	        			 
	        			//var color = getColor(i+1);
	        			if(i<20){
	        				areaColor[areas[i].area_no] = colorArrar[i];
	        			}else if(i>=20){
	        				areaColor[areas[i].area_no] =colorOther;
	        			}
	        			aboutArea[areas[i].area_no] = areas[i];
	        			arrayObj.push(areaColor);
	        			var name_a = areas[i].employee_a_name==null?"无":areas[i].employee_a_name;
            			var name_b = areas[i].employee_b_name==null?"无":areas[i].employee_b_name;
            			var areaName = areas[i].name;
            			if(areaName.length>6){
            				areaName = areaName.substring(0,6) + "..."
            			}
            			
        				var  areaHtml= '<li class="col-lg-12" onmouseover="lightPloygon(\''+areas[i].area_no+'\')" onmouseout="showAllTinyArea()">'+
				     				   '<div class="col-sm-3 no-padding" style="width:15%;background:'+areaColor[areas[i].area_no]+'"></div>'+
				    				   '<div class="col-sm-9 no-padding" >'+
				    					   '<p style="padding-left:10px;white-space:nowrap;"><span style="white-space:nowrap;display:inline-block">'+areaName+'</span></p>'+
				    				   '</div>'+
				    			   '</li>';
			 			$("#areas_ul").append(areaHtml);
	        		}
	        		initArea(storeService,coordinate);
	        		layer.closeAll();
	        	}else{
	        		
	        		$("#areas_ul").empty();
	        		$("#TULI").hide();
	        		layer.msg(resultJson.message);
	        		map.clearMap();
	        	}
	            
	        	
	            
	        }else{
	            $$.showMessage("系统信息", "数据加载异常！");
	        }},false);
}


var googleLayer = null;
//服务区域
var  serviceRange;
function initArea(storeService,coordinate) {
    map.clearMap();
    //服务区域多边形
    serviceRange = new AMap.Polygon({
        path: storeService,//设置多边形边界路径
        strokeColor: "#F00", //线颜色
        strokeOpacity: 0.9, //线透明度
        strokeWeight: 2,    //线宽
        fillColor: "#00DD00", //填充色
        fillOpacity: 0//填充透明度
    });
    serviceRange.setMap(map);
    

    var areaTinyVillage;//小区坐标范围
    var tinyVillageMarker;
    var tinyVillagePolygon;
    for(var i=0;i<coordinate.length;i++){
    	if(coordinate[i].areaNo!=null&&coordinate[i].areaNo!=""){
            var $strokeColor = areaColor[coordinate[i].areaNo];
            
            if(typeof($strokeColor) == "undefined"){
            	$strokeColor = "#333333cf";
            }
            var $fillColor = areaColor[coordinate[i].areaNo];
            if(typeof($fillColor) == "undefined"){
            	$fillColor = "#333333cf";
            }
            //绘制小区
        	areaTinyVillage = new AMap.Polygon({
                    path:coordinate[i].coordinate_range.coordinates[0],//设置多边形边界路径
                    strokeColor: $strokeColor, //线颜色
                    strokeOpacity: 1.0, //线透明度
                    strokeWeight: 2,    //线宽
                    fillColor: $fillColor, //填充色
                    fillOpacity: 0.45,//填充透明度
                    extData:{"areaNo":coordinate[i].areaNo} 
                });
            
        	var tmp_tinyVillageCoordinate={
        			area_no:coordinate[i].areaNo,
        			tinyVillagePolygon:areaTinyVillage,
        			strokeColor: $strokeColor,
        			fillColor: $fillColor
        	}
        	polygonArray.push(tmp_tinyVillageCoordinate);
        	polygonArrayCopy.push(tmp_tinyVillageCoordinate);
        	areaTinyVillage.setMap(map);
        	   
           var $tinyVillageName = coordinate[i].name;  
           var strLength = -(($tinyVillageName.length*14+20)/2);
           var $position = coordinate[i].location; 
           if($position!=null&&$position.length==2){
        	   var bindArea = aboutArea[coordinate[i].areaNo];
        	   var areaLength = -((bindArea.name.length*14+20)/2)+40;
        	   var aEmployee = bindArea.employee_a_name==null?"无":bindArea.employee_a_name;
        	   var areaName = bindArea.name;
        	   
           }
    	}
    }
    
   $("#TULI").show();
}


</script>

</body>
</html>