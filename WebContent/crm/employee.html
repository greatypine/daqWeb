<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>国安侠</title>
  <!-- Tell the browser to be responsive to screen width -->
  <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
  <!-- Bootstrap 3.3.6 -->
  <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="bootstrap/css/font-awesome.min.css">
  <!-- Ionicons -->
  <link rel="stylesheet" href="bootstrap/css/ionicons.min.css">
  <!-- Morris charts -->
  <link rel="stylesheet" href="plugins/morris/morris.css">
  <!-- Theme style -->
  <link rel="stylesheet" href="dist/css/AdminLTE.min.css">
  <!-- AdminLTE Skins. Choose a skin from the css/skins
       folder instead of downloading all of them to reduce the load. -->
  <link rel="stylesheet" href="dist/css/skins/_all-skins.min.css">
  <link rel="stylesheet" href="plugins/daterangepicker/daterangepicker-bs3.css">
  <link rel="stylesheet" href="plugins/gooey_menu/gooey.min.css">
  <!-- Select2 -->
  <link rel="stylesheet" href="plugins/select2/select2.min.css">
  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
  <script src="IE 9/html5shiv.min.js"></script>
  <script src="IE 9/respond.min.js"></script>
  <![endif]-->
  <style>
    .details{background-color: #e95959; padding: 30px 0 10px 0; color: #fff;}
    .user_photo{width: 200px; height: 200px; border-radius: 50%; margin: 0 auto; border: 5px solid rgba(183,52,52,0.5); overflow:hidden;}
    .user_photo img{height: 200px;}
    .dl-horizontal dt{width: 100px; line-height: 30px;}
    .dl-horizontal dd{line-height: 30px; margin-left: 130px;}
    .small-box{border-radius: 10px; box-shadow: 0 1px 1px rgba(0,0,0,0.3);}
    .small-box .icons{position: static; font-size: 70px;}
    .small-box .icons img{height: 75px;}
    .small-box > .small-box-footer{border-bottom-right-radius: 10px; border-bottom-left-radius: 10px; font-size: 12px; padding: 5px 0;}
  </style>
</head>
<body class="hold-transition skin-blue sidebar-mini">
<!-- Site wrapper -->
<div class="wrapper">
  <header class="main-header">
        <nav class="navbar navbar-static-top">
            <div class="container">
                <div class="logo_img pull-left"><img src="dist/img/logo1.png" height="30"><img src="dist/img/title.png" height="20"></div>
                <div class="pull-left">
                    <div class="logo-lg">
                        <ul class="no-margin no-padding">
                            <li class="current">
                                <em class="logo_cs">数据运营<i class="glyphicon glyphicon-triangle-bottom"></i></em>
                                <div class="TDsec-nav">
                                    <div class="secNav-box">
                                        <dl class="col-sm-3">
                                            <dt><i></i>运营数据</dt>
                                            <dd><a href="#"><span class="fa fa-money"></span>营业额统计</a></dd>
                                            <dd><a href="#"><span class="fa fa-user-plus"></span>用户运营</a></dd>
                                            <dd><a href="#"><span class="fa fa-cubes"></span>产品运营</a></dd>
                                            <dd><a href="#"><span class="fa fa-institution"></span>门店运营</a></dd>
                                            <dd><a href="#"><span class="fa fa-comments-o"></span>混片情况</a></dd>
                                        </dl>
                                        <dl class="col-sm-3">
                                            <dt><i></i>绩效数据</dt>
                                            <dd><a href="#"><span class="fa fa-line-chart"></span>门店GMV</a></dd>
                                            <dd><a href="#"><span class="fa fa-pie-chart"></span>国安侠GMV</a></dd>
                                            <dd><a href="#"><span class="fa fa-area-chart"></span>门店拉新</a></dd>
                                            <dd><a href="#"><span class="fa fa-bar-chart"></span>国安侠拉新</a></dd>
                                            <dd><a href="#"><span class="fa fa-thumbs-o-up"></span>国安侠好评次数</a></dd>
                                        </dl>
                                        <dl class="col-sm-3">
                                            <dt><i></i>档案数据</dt>
                                            <dd><a href="#"><span class="fa fa-file-o"></span>订单档案</a></dd>
                                            <dd><a href="#"><span class="fa fa-newspaper-o"></span>员工档案</a></dd>
                                            <dd><a href="#"><span class="fa fa-copy"></span>片区档案</a></dd>
                                            <dd><a href="#"><span class="fa fa-clipboard"></span>小区档案</a></dd>
                                        </dl>
                                        <dl class="col-sm-3">
                                            <dt><i></i>排名数据</dt>
                                            <dd><a href="#"><span class="fa fa-signal"></span>XX排名</a></dd>
                                            <dd><a href="#"><span class="fa fa-signal"></span>XX排名</a></dd>
                                        </dl>
                                    </div>
                                </div>
                            </li>

                        </ul>


                    </div>
                </div>
                <div class="navbar-custom-menu">
                    <ul class="nav navbar-nav">
                        <li class="dropdown user user-menu">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                <img src="dist/img/user2-160x160.jpg" class="user-image" alt="User Image">
                                <span class="hidden-xs">载入中...</span>
                            </a>
                            <ul class="dropdown-menu">
                                <li class="user-header">
                                    <img src="dist/img/user2-160x160.jpg" class="img-circle" alt="User Image">

                                    <p><strong id="cur_card_name">载入中...</strong></p>
                                    <p><span id="cur_card_no">载入中...</span></p>
                                    <p><span id="cur_store_name">载入中...</span></p>
                                </li>

                                <li class="user-footer">
                                    <div class="pull-left">
                                        <a href="../crm/loginplatform.html" class="btn btn-default btn-flat">数据平台首页</a>
                                    </div>
                                    <div class="pull-right">
                                        <a href="javascript:doLogout()" class="btn btn-default btn-flat">退出</a>
                                    </div>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>

  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
    <div class="container">
      <!-- Main content -->
      <section class="content-header">
        <div class="box box-default details">
          <!--<div class="box-header h4"><strong>安心合作社运营报告</strong></div>-->
          <div class="box-body">
            <div class="col-sm-3 no-padding text-center"><div class="user_photo"><img id="user_pic" src="dist/img/avatar5.png"></div></div>
            <dl class="dl-horizontal col-sm-4 no-padding">
              <dt>职务</dt>
              <dd id="zw">载入中...</dd>
              <dt>员工工号</dt>
              <dd id="employeeNo">载入中...</dd>
              <dt>在职时间</dt>
              <dd id="workingAge">载入中...</dd>
              <dt>电话</dt>
              <dd id="phone">载入中...</dd>
              <dt>所属门店</dt>
              <dd id="storeName">载入中...</dd>
              <dt>所属片区</dt>
              <dd id="areaName">载入中...</dd>
            </dl>
            <div class="col-sm-5 no-padding">
              <div class="col-sm-6">
                <div class="small-box bg-yellow text-center">
                  <div class="icons"><img src="dist/img/gax_weekly1.png"></div>
                  <div class="inner">
                    <h3 id="consumer">载入中...</h3>
                    <p>累计用户量</p>
                  </div>
                  <a class="small-box-footer">截止到昨天24时 <i class="fa fa-arrow-circle-right"></i></a>
                </div>
              </div>
              <div class="col-sm-6">
                <div class="small-box bg-aqua text-center">
                  <div class="icons"><img src="dist/img/gax_weekly2.png"></div>
                  <div class="inner">
                    <h3 id="gmv">载入中...</h3>
                    <p>累计营业额</p>
                  </div>
                  <a class="small-box-footer">截止到昨天24时 <i class="fa fa-arrow-circle-right"></i></a>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="box box-default">
          <!--<div class="box-header h4 text-light-blue"><strong>社员分析</strong></div>-->
          <div class="box-body" style="padding-top: 25px;">
            <div class="col-sm-6 no-padding" id="main1" style="height: 350px;"></div>
            <div class="col-sm-6 no-padding" id="main2" style="height: 350px;"></div>
          </div>
        </div>
      </section>
    </div>
  </div>
</div>
<!-- ./wrapper -->

<!-- jQuery 2.2.0 -->
<script src="plugins/jQuery/jQuery-2.2.0.min.js"></script>
<!-- Bootstrap 3.3.6 -->
<script src="bootstrap/js/bootstrap.min.js"></script>
<!-- Morris.js charts -->
<script src="bootstrap/js/raphael-min.js"></script>
<script src="plugins/morris/morris.min.js"></script>
<!-- FastClick -->
<script src="plugins/fastclick/fastclick.js"></script>
<!-- AdminLTE App -->
<script src="dist/js/app.min.js"></script>
<!-- AdminLTE for demo purposes -->
<script src="dist/js/demo.js"></script>
<script type="text/javascript" src="../scripts/bidLibjsjquery2.0.js"></script>
<script src="dist/js/nav-scroll.js"></script>
<!-- 引入 ECharts 文件 -->
<script src="dist/js/echarts.common.min.js"></script>
<script type="text/javascript">

    var employee_no = decode64(getUrlParamByKey("employee_no"));
    var source = decode64(getUrlParamByKey("source"));
    $(function(){
        if(source=0){
            initcurruser();
        }

        getUserHeadPortraits();
        initemployeeinfo();
        getChannelPercentOfOrder();
        getConsumTimePercentOfOrder();

    })
    var curr_user = null;
    var employeeNo= "";
    function initcurruser(){
        //取得当前登录人的门店
        doManager("UserManager", "getCurrentUserDTO",null,
            function(data, textStatus, XMLHttpRequest) {
                if (data.result) {
                    curr_user = JSON.parse(data.data);
                    employeeNo = curr_user.employeeId;
                    $('span[class="hidden-xs"]').html(curr_user.name);
                    if(curr_user.employeeId!=null){


                        $("#cur_employee_no").html(curr_user.employeeId);
                        $("#cur_card_name").html(curr_user.name);
                        $("#cur_card_no").html(curr_user.zw+" "+curr_user.employeeId);


                    }else{
                        $("#cur_card_name").html(curr_user.name);
                        $("#cur_store_name").html("");
                        $("#cur_employee_no").html("");
                        $("#cur_card_no").parent().html("");

                    }

                }
            },false);
    }


    //获取员工头像
    function getUserHeadPortraits(){
        doManager('InterManager', 'findEmployeePicByEmployeeId',[employee_no],
            function(data, textStatus, XMLHttpRequest) {
                if (data.result) {
                    var user_pic = JSON.parse(data.data);
                    if(user_pic.dataMap!=null){

                        $.ajax({
                            url:user_pic.dataMap.pngUrl,
                            type:'HEAD',
                            error: function() {
                                console.log("user_pic_none");
                            },
                            success: function() {
                                $("#user_pic").attr("src",user_pic.dataMap.pngUrl);
                            }
                        });

                    }

                }
            },false);
    }

    var areaNameArray = new Array();
    var areaCodeArray = new Array();
    function initemployeeinfo(){

        //取得当前登录人的门店
        doManager("dynamicManager", "getEmployeeInfo",employee_no,
            function(data, textStatus, XMLHttpRequest) {
                if (data.result) {
                    var human_info = JSON.parse(data.data);
                    if(human_info.human!=null){
                        var ezw = human_info.human.zw==null?"":human_info.human.zw;
                        $("#zw").html(ezw);
                        $("#employeeNo").html(human_info.human.employee_no);
                        $("#workingAge").html(human_info.human.remark);
                        $("#phone").html(human_info.human.phone);
                        $("#storeName").html(human_info.human.storename);
                    }

                    if(human_info.gmv!=null&&human_info.gmv.length!=0){
                        $("#gmv").html(human_info.gmv[0].pesgmv);
                    }else if(human_info.gmv.length==0){
                        $("#gmv").html(0);
                    }

                    if(human_info.customer!=null&&human_info.customer.length!=0){
                        $("#consumer").html(human_info.gmv[0].cusnum);
                    }else if(human_info.customer.length==0){
                        $("#consumer").html(0);
                    }

                    if(human_info.area!=null&&human_info.area.length!=0){
                        var areaList = human_info.area;
                        $("#area").html(human_info.area[0].area);


                        for(var i=0;i<areaList.length;i++){
                            areaNameArray.push(areaList[i].name);
                            areaCodeArray.push("'"+areaList[i].area_no+"'");
                        }

                        $("#areaName").html(areaNameArray.join("、"));
                    }else if(human_info.area.length==0){
                        $("#areaName").html('');
                    }


                }
            },false);
    }

    function doLogout() {


        layer.confirm('确定退出？', {
            title:'提示',
            offset:['100px','550px'],
            move:false,
            skin:'layer-ext-crmskin',
            btn: ['确定','取消'], //按钮
        }, function(){
            urlStr = "../logout.do";
            window.location.href = urlStr;
        }, function(){

        });

    }


    //各个频道交易占比
    function  getChannelPercentOfOrder(){


        doManager("dynamicManager", "getOrderPercentageOfChannel",[areaCodeArray.join()],
            function(data, textStatus, XMLHttpRequest) {
                if (data.result) {
                    var channelOrder = JSON.parse(data.data).order;
                    var channelName = new Array();
                    var channelValue = new Array();

                    if(channelOrder!=null){
                        for(var i=0;i<channelOrder.length;i++){
                            var v = channelOrder[i].total;
                            var n = channelOrder[i].channel_name;
                            channelName[i] = n;
                            channelValue[i] = v;
                        }
                        option1.xAxis[0].data = channelName;
                        option1.series[0].data = channelValue;
                        option1.title[0].text = "片区内频道订单量（当年）";
                        myChart1.setOption(option1);
                    }


                }
            },false);
    }

    //交易消费次数占比
    function  getConsumTimePercentOfOrder(){

        doManager("dynamicManager", "getConsumTimeOfCustomer",[areaCodeArray.join()],
            function(data, textStatus, XMLHttpRequest) {
                if (data.result) {
                    var consumTime = JSON.parse(data.data).consum;
                    var consumName = new Array();
                    var consumValue = new Array();

                    if(consumTime!=null){
                        for(var i=0;i<consumTime.length;i++){
                            var v = consumTime[i].total;
                            var n = consumTime[i].rang;
                            consumName[i] = n;
                            consumValue[i] = v;
                        }
                        option2.xAxis[0].data = consumName;
                        option2.series[0].data = consumValue;
                        option2.title[0].text = "片区内客户消费次数（当年）";
                        myChart2.setOption(option2);
                    }


                }
            },false);
    }
  var myChart1 = echarts.init(document.getElementById('main1'));
  var myChart2 = echarts.init(document.getElementById('main2'));

  //各个频道交易占比
  option1 = {
    title: [{
      text: '片区内频道订单量（当年）',
      left: '45%',
      top: '2%',
      textAlign: 'center',
      textBaseline: 'middle',
      textStyle: {
        color: '#666',
        fontSize: 16
      }
    }],
    tooltip: {
      trigger: 'item',
      formatter: "{b}: {c} ({d}%)"
    },
    series: [{
      type: 'pie',
      selectedMode: 'single',
      center: ['45%', '53%'],
      radius: ['40%', '80%'],
      color: ['#AF89D6', '#59ADF3', '#FF999A', '#FFCC67','#FCC667','#CC5962'],

      label: {
        normal: {
          position: 'inside', //标签的位置
          formatter: '{b}\n{d}%'

        }
      },
      labelLine: {
        normal: {
          show: false
        }
      },
      data: []
    }]
  };

  //交易消费次数占比
  option2 = {
    title: [{
      text: '片区内客户消费次数（当年）',
      left: '45%',
      top: '2%',
      textAlign: 'center',
      textBaseline: 'middle',
      textStyle: {
        color: '#666',
        fontSize: 16
      }
    }],
    tooltip: {
      trigger: 'item',
      formatter: "{a} <br/>{b}: {c} ({d}%)"
    },
    color: ['#fd9173', '#f36f8a', '#5f71d2', '#42a4eb', '#4ac7f5'],
    series: [{
      name: '违规次数',
      type: 'pie',
      clockwise: false, //饼图的扇区是否是顺时针排布
      minAngle: 20, //最小的扇区角度（0 ~ 360）
      center: ['45%', '53%'], //饼图的中心（圆心）坐标
      radius: ['40%', '80%'], //饼图的半径
      avoidLabelOverlap: true, ////是否启用防止标签重叠
      itemStyle: { //图形样式
        normal: {
          borderColor: '#1e2239',
          borderWidth: 1.5,
        },
      },
      label: { //标签的位置
        normal: {
          show: true,
          position: 'inside', //标签的位置
          formatter: "{b}\n{d}%",
          textStyle: {
            color: '#fff',
          }
        },
        emphasis: {
          show: true,
          textStyle: {
            fontWeight: 'bold'
          }
        }
      },
      data: [

      ]
    }]
  };

  myChart1.setOption(option1);
  myChart2.setOption(option2);
</script>
</body>
</html>