<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>国安数据518数据大屏</title>
  <link rel="shortcut icon" type="image/x-icon" href="../icon.png" />
  <!-- Tell the browser to be responsive to screen width -->
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <!-- Bootstrap 3.3.6 -->
  <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="bootstrap/css/font-awesome.min.css">
  <!-- Ionicons -->
  <link rel="stylesheet" href="bootstrap/css/ionicons.min.css">
  <!-- Morris charts -->
  <link rel="stylesheet" href="plugins/morris/morris.css">
  <!-- Theme style -->
  <link rel="stylesheet" href="dist/css/AdminLTE.min.css">
  <!-- AdminLTE Skins. Choose a skin from the css/skins
       folder instead of downloading all of them to reduce the load. -->
  <link rel="stylesheet" href="dist/css/skins/_all-skins.min.css">
  <link rel="stylesheet" href="dist/css/tTurnover-head-scoll.css">
  <link rel="stylesheet" href="https://cache.amap.com/lbs/static/main1119.css"/>
  <script type="text/javascript" src="https://webapi.amap.com/maps?v=1.4.2&key=f52a1bb11408e8a46dc884b2aaa44edc&plugin=AMap.PolyEditor"></script>
  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
  <script src="IE 9/html5shiv.min.js"></script>
  <script src="IE 9/respond.min.js"></script>
  <![endif]-->
  <style>
    body{ overflow: auto; min-height: 100%;}
    section{min-width: 1320px; margin: 0 auto; position: relative; padding: 0 20px; z-index: 11;clear: both;overflow: hidden;background: url("dist/518img/518-bg2.jpg") no-repeat top center; background-size: 100% 100%; min-height: 100%;}
    p{margin: 0;}
    .carnival_l,.carnival_r{width: 20%; padding-top: 50px; position: relative;}
    .carnival_c{width: 60%; position: relative;}
    .carnival_c_bg{ padding-top: 75px; max-height: 529px;background: url("dist/518img/img4.png") no-repeat top center; background-size:auto 100%;}
    .activity-logo img{max-height: 170px; padding-left: 20px;}
    .activity-img  img{max-height: 60px; margin-left: 22%;}
    .sec_bg{position: absolute; top: 0; left: 0;}
    .sec_bg img:nth-child(1){ height: 23px;}
    .sec_bg img:nth-child(2){ height: 20px;}

    /*翻页效果*/
    .dataStatistics{cursor: pointer; color: #fff; font-family: Trebuchet MS; text-align: center; position: relative; font-size: 95px; line-height: 95px; width: 70%;}
    .data_new{position: relative; width: 100%}
    .digit_set{float: none!important;border:0; border-radius: 4px; perspective: 200px; height: 95px!important; margin: 0 -12px!important; width: 65px!important;}
    .digit_wrap{line-height: 95px;}
    .dataStatistics .digit > div.digit_top, .dataStatistics .digit > div.shadow_top{background-color: #00000c; border-radius: 4px; width: 63px;}
    .dataStatistics .digit > div.digit_bottom, .dataStatistics .digit > div.shadow_bottom{background-color: #00000c; border-radius: 4px; text-align: center; width: 63px;}
    /*.dataStatistics:hover .digit_set{box-shadow: 0 0 16px 2px #186ff0}*/
    .dataStatistics .digit > div.digit_bottom .digit_wrap,.dataStatistics .digit > div.shadow_bottom .digit_wrap{margin-top: -76%; line-height: 95px;}
    .douhao{width: 12px; height: 15px; background: url("dist/518img/douhao_518.png") no-repeat; display: inline-block; margin: 0 -10px}
    .time{font-size: 18px; color: #fff; margin-top: 3%; margin-right: 28%; letter-spacing: 4px;}
    .conusers{color: #fff; font-size: 18px; margin: 20px auto 0 auto; max-width: 55%;}
    .conusers span{font-size: 34px; color: #f9bf0e; font-family: "Century Gothic";}
    .conusers div p:nth-child(2){text-transform: uppercase; font-size: 24px; color: rgba(255,255,255,0.3); font-family: "Times New Roman"; margin-top: -7px;}
	.barrage{width:70%; max-height: 300px;color: #009cff; font-size: 16px; margin-top: 50px; overflow-y: hidden;position:absolute;top: 20px; left: 80px;}
    .barrage li{width: 100%; margin-bottom: 30px;}
    .barrage li i{width: 30px; height: 30px; border-radius: 5px; font-size: 16px; text-align: center; line-height: 26px; margin-right: 5px; color: #fff; box-shadow: 0 1px 5px rgba(0,0,0,0.4);-moz-box-shadow: 0 1px 5px rgba(0,0,0,0.4);}
    .barrage li span{padding: 0 5px;}
    .barrage li span:nth-child(3){color: #f55600;}
    .bar_order i{background-color: #00a1d6;}
    .bar_bf i{background-color: #f25d8e;}

    /*左边*/
    .title{font-size: 20px; color: #fff600;}
    .com_con::before, .com_con::after {position: absolute;top: 0;bottom: 0;left: 0;right: 0;}
    .com_con {height: 388px;margin-top: 30px;color: #69ca62;position: relative;}
    .com_con::before, .com_con::after {content: '';z-index: -1;margin: -1%;box-shadow: inset 0 0 0 2px; animation:clipMe 8s linear infinite;}
    .com_con::before {animation-delay: -4s;}
    @keyframes clipMe {
      0%, 100% {
        clip: rect(0px, 400.0px, 0px, 0px);
      }
      25% {
        clip: rect(0px, 2px, 400.0px, 0px);
      }
      50% {
        clip: rect(398.0px, 400.0px, 400.0px, 0px);
      }
      75% {
        clip: rect(0px, 398.0px, 400.0px, 398.0px);
      }
    }
    .com_tit{color: #fff;}
    .com_tit span{text-transform: uppercase; font-size: 16px; color: rgba(255,255,255,0.3); font-family:"Times New Roman"; padding-left: 5px;}
    .sales-volume{width: 48%; padding: 2% 0 1% 2%;}
    .sales-amount{width: 48%; padding: 2% 2% 1% 0;}
    .sales-volume li{color: #0078ff; clear: both; overflow: hidden; width: 100%; position: relative; padding: 5px 0;font-size: 12px;}
    .product_num{font-size: 24px; position: absolute; top: 14px;  left: 0; width: 18px; text-align: center;}
    .product_nav{margin-left: 18px;}
    .com_progress .clearfix,.city_progress .clearfix{ margin-top: 5px}
    .sales-volume .product_tit{background: -webkit-linear-gradient(rgba(0,0,0,0), rgba(0,12,251,0.5));
      /* Safari 5.1 - 6.0 */
      background: -o-linear-gradient(right, rgba(0,0,0,0), rgba(0,12,251,0.5)); /* Opera 11.1 - 12.0 */
      background: -moz-linear-gradient(right, rgba(0,0,0,0), rgba(0,12,251,0.5)); /* Firefox 3.6 - 15 */
      background: linear-gradient(to right, rgba(0,0,0,0), rgba(0,12,251,0.5)); /* 标准的语法（必须放在最后） */
      color: #00f0ff; height: 30px; line-height: 30px;white-space:nowrap; text-overflow:ellipsis; -o-text-overflow:ellipsis; overflow:hidden;}
    .sales-volume .progress{background: -webkit-linear-gradient(rgba(0,0,0,0), rgba(0,12,251,0.5)); background: -o-linear-gradient(right, rgba(0,0,0,0), rgba(0,12,251,0.5)); background: -moz-linear-gradient(right, rgba(0,0,0,0), rgba(0,12,251,0.5)); background: linear-gradient(to right, rgba(0,0,0,0), rgba(0,12,251,0.5)); height: 5px;}
    .sales-volume .progress-bar{background-color: #00baff;}
    .sales-amount li{color: #b87d30; clear: both; overflow: hidden; width: 98%; position: relative; padding: 10px 1% 0 1%;font-size: 12px;}
    .sales-amount .product_tit{background: -webkit-linear-gradient(rgba(255,255,255,0), rgba(141,151,70,0.3));
      background: -o-linear-gradient(right, rgba(255,255,255,0), rgba(141,151,70,0.3)); /* Opera 11.1 - 12.0 */
      background: -moz-linear-gradient(right, rgba(255,255,255,0), rgba(141,151,70,0.3)); /* Firefox 3.6 - 15 */
      background: linear-gradient(to right, rgba(255,255,255,0), rgba(141,151,70,0.3)); /* 标准的语法（必须放在最后） */
      color: #f6ba6b; height: 30px; line-height: 30px;white-space:nowrap; text-overflow:ellipsis; -o-text-overflow:ellipsis; overflow:hidden;width:80%;}
    .sales-amount .progress{background: -webkit-linear-gradient(rgba(255,255,255,0), rgba(141,151,70,0.3)); background: -o-linear-gradient(right, rgba(255,255,255,0), rgba(141,151,70,0.3)); background: -moz-linear-gradient(right, rgba(255,255,255,0), rgba(141,151,70,0.3)); background: linear-gradient(to right, rgba(255,255,255,0), rgba(141,151,70,0.3)); height: 5px;}
    .sales-amount .progress-bar{background-color: #eb9017;}

    /*右边*/
    .city_progress{line-height: 30px;}
    .city_tit{white-space:nowrap; text-overflow:ellipsis; -o-text-overflow:ellipsis; overflow:hidden; color: #00f0ff;width:80%;}
    .proportion li{padding: 10px 1.5%;}
    .proportion .product_num{width: 30px; text-align: center; top: 16px;}
    .proportion .product_nav{margin-left: 30px;}
    .relitu{position: relative; margin: 50px 0px 0 -20px; color: #fff;}
    select{border: 0; border-bottom: 1px solid #2f1db2; background-color: transparent; width: 50%; color: #fff; outline: none;}
    select option{color: #666;}
    #mapContainer {
      position: absolute;
      top: 40px;
      left: 0;
      right: 0;
      bottom: 0;
    }
    #mapContainer2 {
      position: absolute;
      top: 40px;
      left: 0;
      right: 0;
      bottom: 0;
    }

  </style>
</head>
<body class="hold-transition skin-blue sidebar-mini">

<section>
  <div class="sec_bg"><img src="dist/img/logo1.png"><img src="dist/518img/hdlogo.png"> </div>
  <div class="carnival_l pull-left">
    <div class="commodity">
      <div class="title">商品销量/销售额</div>
      <div class="com_con">
        <div class="sales-volume pull-left">
          <div class="com_tit">销量</div>
          <ul class="no-padding">
            <li id="product_0">
              <div class="product_num">1</div>
              <div class="product_nav">
                <div class="product_tit" id="product_name_0">Loading</div>
                <div class="com_progress">
                  <div class="progress no-margin">
                    <div class="progress-bar" id="product_bar_0"></div>
                  </div>
                  <div class="clearfix">
                    <small class="pull-right" id="product_price_0">Loading</small>
                  </div>
                </div>

              </div>
            </li>
            <li id="product_1">
              <div class="product_num">2</div>
              <div class="product_nav">
                <div class="product_tit" id="product_name_1">Loading</div>
                <div class="com_progress">
                  <div class="progress no-margin">
                    <div class="progress-bar" id="product_bar_1"></div>
                  </div>
                  <div class="clearfix">
                    <small class="pull-right" id="product_price_1">Loading</small>
                  </div>
                </div>

              </div>
            </li>
            <li id="product_2">
              <div class="product_num">3</div>
              <div class="product_nav">
                <div class="product_tit" id="product_name_2">Loading</div>
                <div class="com_progress">
                  <div class="progress no-margin">
                    <div class="progress-bar" id="product_bar_2"></div>
                  </div>
                  <div class="clearfix">
                    <small class="pull-right" id="product_price_2">Loading</small>
                  </div>
                </div>

              </div>
            </li>
            <li id="product_3">
              <div class="product_num">4</div>
              <div class="product_nav">
                <div class="product_tit" id="product_name_3">Loading</div>
                <div class="com_progress">
                  <div class="progress no-margin">
                    <div class="progress-bar" id="product_bar_3"></div>
                  </div>
                  <div class="clearfix">
                    <small class="pull-right" id="product_price_3">Loading</small>
                  </div>
                </div>

              </div>
            </li>
            <li id="product_4">
              <div class="product_num">5</div>
              <div class="product_nav">
                <div class="product_tit" id="product_name_4">Loading</div>
                <div class="com_progress">
                  <div class="progress no-margin">
                    <div class="progress-bar" id="product_bar_4"></div>
                  </div>
                  <div class="clearfix">
                    <small class="pull-right" id="product_price_4">Loading</small>
                  </div>
                </div>

              </div>
            </li>
          </ul>
        </div>
        <div class="sales-amount pull-right">
          <div class="com_tit">销售额</div>
          <ul class="no-padding">
            <li id="eshop_0">
              <div class="product_num">1</div>
              <div class="product_nav">
                <div class="product_tit" id="eshop_name_0">Loading</div>
                <div class="com_progress">
                  <div class="progress no-margin">
                    <div class="progress-bar" id="eshop_bar_0"></div>
                  </div>
                  <div class="clearfix">
                    <small class="pull-right" id="eshop_price_0">Loading</small>
                  </div>
                </div>

              </div>
            </li>
            <li id="eshop_1">
              <div class="product_num">2</div>
              <div class="product_nav">
                <div class="product_tit" id="eshop_name_1">Loading</div>
                <div class="com_progress">
                  <div class="progress no-margin">
                    <div class="progress-bar" id="eshop_bar_1"></div>
                  </div>
                  <div class="clearfix">
                    <small class="pull-right" id="eshop_price_1">Loading</small>
                  </div>
                </div>

              </div>
            </li>
            <li id="eshop_2">
              <div class="product_num">3</div>
              <div class="product_nav">
                <div class="product_tit" id="eshop_name_2">Loading</div>
                <div class="com_progress">
                  <div class="progress no-margin">
                    <div class="progress-bar" id="eshop_bar_2"></div>
                  </div>
                  <div class="clearfix">
                    <small class="pull-right" id="eshop_price_2">Loading</small>
                  </div>
                </div>

              </div>
            </li>
            <li id="eshop_3">
              <div class="product_num">4</div>
              <div class="product_nav">
                <div class="product_tit" id="eshop_name_3">Loading</div>
                <div class="com_progress">
                  <div class="progress no-margin">
                    <div class="progress-bar" id="eshop_bar_3"></div>
                  </div>
                  <div class="clearfix">
                    <small class="pull-right" id="eshop_price_3">Loading</small>
                  </div>
                </div>

              </div>
            </li>
            <li id="eshop_4">
              <div class="product_num">5</div>
              <div class="product_nav">
                <div class="product_tit" id="eshop_name_4">Loading</div>
                <div class="com_progress">
                  <div class="progress no-margin">
                    <div class="progress-bar" id="eshop_bar_4"></div>
                  </div>
                  <div class="clearfix">
                    <small class="pull-right" id="eshop_price_4">Loading</small>
                  </div>
                </div>

              </div>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <div class="relitu">
      	<div class="relitu_select">
        <select id="citySelect2"></select>
        <!-- <span class="pull-right" id="timeshow2">0时</span> -->
      </div>
      <div id="mapContainer2" style="background-color:rgba(0,0,0,0.5);width: 100%;height:100%;"></div>
    </div>
  </div>
  <div class="carnival_c pull-left" id="carnival_c">
    <div class="carnival_c_bg">
      <div class="text-center activity-logo"><img src="dist/518img/img1.png"></div>
      <div class="activity-img" style="margin-top: -10px;"><img src="dist/518img/img3.png"></div>
      <div class="dataStatistics">
        <div class="data_new">
          <span style="font-size: 30px; font-weight: normal; margin-right: -20px; margin-left: -10px;">￥</span>
          <div class="digit_set"></div>
          <div class="digit_set"></div>
          <div class="digit_set"></div>
          <div class="douhao" id="dou1"></div>
          <div class="digit_set"></div>
          <div class="digit_set"></div>
          <div class="digit_set"></div>
          <div class="douhao" id="dou2"></div>
          <div class="digit_set"></div>
          <div class="digit_set"></div>
          <div class="digit_set set_last"></div>
        </div>
      </div>
      <div class="clearfix conusers">
        <div class="pull-left">
          <p>消费用户数：<span id="pay_customer">Loading</span></p>
          <!--<p>Consumer number</p>-->
        </div>
        <div class="pull-right text-right">
          <p>新增社员数：<span id="vip_customer">Loading</span></p>
          <!--<p>New user occupation ratio</p>-->
        </div>
      </div>
      <div class="text-right time" id="now_time">00:00:00</div>
    </div>
   <div class="pull-left" id="main1" style="height: 320px; width: 50%"></div>
    <div class="pull-left" style="position: relative; width: 50%">
      <div id="main2" style="width: 100%; margin-top: 40px;"></div>
      <div class="barrage" id="show">
        <ul class="no-padding" id="roll_info">
        </ul>
      </div>
    </div>

  </div>
  <div class="carnival_r pull-right">
    <div class="proportion">
      <div class="title">营业额城市贡献占比</div>
      <div class="com_con">
        <div class="sales-volume pull-left">
          <ul class="no-padding">
            <li id="city_0">
              <div class="product_num">1</div>
              <div class="product_nav">
                <div class="city_progress">
                  <div class="clearfix">
                    <span class="pull-left city_tit" id="city_name_0">Loading</span>
                    <small class="pull-right" id="city_percent_0">Loading</small>
                  </div>
                  <div class="progress no-margin">
                    <div class="progress-bar" id="city_bar_0"></div>
                  </div>
                </div>

              </div>
            </li>
            <li id="city_1">
              <div class="product_num">2</div>
              <div class="product_nav">
                <div class="city_progress">
                  <div class="clearfix">
                    <span class="pull-left city_tit" id="city_name_1">Loading</span>
                    <small class="pull-right" id="city_percent_1">Loading</small>
                  </div>
                  <div class="progress no-margin">
                    <div class="progress-bar" id="city_bar_1"></div>
                  </div>
                </div>

              </div>
            </li>
            <li id="city_2">
              <div class="product_num">3</div>
              <div class="product_nav">
                <div class="city_progress">
                  <div class="clearfix">
                    <span class="pull-left city_tit" id="city_name_2">Loading</span>
                    <small class="pull-right" id="city_percent_2">Loading</small>
                  </div>
                  <div class="progress no-margin">
                    <div class="progress-bar" id="city_bar_2"></div>
                  </div>
                </div>

              </div>
            </li>
            <li id="city_3">
              <div class="product_num">4</div>
              <div class="product_nav">
                <div class="city_progress">
                  <div class="clearfix">
                    <span class="pull-left city_tit" id="city_name_3">Loading</span>
                    <small class="pull-right" id="city_percent_3">Loading</small>
                  </div>
                  <div class="progress no-margin">
                    <div class="progress-bar" id="city_bar_3"></div>
                  </div>
                </div>

              </div>
            </li>
            <li id="city_4">
              <div class="product_num">5</div>
              <div class="product_nav">
                <div class="city_progress">
                  <div class="clearfix">
                    <span class="pull-left city_tit" id="city_name_4">Loading</span>
                    <small class="pull-right" id="city_percent_4">Loading</small>
                  </div>
                  <div class="progress no-margin">
                    <div class="progress-bar" id="city_bar_4"></div>
                  </div>
                </div>

              </div>
            </li>
            <li id="city_5">
              <div class="product_num">6</div>
              <div class="product_nav">
                <div class="city_progress">
                  <div class="clearfix">
                    <span class="pull-left city_tit" id="city_name_5">Loading</span>
                    <small class="pull-right" id="city_percent_5">Loading</small>
                  </div>
                  <div class="progress no-margin">
                    <div class="progress-bar" id="city_bar_5"></div>
                  </div>
                </div>

              </div>
            </li>
          </ul>
        </div>
        <div class="sales-volume pull-left">
          <ul class="no-padding">
            <li id="city_6">
              <div class="product_num">7</div>
              <div class="product_nav">
                <div class="city_progress">
                  <div class="clearfix">
                    <span class="pull-left city_tit" id="city_name_6">Loading</span>
                    <small class="pull-right" id="city_percent_6"></small>
                  </div>
                  <div class="progress no-margin">
                    <div class="progress-bar" id="city_bar_6"></div>
                  </div>
                </div>

              </div>
            </li>
            <li id="city_7">
              <div class="product_num">8</div>
              <div class="product_nav">
                <div class="city_progress">
                  <div class="clearfix">
                    <span class="pull-left city_tit" id="city_name_7">Loading</span>
                    <small class="pull-right" id="city_percent_7">Loading</small>
                  </div>
                  <div class="progress no-margin">
                    <div class="progress-bar" id="city_bar_7"></div>
                  </div>
                </div>

              </div>
            </li>
            <li id="city_8">
              <div class="product_num">9</div>
              <div class="product_nav">
                <div class="city_progress">
                  <div class="clearfix">
                    <span class="pull-left city_tit" id="city_name_8">Loading</span>
                    <small class="pull-right" id="city_percent_8">Loading</small>
                  </div>
                  <div class="progress no-margin">
                    <div class="progress-bar" id="city_bar_8"></div>
                  </div>
                </div>

              </div>
            </li>
            <li id="city_9">
              <div class="product_num">10</div>
              <div class="product_nav">
                <div class="city_progress">
                  <div class="clearfix">
                    <span class="pull-left city_tit" id="city_name_9">Loading</span>
                    <small class="pull-right" id="city_percent_9">Loading</small>
                  </div>
                  <div class="progress no-margin">
                    <div class="progress-bar" id="city_bar_9"></div>
                  </div>
                </div>

              </div>
            </li>
            <li id="city_10">
              <div class="product_num">11</div>
              <div class="product_nav">
                <div class="city_progress">
                  <div class="clearfix">
                    <span class="pull-left city_tit" id="city_name_10">Loading</span>
                    <small class="pull-right" id="city_percent_10">Loading</small>
                  </div>
                  <div class="progress no-margin">
                    <div class="progress-bar" id="city_bar_10"></div>
                  </div>
                </div>

              </div>
            </li>
            <li id="city_11">
              <div class="product_num">12</div>
              <div class="product_nav">
                <div class="city_progress">
                  <div class="clearfix">
                    <span class="pull-left city_tit" id="city_name_11">Loading</span>
                    <small class="pull-right" id="city_percent_11">Loading</small>
                  </div>
                  <div class="progress no-margin">
                    <div class="progress-bar" id="city_bar_11"></div>
                  </div>
                </div>

              </div>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <div class="relitu">
      	<div class="relitu_select">
        <select id="citySelect"></select>
        <span class="pull-right" id="timeshow">0时</span>
      </div>
      <div id="mapContainer" style="background-color:rgba(0,0,0,0.5);width: 100%;height:100%;"></div>
    </div>
    </div>
  </div>
</section>

<!-- jQuery 2.2.0 -->
<script src="plugins/jQuery/jQuery-2.2.0.min.js"></script>
<!-- Bootstrap 3.3.6 -->
<script src="bootstrap/js/bootstrap.min.js"></script>
<!-- FastClick -->
<script src="plugins/fastclick/fastclick.js"></script>
<!-- AdminLTE App -->
<script src="dist/js/app.min.js"></script>
<!-- AdminLTE for demo purposes -->
<script src="dist/js/demo.js"></script>
<script src="dist/js/jquery.dataStatistics.js"></script>
<!-- Select2 -->
<script src="plugins/select2/select2.full.min.js"></script>
<!-- iCheck 1.0.1 -->
<script src="plugins/iCheck/icheck.min.js"></script>
<!-- page script -->
<script type="text/javascript" src="plugins/jquery.page.js"></script>
<script type="text/javascript" src="plugins/moment.min.js"></script>
<script type="text/javascript" src="plugins/daterangepicker/daterangepicker.js"></script>
<script type="text/javascript" src="../scripts/bidLibjsjquery3.0.js"></script>
<script type="text/javascript" src="../scripts/auto.js"></script>
<script src="https://pv.sohu.com/cityjson?ie=utf-8"></script>
<script language="javascript" src="../scripts/common/heatMap_color.js"></script>
<script>
  $(document).ready(function(){
//     $('.dataStatistics').dataStatistics({min:1,max:146,time:200000,len:8});
  });
  
  autodivheight();
  function autodivheight(){ //函数：获取尺寸
	//获取浏览器窗口高度
    var winHeight=0;
    var winWidth=0;
    if (window.innerHeight)
      winHeight = window.innerHeight;
    else if ((document.body) && (document.body.clientHeight))
      winHeight = document.body.clientHeight;
    //通过深入Document内部对body进行检测，获取浏览器窗口高度
    if (document.documentElement && document.documentElement.clientHeight)
      winHeight = document.documentElement.clientHeight;
    //DIV高度为浏览器窗口的高度
    //document.getElementById("carnival_c").style.height= winHeight +"px";
    document.getElementById("main1").style.height= winHeight/2 - 40 +"px";
    document.getElementById("main2").style.height= winHeight/2 - 60 +"px";
    document.getElementById("show").style.height= winHeight/2 - 120 +"px";
    document.getElementById("mapContainer").style.height= winHeight/2 - 80 +"px";
    document.getElementById("mapContainer2").style.height= winHeight/2 - 80 +"px";
  }
  window.onresize=autodivheight; //浏览器窗口发生变化时同时变化DIV高度

  //定义变量获取屏幕视口宽度
  var windowWidth = $(window).width();
  if(windowWidth < 1600){
    $(".time").css('margin-right','23%');
  }
  if(windowWidth >= 1600){
    $(".time").css('margin-right','28%');
  }
  
  /*热力图*/
  var map = new AMap.Map("mapContainer", {
    resizeEnable : true,
    //center :centerPosition,//创建中心点坐标
    zoom : 5,
  });
  map.setCity("北京");
  map.setMapStyle('amap://styles/'+"darkblue");
  
  /*滚动*/
  function startmarquee(lh, speed, delay) {
    var t;
    var oHeight = 210;/** div的高度 **/
    var p = false;
    var o = document.getElementById("show");
    var preTop = 0;
    o.scrollTop = 0;
    function start() {
      t = setInterval(scrolling, speed);
      o.scrollTop += 1;
    }
    function scrolling() {
      if (o.scrollTop % lh != 0
        && o.scrollTop % (o.scrollHeight - oHeight - 1) != 0) {
        preTop = o.scrollTop;
        o.scrollTop += 1;
        if (preTop >= o.scrollHeight || preTop == o.scrollTop) {
          o.scrollTop = 0;
        }
      } else {
        clearInterval(t);
        setTimeout(start, delay);
      }
    }
    setTimeout(start, delay);
  }
  window.onload=function(){
    /**startmarquee(一次滚动高度,速度,停留时间);**/
    startmarquee(60, 10, 1500);
  }
  
</script>
<!-- 引入 ECharts 文件 -->
<script src="dist/js/echarts.common.min.js"></script>
<script src="dist/js/china.js"></script>
<script>
  var myChart1 = echarts.init(document.getElementById('main1'));
  //初始化地图
  var mapChart = echarts.init(document.getElementById('main2'));
  const SHOW_LEVEL_CHINA = 'china';
  var openedProvinceMunicipality;
  $(document).ready(function () {
	showMap();
  	getBeatJson();
  	initMapParams();
  });
  var xData = function() {
    var data = [];
    for (var i = 0; i < 24; i++) {
      data.push(i + "时");
    }
    return data;
  }();
  
  option1 = {
    color: ['#16abfe','#ff7070'],
    tooltip: {
      trigger: 'axis',
      axisPointer: {
        type: 'cross',
        crossStyle: {
          color: '#999'
        }
      }
    },
    legend: {
      data: ['用户人数', 'GMV'],
      right:10,
      top:20,
      textStyle: {color: '#fff',},
    },
    grid: {
      left: '-10',
      right: '-30',
      top: '70',
      bottom: '0',
      containLabel: true
    },
    xAxis: [{
      type: 'category',
      boundaryGap: false,
      axisLabel:{
        textStyle: {color: '#fff'}
      },
      axisLine: {
        lineStyle: {color: '#000'}
      },
      axisTick:{show:false},
      data: xData,
    }],
    yAxis: [
      {
        type: 'value',
        //name: '用户人数',
        /*axisLabel: {
          formatter: '{value}'
        },*/
        splitLine:{show:false},
        axisLine:{show:false},
        axisLabel:{show:false},
        axisTick:{show:false}
      }, {
        type: 'value',
        //name: 'GMV',
        splitLine:{show:false},
        axisLine:{show:false},
        axisLabel:{show:false},
        axisTick:{show:false}
      },
    ],
    series: [{
      name: '用户人数',
      type: 'line',
      yAxisIndex: 0,
      data: userData,
      areaStyle: {
        normal: {
          color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{
            offset: 0,
            color: 'rgba(22, 171, 245,0.5)'
          }, {
            offset: 1,
            color: 'rgba(22, 171, 245,0.5)'
          }], false)
        }
      },
      itemStyle: {
          normal:{
            label: {
              show: true,
              position: 'top',
              formatter: '{c} ',
              //color:'#fff'
            },
          }
        },
    },
      {
        name: 'GMV',
        type: 'line',
        yAxisIndex: 1,
        smooth: true,
        data: gmvData,
        areaStyle: {
          normal: {
            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{
              offset: 0,
              color: 'rgba(254, 119, 119,0.5)'
            }, {
              offset: 1,
              color: 'rgba(254, 119, 119,0.5)'
            }], false)
          }
        },
        itemStyle: {
            normal:{
              label: {
                show: true,
                position: 'top',
                formatter: '{c} ',
                //color:'#fff'
              },
            }
          },
//         markPoint: {
//           show : true,
//           data: [
//             {name: '某个坐标',
//               coord: [10, 20]},
//           ]
//         },

      }
    ]
  };
  var showMap = function () {
	  var province = [];
		doManager("dynamicManager", "getAllOpenProvinces",[],
	            function(data, textStatus, XMLHttpRequest) {
	                if (data.result) {
	                    var resultJson= JSON.parse(data.data);
	                    $.each(eval(resultJson['province']), function (idx, val) {
		    				var object = new Object();
		    				object['province_id'] = val['province_id'];
		    				object['name'] = val['name'].replace("市","").replace("省","").replace("自治区","");
		    				//object['type'] = val['type'];
		    				if(val['selected']=='true'){
		    					object['selected'] = true;
		    					var object2 = new Object();
		    					object2['areaColor'] = '#3c3b3f';
		    					var object3 = new Object();
		    					object3['emphasis'] = object2;
		    					object['itemStyle'] = object3;
		    				}
		    				province.push(object);
		     			});
	                }
	            },false);
	    openedProvinceMunicipality = province;
  }
  var mapSeries = function(){
		var item = {
	                    type: 'map',
	                    coordinateSystem: 'geo',
	                    label: {
	                        normal: {
	                            show: false
	                        },
	                        emphasis: {
	                            show: false
	                        }
	                    },
	                    effect: {
			                show: true,
			                period: 6,
			                trailLength: 0,
			            },
	                    itemStyle: {
		                    normal: {
		                    areaColor: '#3c3b3f',
		                    //borderColor: '#fff'
	                  	},
		                  emphasis: {
		                    areaColor: '#3c3b3f'
		                  }
	                    },
	                    animation: false
	                }
	      return item;
	}
//地图显示属性设置
var mapOption = {
      tooltip: {
          trigger: 'item',
          formatter: "{b}"
      },
      animation: false,//设置切换时全国和省时不带闪动
      geo: {
	        map: 'china',
	        label: {
	            emphasis: {
	                show: true
	            }
	        },
	        //是否可以点击鼠标、滚轮缩放
	        roam: false,
	    },
      series:
          [
          ]
 };
var lineSeries = function(){
	var item = {
                name: 'rode',
                type: 'lines',
                coordinateSystem: 'geo',
                effect: {
                  show: true,
                  period: 6,
                  trailLength: 0,
                },
                lineStyle: {
                  normal: {
                    color: 'rgba(0,0,0,0)',
                    width: 1,
                    opacity: 0.4,
                    curveness: 0.2
                  }
                }
  	}
	return item;
}
var citySeries = function(){
	var item = {
                name: 'city',
                type: 'effectScatter',
                coordinateSystem: 'geo',
                symbolSize: 8,
				showEffectOn: 'render',
				rippleEffect: {
				  brushType: 'stroke'
				},
				hoverAnimation: true,
				label: {
				  normal: {
				    formatter: '{b}',
				    position: 'right',
// 				    show: true
				  }
				},
				itemStyle: {
				  normal: {
				    color: '#ff0000',
				    shadowBlur: 10,
				    shadowColor: '#ff0000'
				  }
				},
              }
      return item;
}
function getBeatJson(){
		doManager("dynamicManager", "getDailyFirstOrderCity",[], function (data, textStatus, XMLHttpRequest) {
	            if (data.result) {
	                var jsonData = JSON.parse(data.data);
	                beatData = jsonData;
	            }
	   }, false);
}
  var geoCoordMap = {
		    '海门':[121.15,31.89],
		    '鄂尔多斯':[109.781327,39.608266],
		    '招远':[120.38,37.35],
		    '舟山':[122.207216,29.985295],
		    '齐齐哈尔':[123.97,47.33],
		    '盐城':[120.13,33.38],
		    '赤峰':[118.87,42.28],
		    '青岛':[120.33,36.07],
		    '乳山':[121.52,36.89],
		    '金昌':[102.188043,38.520089],
		    '泉州':[118.58,24.93],
		    '莱西':[120.53,36.86],
		    '日照':[119.46,35.42],
		    '胶南':[119.97,35.88],
		    '南通':[121.05,32.08],
		    '拉萨':[91.11,29.97],
		    '云浮':[112.02,22.93],
		    '梅州':[116.1,24.55],
		    '文登':[122.05,37.2],
		    '上海':[121.48,31.22],
		    '攀枝花':[101.718637,26.582347],
		    '威海':[122.1,37.5],
		    '承德':[117.93,40.97],
		    '厦门':[118.1,24.46],
		    '汕尾':[115.375279,22.786211],
		    '潮州':[116.63,23.68],
		    '丹东':[124.37,40.13],
		    '太仓':[121.1,31.45],
		    '曲靖':[103.79,25.51],
		    '烟台':[121.39,37.52],
		    '福州':[119.3,26.08],
		    '瓦房店':[121.979603,39.627114],
		    '即墨':[120.45,36.38],
		    '抚顺':[123.97,41.97],
		    '玉溪':[102.52,24.35],
		    '张家口':[114.87,40.82],
		    '阳泉':[113.57,37.85],
		    '莱州':[119.942327,37.177017],
		    '湖州':[120.1,30.86],
		    '汕头':[116.69,23.39],
		    '昆山':[120.95,31.39],
		    '宁波':[121.56,29.86],
		    '湛江':[110.359377,21.270708],
		    '揭阳':[116.35,23.55],
		    '荣成':[122.41,37.16],
		    '连云港':[119.16,34.59],
		    '葫芦岛':[120.836932,40.711052],
		    '常熟':[120.74,31.64],
		    '东莞':[113.75,23.04],
		    '河源':[114.68,23.73],
		    '淮安':[119.15,33.5],
		    '泰州':[119.9,32.49],
		    '南宁':[108.33,22.84],
		    '营口':[122.18,40.65],
		    '惠州':[114.4,23.09],
		    '江阴':[120.26,31.91],
		    '蓬莱':[120.75,37.8],
		    '韶关':[113.62,24.84],
		    '嘉峪关':[98.289152,39.77313],
		    '广州':[113.23,23.16],
		    '延安':[109.47,36.6],
		    '太原':[112.53,37.87],
		    '清远':[113.01,23.7],
		    '中山':[113.38,22.52],
		    '昆明':[102.73,25.04],
		    '寿光':[118.73,36.86],
		    '盘锦':[122.070714,41.119997],
		    '长治':[113.08,36.18],
		    '深圳':[114.07,22.62],
		    '珠海':[113.52,22.3],
		    '宿迁':[118.3,33.96],
		    '咸阳':[108.72,34.36],
		    '铜川':[109.11,35.09],
		    '平度':[119.97,36.77],
		    '佛山':[113.11,23.05],
		    '海口':[110.35,20.02],
		    '江门':[113.06,22.61],
		    '章丘':[117.53,36.72],
		    '肇庆':[112.44,23.05],
		    '大连':[121.62,38.92],
		    '临汾':[111.5,36.08],
		    '吴江':[120.63,31.16],
		    '石嘴山':[106.39,39.04],
		    '沈阳':[123.38,41.8],
		    '苏州':[120.62,31.32],
		    '茂名':[110.88,21.68],
		    '嘉兴':[120.76,30.77],
		    '长春':[125.35,43.88],
		    '胶州':[120.03336,36.264622],
		    '银川':[106.27,38.47],
		    '张家港':[120.555821,31.875428],
		    '三门峡':[111.19,34.76],
		    '锦州':[121.15,41.13],
		    '南昌':[115.89,28.68],
		    '柳州':[109.4,24.33],
		    '三亚':[109.511909,18.252847],
		    '自贡':[104.778442,29.33903],
		    '吉林':[126.57,43.87],
		    '阳江':[111.95,21.85],
		    '泸州':[105.39,28.91],
		    '西宁':[101.74,36.56],
		    '宜宾':[104.56,29.77],
		    '呼和浩特':[111.65,40.82],
		    '成都':[104.06,30.67],
		    '大同':[113.3,40.12],
		    '镇江':[119.44,32.2],
		    '桂林':[110.28,25.29],
		    '张家界':[110.479191,29.117096],
		    '宜兴':[119.82,31.36],
		    '北海':[109.12,21.49],
		    '西安':[108.95,34.27],
		    '金坛':[119.56,31.74],
		    '东营':[118.49,37.46],
		    '牡丹江':[129.58,44.6],
		    '遵义':[106.9,27.7],
		    '绍兴':[120.58,30.01],
		    '扬州':[119.42,32.39],
		    '常州':[119.95,31.79],
		    '潍坊':[119.1,36.62],
		    '重庆':[106.54,29.59],
		    '台州':[121.420757,28.656386],
		    '南京':[118.78,32.04],
		    '滨州':[118.03,37.36],
		    '贵阳':[106.71,26.57],
		    '无锡':[120.29,31.59],
		    '本溪':[123.73,41.3],
		    '克拉玛依':[84.77,45.59],
		    '渭南':[109.5,34.52],
		    '马鞍山':[118.48,31.56],
		    '宝鸡':[107.15,34.38],
		    '焦作':[113.21,35.24],
		    '句容':[119.16,31.95],
		    '北京':[116.46,39.92],
		    '徐州':[117.2,34.26],
		    '衡水':[115.72,37.72],
		    '包头':[110,40.58],
		    '绵阳':[104.73,31.48],
		    '乌鲁木齐':[87.68,43.77],
		    '枣庄':[117.57,34.86],
		    '杭州':[120.19,30.26],
		    '淄博':[118.05,36.78],
		    '鞍山':[122.85,41.12],
		    '溧阳':[119.48,31.43],
		    '库尔勒':[86.06,41.68],
		    '安阳':[114.35,36.1],
		    '开封':[114.35,34.79],
		    '济南':[117,36.65],
		    '德阳':[104.37,31.13],
		    '温州':[120.65,28.01],
		    '九江':[115.97,29.71],
		    '邯郸':[114.47,36.6],
		    '临安':[119.72,30.23],
		    '兰州':[103.73,36.03],
		    '沧州':[116.83,38.33],
		    '临沂':[118.35,35.05],
		    '南充':[106.110698,30.837793],
		    '天津':[117.2,39.13],
		    '富阳':[119.95,30.07],
		    '泰安':[117.13,36.18],
		    '诸暨':[120.23,29.71],
		    '郑州':[113.65,34.76],
		    '哈尔滨':[126.63,45.75],
		    '聊城':[115.97,36.45],
		    '芜湖':[118.38,31.33],
		    '唐山':[118.02,39.63],
		    '平顶山':[113.29,33.75],
		    '邢台':[114.48,37.05],
		    '德州':[116.29,37.45],
		    '济宁':[116.59,35.38],
		    '荆州':[112.239741,30.335165],
		    '宜昌':[111.3,30.7],
		    '义乌':[120.06,29.32],
		    '丽水':[119.92,28.45],
		    '洛阳':[112.44,34.7],
		    '秦皇岛':[119.57,39.95],
		    '株洲':[113.16,27.83],
		    '石家庄':[114.48,38.03],
		    '莱芜':[117.67,36.19],
		    '常德':[111.69,29.05],
		    '保定':[115.48,38.85],
		    '湘潭':[112.91,27.87],
		    '金华':[119.64,29.12],
		    '岳阳':[113.09,29.37],
		    '长沙':[113,28.21],
		    '衢州':[118.88,28.97],
		    '廊坊':[116.7,39.53],
		    '菏泽':[115.480656,35.23375],
		    '合肥':[117.27,31.86],
		    '武汉':[114.31,30.52],
		    '大庆':[125.03,46.58],
		    '乌兰察布':[114.21,41.74],
		    '黔东南苗族侗族自治州':[107.38,26.55]
		};
//根据data得到每个data中城市的坐标
var convertData = function (data) {
      var res = [];
      for (var i = 0; i < data.length; i++) {
          var fromCoord = geoCoordMap[data[i]['name']];//获取城市的坐标 source
          var toCoord = geoCoordMap[data[i]['value']];//获取城市的坐标 destination
          if (fromCoord && toCoord) {
              res.push({
                  fromName: data[i]['name'],
                  toName: data[i]['value'],
                  coords: [fromCoord, toCoord]
              });
          }
      }
      return res;
 };
  //根据data得到放射光标效果图。如果起始城市没有值的话，就只显示目的城市
var convertData1 = function (data) {
      var res = [];
      for (var i = 0; i < data.length; i++) {
          var geoCoord = geoCoordMap[data[i]['name']];
          var geoCoord1 = geoCoordMap[data[i]['value']];
          if (geoCoord) 
          {
              res.push({
                  name: data[i]['name'],
                  value: geoCoord.concat(data[i]['value']),
                  selected:data[i]['selected'],
                  cityId:data[i]['cityId'],
                  province_id:data[i]['province_id'],
                  citycode:data[i]['citycode'],
                  keys:'beatPic'
              });
          }
          if(geoCoord1)
          {
              res.push({
                  name: data[i]['value'],
                  value: geoCoord1.concat(data[i]['name']),
                  selected:data[i]['selected'],
                  cityId:data[i]['cityId'],
                  province_id:data[i]['province_id'],
                  citycode:data[i]['citycode'],
                  keys:'beatPic'
              })
          }
      }
      return res;
  };
  function initMapParams(){
	  var item0 = mapSeries();
      mapOption.series.push(item0);
  	  mapOption.geo.map = SHOW_LEVEL_CHINA;
      mapOption.series[0].mapType = SHOW_LEVEL_CHINA;
      mapOption.series[0].data = openedProvinceMunicipality;
      var item1 = lineSeries();
      mapOption.series.push(item1);
      var item2 = citySeries();
      mapOption.series.push(item2);
      timer_china_beat = setInterval("nocease()","1000");
      mapChart.setOption(mapOption,true);
  }
  myChart1.setOption(option1);
  
//   myChart1.on("click",function(params){
//     var name = params.name;
//     var value = params.value;
//     var index = params.dataIndex;
//     var data = params.data;
//     console.info(name+"\n"+value+"\n"+index+"\n"+data);
//   });
  
  //判断pc浏览器是否缩放，若返回100则为默认无缩放，如果大于100则是放大，否则缩小
  function detectZoom (){
    var ratio = 0,
      screen = window.screen,
      ua = navigator.userAgent.toLowerCase();

    if (window.devicePixelRatio !== undefined) {
      ratio = window.devicePixelRatio;
    }
    else if (~ua.indexOf('msie')) {
      if (screen.deviceXDPI && screen.logicalXDPI) {
        ratio = screen.deviceXDPI / screen.logicalXDPI;
      }
    }
    else if (window.outerWidth !== undefined && window.innerWidth !== undefined) {
      ratio = window.outerWidth / window.innerWidth;
    }

    if (ratio){
      ratio = Math.round(ratio * 100);
    }

    return ratio;
  };
  //window.onresize 事件可用于检测页面是否触发了放大或缩小。
  $(function(){
    //alert(detectZoom())
  })
  $(window).on('resize',function(){
    isScale();
  });
  //判断PC端浏览器缩放比例不是100%时的情况
  function isScale(){
    var rate = detectZoom();
    if(rate != 100){
      //如何让页面的缩放比例自动为100,'transform':'scale(1,1)'没有用，又无法自动条用键盘事件，目前只能提示让用户如果想使用100%的比例手动去触发按ctrl+0
      console.log(1)
      //alert('当前页面不是100%显示，请按键盘ctrl+0恢复100%显示标准，以防页面显示错乱！')
    }
  }
  
  //阻止pc端浏览器缩放js代码
  //由于浏览器菜单栏属于系统软件权限，没发控制，我们着手解决ctrl/cammond + +/- 或 Windows下ctrl + 滚轮 缩放页面的情况，只能通过js来控制了
  // jqeury version
  $(document).ready(function () {
    // chrome 浏览器直接加上下面这个样式就行了，但是ff不识别
    $('body').css('zoom', 'reset');
    $(document).keydown(function (event) {
      //event.metaKey mac的command键
      if ((event.ctrlKey === true || event.metaKey === true)&& (event.which === 61 || event.which === 107 || event.which === 173 || event.which === 109 || event.which === 187  || event.which === 189)){
        event.preventDefault();
      }
    });
    $(window).bind('mousewheel DOMMouseScroll', function (event) {
      if (event.ctrlKey === true || event.metaKey) {
        event.preventDefault();
      }
    });
  });
  
 //一直要执行的函数
  function nocease(){
      var datas = [];
      getBeatData(datas,beatData);
      //随机取1-5
      //datas=dataArray[Math.floor(Math.random() * dataArray.length + 1)-1];
      var option = mapChart.getOption();
       if(datas[0].name)
      {
      option.series[1].data = convertData(datas);
      option.series[2].data = convertData1(datas);
      }
      else{
      option.series[1].data = null;
      option.series[2].data = convertData1(datas); 
      }
      mapChart.setOption(option,true);
  }
  var getBeatData = function(datas,jsonData){
		for(var i=1;i<jsonData['daily'].length;i++){
			var object = new Object();
			object.name = jsonData['daily'][i]['city_name'];
			object.value = jsonData['daily'][i-1]['city_name'];
			object.citycode = jsonData['daily'][i]['cityno'];
			object.selected = true;
			datas.push(object);
		};
	}
mapChart.setOption(mapOption,true);

  //格式化日期
  //格式化日期格式
Date.prototype.format=function(fmt) {        
    var o = {        
    "M+" : this.getMonth()+1, //月份        
    "d+" : this.getDate(), //日        
    "h+" : this.getHours()%12 == 0 ? 12 : this.getHours()%12, //小时        
    "H+" : this.getHours(), //小时        
    "m+" : this.getMinutes(), //分        
    "s+" : this.getSeconds(), //秒        
    "q+" : Math.floor((this.getMonth()+3)/3), //季度        
    "S" : this.getMilliseconds() //毫秒        
    };        
    var week = {        
    "0" : "\u65e5",        
    "1" : "\u4e00",        
    "2" : "\u4e8c",        
    "3" : "\u4e09",        
    "4" : "\u56db",        
    "5" : "\u4e94",        
    "6" : "\u516d"       
    };        
    if(/(y+)/.test(fmt)){        
        fmt=fmt.replace(RegExp.$1, (this.getFullYear()+"").substr(4 - RegExp.$1.length));        
    }        
    if(/(E+)/.test(fmt)){        
        fmt=fmt.replace(RegExp.$1, ((RegExp.$1.length>1) ? (RegExp.$1.length>2 ? "\u661f\u671f" : "\u5468") : "")+week[this.getDay()+""]);        
    }        
    for(var k in o){        
        if(new RegExp("("+ k +")").test(fmt)){        
            fmt = fmt.replace(RegExp.$1, (RegExp.$1.length==1) ? (o[k]) : (("00"+ o[k]).substr((""+ o[k]).length)));        
        }        
    }        
    return fmt;        
}
  
  
  $(function(){
	  timerData();
	  turnoverAndUserData();
	  initHourData();
	  initRollingInfoData();
	  initProductRankingData();
	  initEshopRankingData();
	  initCityRankingData();
	  timeTicket = setInterval(timerData, 1000);
	  timeTicket = setInterval(turnoverAndUserData, 3000);
	  timeTicket = setInterval(initHourData, 60000);
	  timeTicket = setInterval(initRollingInfoData, 60000);
	  timeTicket = setInterval(initProductRankingData, 300000);
	  timeTicket = setInterval(initEshopRankingData, 300000);
	  timeTicket = setInterval(initCityRankingData, 300000);
  });
  
  var festivalDate = new Date().format("yyyy-MM-dd");
  
  //左上角产品销量初化
  var productName = [];
  var productPrice = [];
  function initProductRankingData(){
		doManager("festivalStatManager","productRanking",[festivalDate],
			function(data,textStatus,XmlHttpRequest){
				if (data.result) {
					var jsonData = $.fromJSON(data.data);
					if(jsonData.length!=0){
						$(jsonData).each(function(index,element){
							productName[index] = element.product_name;
							productPrice[index] = element.product_count;
						});
						
						for(var i=0;i<5;i++){
							if(i<jsonData.length){
								$("#product_name_"+i).html(productName[i]);
								$("#product_price_"+i).html(productPrice[i]);
								var percent = Math.round(productPrice[i]/productPrice[0] * 10000) / 100.00;
								var bar = document.getElementById("product_bar_"+i);
								bar.style.width=percent.toFixed(0) + "%";
							}else{
								document.getElementById( "product_"+i).style.display= "none";
							}
						}
					}
				}
		});
	} 
  
  //左上角E店销售额初始化
  var eshopName = [];
  var eshopPrice = [];
  function initEshopRankingData(){
		doManager("festivalStatManager","eshopRanking",[festivalDate],
			function(data,textStatus,XmlHttpRequest){
				if (data.result) {
					var jsonData = $.fromJSON(data.data);
					if(jsonData.length!=0){
						$(jsonData).each(function(index,element){
							eshopName[index] = element.eshop_name;
							eshopPrice[index] = element.trading_price;
						});
						
						for(var i=0;i<5;i++){
							if(i<jsonData.length){
								$("#eshop_name_"+i).html(eshopName[i]);
								$("#eshop_price_"+i).html("￥"+eshopPrice[i]);
								var percent = Math.round(eshopPrice[i]/eshopPrice[0] * 10000) / 100.00;
								var bar = document.getElementById("eshop_bar_"+i);
								bar.style.width=percent.toFixed(0) + "%";
							}else{
								document.getElementById( "eshop_"+i).style.display= "none";
							}
						}
					}
				}
		});
	} 
  
  //大屏数字初始化
  var fix_time = "2018-05-18 23:59:59";//固定截止时间
  var now_time;
  function timerData(){
	  if(new Date() > new Date(fix_time)){
		  now_time = new Date(fix_time);
		  window.clearInterval(timeTicket);
		  window.clearInterval(mapTimeTicket);
	  }else{
		  now_time = new Date();
	  }
	  $("#now_time").html((now_time.getHours() < 10 ? '0' + now_time.getHours():now_time.getHours())+":"+(now_time.getMinutes() < 10 ? '0' + now_time.getMinutes():now_time.getMinutes())+":"+(now_time.getSeconds() < 10 ? '0' + now_time.getSeconds():now_time.getSeconds()));
  }
  
  function turnoverAndUserData(){
	  var total_price = '0';
	  doManager("festivalStatManager","queryTurnover",[festivalDate],
		function(data,textStatus,XmlHttpRequest){
			if (data.result) {
				var jsonData = $.fromJSON(data.data);
				if(Object.keys(jsonData).length!=0){
					total_price = jsonData.trading_price;
				}
				total_price = total_price + '';
				if(total_price.indexOf(".")>0){
					total_price = total_price.substring(0,total_price.lastIndexOf("."));
				}
				if(total_price.length>8){
					dojob(total_price.substring(0,total_price.length)); 
				}else{
					total_price = "000000000"+total_price;
					dojob(total_price.substring(total_price.length-9,total_price.length)); 
				}
			}
		}); 
	  
	  var pay_customer = '0';
	  doManager("festivalStatManager","queryPayUser",[festivalDate],
		function(data,textStatus,XmlHttpRequest){
			if (data.result) {
				var jsonData = $.fromJSON(data.data);
				if(Object.keys(jsonData).length!=0){
					pay_customer = jsonData.pay_customer;
				}
				$("#pay_customer").html(pay_customer);
			}
		},false); 
	  
	  var vip_customer = '0';
	  doManager("festivalStatManager","queryNewVipCusUser",[festivalDate],
		function(data,textStatus,XmlHttpRequest){
			if (data.result) {
				var jsonData = $.fromJSON(data.data);
				vip_customer = jsonData.length;
				$("#vip_customer").html(vip_customer);
			}
		}); 
  }
  
  var ns=[];
  var changeno="";
  var srcnumber = "";
  function dojob(now_number){
		 //$(".dataStatistics").html("");
	  	 var ths = $(".dataStatistics");//解决this指向问题
	        var html = '<div class="digit">' +
		      '  <div class="digit_top">' +
		      '    <span class="digit_wrap"></span>' +
		      '  </div>' +
		      '  <div class="shadow_top"></div>' +
		      '  <div class="digit_bottom">' +
		      '    <span class="digit_wrap"></span>' +
		      '  </div>' +
		      '  <div class="shadow_bottom"></div>' +
		      '</div>';
	          
		      var htmlactive = '<div class="digit active">' +
		      '  <div class="digit_top">' +
		      '    <span class="digit_wrap"></span>' +
		      '  </div>' +
		      '  <div class="shadow_top"></div>' +
		      '  <div class="digit_bottom">' +
		      '    <span class="digit_wrap"></span>' +
		      '  </div>' +
		      '  <div class="shadow_bottom"></div>' +
		      '</div>';
	        var htmlprevious = '<div class="digit previous active">' +
		      '  <div class="digit_top">' +
		      '    <span class="digit_wrap"></span>' +
		      '  </div>' +
		      '  <div class="shadow_top"></div>' +
		      '  <div class="digit_bottom">' +
		      '    <span class="digit_wrap"></span>' +
		      '  </div>' +
		      '  <div class="shadow_bottom"></div>' +
		      '</div>';
		      
	          var nowNums=now_number.split("");
	          
	          changeno="";
	          for(var i=0;i<9;i++){
	        	  if(nowNums[i]!=ns[i]){
	        		  ns[i]=nowNums[i];
	        		  changeno+=i+"";
	        	  }
	          }
	        //alert(changeno); 
	          var isbefore = true;//标记第一位是否0,0显示空
	          var countsign = 1;
		      ths.find('.digit_set').each(function(index,obj) {
		    	    $(this).empty();
		    	    if(srcnumber!=now_number&&changeno.indexOf(index)>-1){//如果相等  样式不变 
		    	    	$(this).append(htmlactive);
		    	    	$(this).append(htmlprevious);
		    	    }else{
		    	    	$(this).append(html);
		    	    }
		    	    
		            var nowNumber = nowNums[index]; 
		            if(nowNumber==0&&isbefore){
		            	nowNumber="";
		            	$(this).hide();
		            }else{
		            	isbefore=false;
		            	$(this).show();
		            }
		            if(index==8&&nowNumber==""){
		            	nowNumber="0";
		            	$(this).show();
		            }
		            countsign++;
		            if(nowNumber!=""){
		            	$(this).find('.digit_wrap').append(nowNumber);
		            }
		      });
		      srcnumber=now_number;
	  		  if(parseInt(now_number)<1000000){
	  			  $("#dou1").hide();
	  			  if(parseInt(now_number)<1000){
	  				$("#dou2").hide();
	  			  }else{
	  				$("#dou2").show();
	  			  }
	  		  }else{
	  			$("#dou1").show();
	  			$("#dou2").show();
	  		  } 
	}
  
  //GMV/用户K线图初始化
  var gmvData = [];
  var userData = [];
  function initHourData(){
  		var nowHour = new Date().getHours();
  		
 		doManager("festivalStatManager","queryTurnoverByHour",[festivalDate],
 			function(data,textStatus,XmlHttpRequest){
 				if (data.result) {
 					gmvData=new Array(nowHour+2).join(0).split('');
 					var jsonData = $.fromJSON(data.data);
 					if(jsonData.length!=0){
 						$(jsonData).each(function(index,element){
 							gmvData[parseInt(element.time)]=element.trading_price;
 							if(parseInt(element.time)>0){
 								gmvData[parseInt(element.time)]+=gmvData[parseInt(element.time)-1];
 							}
 	                     });
 						option1.series[1].data=gmvData;
 						myChart1.setOption(option1);
 					}else{
 						gmvData = [];
 						option1.series[1].data=gmvData;
 						myChart1.setOption(option1);
 					}
 				}
 		});
 		
 		doManager("festivalStatManager","queryUserByHour",[festivalDate],
 			function(data,textStatus,XmlHttpRequest){
 				if (data.result) {
 					userData=new Array(nowHour+2).join(0).split('');
 					var jsonData = $.fromJSON(data.data);
 					if(jsonData.length!=0){
 						$(jsonData).each(function(index,element){
 							userData[parseInt(element.time)]=element.pay_customer;
 							if(parseInt(element.time)>0){
 								userData[parseInt(element.time)]+=userData[parseInt(element.time)-1];
 							}
 	                     });
 						option1.series[0].data=userData;
 						myChart1.setOption(option1);
 					}else{
 						userData = [];
 						option1.series[0].data=userData;
 						myChart1.setOption(option1);
 					}
 				}
 		});
 	}
  
  //滚动信息
  function initRollingInfoData(){
	  
	  var vipCustomer = [];
	  doManager("festivalStatManager","queryNewVipCusUser",[festivalDate],
		function(data,textStatus,XmlHttpRequest){
			if (data.result) {
				var jsonData = $.fromJSON(data.data);
				vipCustomer = jsonData;
			}
		},false); 
	  
	  doManager("festivalStatManager","queryRecentlyOrder",[festivalDate],
		function(data,textStatus,XmlHttpRequest){
			if (data.result) {
				var jsonData = $.fromJSON(data.data);
				if(jsonData.length!=0){
					var infoStr = "";
					$(jsonData).each(function(index,element){
						var indexTemp = jQuery.inArray(element.customer_id,vipCustomer);
						if(indexTemp >=0 ){
							infoStr = infoStr + "<li class=\"bar_bf\"><i class=\"fa fa-file-text-o\"></i><span>"+element.buy_time+"</span><span><b>"+element.mobilephone+"</b></span>的用户在<span>"+element.city_name+"</span><span>"+element.eshop_name+"</span>购买了"+(element.quantity)+(element.unit)+(element.eshop_pro_name)+"</li>";
						}else{
							infoStr = infoStr + "<li class=\"bar_order\"><i class=\"fa fa-file-text-o\"></i><span>"+element.buy_time+"</span><span><b>"+element.mobilephone+"</b></span>的用户在<span>"+element.city_name+"</span><span>"+element.eshop_name+"</span>购买了"+(element.quantity)+(element.unit)+(element.eshop_pro_name)+"</li>";
						}
					});
					$("#roll_info").append(infoStr);  
				}
			}
	});
  }
  
  
  //右上角营业额城市占比初始化
  var cityName = [];
  var cityPrice = [];
  function initCityRankingData(){
		doManager("festivalStatManager","cityRanking",[festivalDate],
			function(data,textStatus,XmlHttpRequest){
				if (data.result) {
					var jsonData = $.fromJSON(data.data);
					if(jsonData.length!=0){
						$(jsonData).each(function(index,element){
							cityName[index] = element.city_name;
							cityPrice[index] = element.trading_price;
						});
						var total_price = 0;
						for(var i=0;i<jsonData.length;i++){
							total_price = total_price + cityPrice[i];
						}
						for(var i=0;i<12;i++){
							if(i<jsonData.length){
								$("#city_name_"+i).html(cityName[i]);
								var percent = Math.round(cityPrice[i]/total_price * 10000) / 100.00;
								$("#city_percent_"+i).html(percent.toFixed(0) + "%");
								var bar = document.getElementById("city_bar_"+i);
								bar.style.width=percent.toFixed(0) + "%";
							}else{
								document.getElementById( "city_"+i).style.display= "none";
							}
						}
					}
				}
		});
	}  
  
  
  	//热力图初始化
  	var mapTimeTicket;
  	var firstDate = new Date();
	var h = firstDate.getHours()-firstDate.getHours();
	firstDate.setHours(h);
	var bdate = firstDate.format('yyyy/MM/dd HH:mm');
	//热力图
	var map = new AMap.Map("mapContainer", {
	    resizeEnable : true,
	    //center :centerPosition,//创建中心点坐标
	    zoom : 5,
	});
	map.setCity("北京");
	map.setMapStyle('amap://styles/'+"darkblue");
	//国安侠动态图
	var map2 = new AMap.Map("mapContainer2", {
	    resizeEnable : true,
	    //center :centerPosition,//创建中心点坐标
	    zoom : 5,
	});
	map2.setCity("北京");
	map2.setMapStyle('amap://styles/'+"darkblue");
	
	//FestivalStatManager
	$(function(){
		getCity();
		initData();
		mapTimeTicket = setInterval(nowTimeData, 2000);
		getEmployeeDriverRecodeRealtime();
		$("#citySelect").change(function(){
			map.clearMap();
			var cityname = $("#citySelect option:selected").html();
			map.setCity(cityname);
			var timeH = firstDate.getHours();
			firstDate.setHours(timeH-timeH)
			bdate = firstDate.format('yyyy/MM/dd HH:mm');
			initData();
		});
		$("#citySelect2").change(function(){
			map2.clearMap();
			var cityname = $("#citySelect2 option:selected").html();
			map2.setCity(cityname);
			getEmployeeDriverRecodeRealtime();
			
		});
		
	
	})
	
	
	//判断浏览区是否支持canvas
	function isSupportCanvas() {
	    var elem = document.createElement('canvas');
	    return !!(elem.getContext && elem.getContext('2d'));
	}
	
	var heatmap;
	function initData(){
		var cityno = $("#citySelect option:selected").val();
		var timeshow = firstDate.getHours()
		$("#timeshow").html(timeshow+"时");
		doManager("festivalStatManager", "queryOrderHeatInfo",[bdate,cityno], function(data, textStatus,XMLHttpRequest) {
	        if(data.result){
	        	jsonData = JSON.parse(data.data);
	        	if (!isSupportCanvas()) {
	        	    alert('热力图仅对支持canvas的浏览器适用,您所使用的浏览器不能使用热力图功能,请换个浏览器试试~')
	        	}
	        	map.plugin(["AMap.Heatmap"], function() {
	        	    //初始化heatmap对象
	        	    heatmap = new AMap.Heatmap(map, {
	        	        radius: 20, //给定半径
	        	        opacity: [0, 1]
	        	        ,gradient:{
	        	         0.5: 'blue',
	        	         0.65: 'rgb(117,211,248)',
	        	         0.7: 'rgb(0, 255, 0)',
	        	         0.9: '#ffea00',
	        	         1.0: 'red'
	        	         }
	        	    });
	        	    heatmap.setDataSet({
	        	        data: jsonData,
	        	        max:20
	        	    });
	        		heatmap.setMap(map);
	        		heatmap.show();
	        	});
	        }else{
	        	crm_alert(0,"数据加载异常！");
	        }
	    },false); 
	}
	
	
	
	var nowTimeData = function(){
		var timeH = firstDate.getHours()+1;
		firstDate.setHours(timeH);
		bdate = firstDate.format('yyyy/MM/dd HH:mm');
		if(timeH > new Date().getHours()){
			window.clearInterval(mapTimeTicket);
			setTimeout(function(){
				heatmap.setDataSet({
			        data: {}
			    });
				firstDate.setHours(timeH-timeH);
				mapTimeTicket = setInterval(nowTimeData, 2000);
				initData();
			},15000);
			
		}else{
			heatmap.setDataSet({
		        data: {}
		    });
			initData();
		}
		
	}
  
	//获得城市列表
	function getCity(){
		   doManager("chartStatManager","queryContainsStoreDistCityList",null,
			    function(data,textStatus,XmlHttpRequest){
					if (data.result) {
						var jsonData = $.fromJSON(data.data);
						$(jsonData).each(function(index,element){
							$("#citySelect").append('<option value="'+element.cityno+'">'+element.cityname+'</option>');
							$("#citySelect2").append('<option value="'+element.cityno+'">'+element.cityname+'</option>');
							if(element.cityname == "北京"){
								$("#citySelect opation:eq("+index+")").attr("selected",true);
							}
	                   });
					}
			},false);
	}
	
	var maxlocationIndex = 0;
	var diverRecodeArray = new Array();
	function getEmployeeDriverRecodeRealtime(){
		var cur_city = $("#citySelect2 option:selected").val();
		map2.clearMap();
		diverRecodeArray = [];
		maxlocationIndex = 0;
		requestInfoDto = {//城市
				cityno: cur_city,
		        beginDate:new Date().format('yyyy/MM/dd')+" 00:00",
		        endDate:new Date().format('yyyy/MM/dd HH:mm')
		}
		
		doManager("festivalStatManager", "empdiver",[requestInfoDto], function(data, textStatus,XMLHttpRequest) {
			
			if(data.result){
	        	var jsonData = JSON.parse(data.data);
	    		if(typeof(jsonData) != "undefined"){
	    			diverRecodeArray = jsonData.data; 
	    		}
	    		if(diverRecodeArray != null && diverRecodeArray.length > 0){
	    			var diverPolyline;
	    			var marker;
	    			for(var i = 0; i < diverRecodeArray.length; i++){
	    				var empDiver = diverRecodeArray[i];
	    				var locations = empDiver.locations;
	    				var platformid = empDiver.platformid;
	    				var employeeId = empDiver.id;
	    				var online = empDiver.online;
	    				var length = locations.length;
	    				if(maxlocationIndex < length){
	    					maxlocationIndex = length;
	    				}
  						var locationIndex = 0;
						var diverPolyline =  drawEmployeeDiverPolyline(locations[locationIndex]);
        				empDiver["polyline"] = diverPolyline;
        				var marker = drawEmployeePosition(locations[locationIndex],empDiver);
         				empDiver["marker"] = marker;
         				locationIndex++;
         				empDiver["locationIndex"] = locationIndex;
   					}
	    		}
	    		var timeshow = 0;
	    		var timeIndex = parseInt(maxlocationIndex/new Date().getHours());
	    		setTimeout(function(){
	    			console.log(maxlocationIndex);
	    			 for(var z = 0; z < maxlocationIndex; z++){
	    				 (function(){
	    					 var x = z;
	    				 setTimeout(function (){
	    					 console.log(new Date());
		    					 /* if(x%timeIndex == 0){
		    						 timeshow++;
		    						 if(timeshow <= new Date().getHours()){
		    							 $("#timeshow2").html(timeshow+"时"); 
		    						 }else{
		    							 $("#timeshow2").html(0+"时") 
		    						 }
		    						 
		    					 } */
	    						for(var i = 0; i < diverRecodeArray.length; i++){
	    							var empDiver = diverRecodeArray[i];
	    							var locations = empDiver.locations;
	    							var platformid = empDiver.platformid;
	    							var employeeId = empDiver.id;
	    							var online = empDiver.online;
	    							var length = locations.length;
	    							var locationIndex = empDiver.locationIndex;
	    							var marker = empDiver.marker;
	    							var polyline = empDiver.polyline;
	    							if(typeof(marker) != "undefined" && typeof(polyline) != "undefined"){
	    								if(length > locationIndex){
	    									empDiver.marker.setPosition(locations[locationIndex]);
	    									empDiver.polyline.getPath().push(locations[locationIndex]);
	    									empDiver.polyline.setPath(empDiver.polyline.getPath());
	    									empDiver.locationIndex++;
	    								}
	    							}
	    						}
	    						console.log(x);
	    						if(x == maxlocationIndex - 1){
	    							if(cur_city == $("#citySelect2 option:selected").val()){
	    								getEmployeeDriverRecodeRealtime();
	    							}
	    					 	}
	    					},z*200);
	    				 })();
	    			}
	    		},1000);
	        }else{
	        	crm_alert(0,"数据加载异常！");
	        }
	    });		
		
	}
	
	//画国安侠线路图
	var drawEmployeeDiverPolyline = function(diverLocations){
		var diverPolyline = new AMap.Polyline({
	        path: diverLocations,          //设置线覆盖物路径
	        strokeColor: "#042eff", //线颜色
	        strokeOpacity: 0.8,       //线透明度
	        strokeWeight: 0.8,        //线宽
	        strokeStyle: "solid"   //线样式
	    });
		diverPolyline.setMap(map2);
		return diverPolyline;
	}
	
	//画国安侠坐标位置
	var drawEmployeePosition = function(diverLocations,employeeInfo,online){
		var marker = new AMap.Marker({
			 map:map2,
			 icon:"dist/518img/518gaxlogo3.png",
			 position: diverLocations,
			 offset: new AMap.Pixel(-10, -20),
			 /* extData:{
				 "storeName":employeeInfo.storeName,
				 "employeeName":employeeInfo.employeeName,
				 "employeeNo":employeeInfo.employeeNo
			 } */
		 });
		/* if(marker != null){
			marker.on("mouseover",function(e){
				 //实例化信息窗体
				    var title = '门店名称：'+e.target.getExtData().storeName,
				        content = [];
				    content.push("员工姓名："+e.target.getExtData().employeeName);
				    var empno = e.target.getExtData().employeeNo;
				    if(typeof(empno) == "undefined"){
				    	content.push("员工编号："+"暂无");
				    }else{
				    	content.push("员工编号："+e.target.getExtData().employeeNo);
				    }
				    var infoWindow = new AMap.InfoWindow({
				        isCustom: true,  //使用自定义窗体
				        content: createInfoWindow(title, content.join("<br/>")),
				        offset: new AMap.Pixel(16, -45)
				    });
				 	infoWindow.open(map, e.target.getPosition());
			 })
			 marker.on("mouseout",function(e){
				 closeInfoWindow();
			 });
		} */
		return marker;
	}
</script>
</body>
</html>