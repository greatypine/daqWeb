<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>221专题</title>
  <!-- Tell the browser to be responsive to screen width -->
  <link rel="shortcut icon" type="image/x-icon" href="../icon.png" />
  <meta content="width=device-width, initial-scale=0.3, maximum-scale=1, user-scalable=yes" name="viewport">  <!-- Bootstrap 3.3.6 -->
  <link rel="stylesheet" href="plugins/gooey_menu/gooey.min.css">
  <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="bootstrap/css/font-awesome.min.css">
  <!-- Ionicons -->
  <link rel="stylesheet" href="bootstrap/css/ionicons.min.css">
  <!-- Morris charts -->
  <link rel="stylesheet" href="plugins/morris/morris.css">
  <!-- Theme style -->
  <link rel="stylesheet" href="dist/css/AdminLTE.min.css">
  <!-- AdminLTE Skins. Choose a skin from the css/skins
       folder instead of downloading all of them to reduce the load. -->
  <link rel="stylesheet" href="dist/css/skins/_all-skins.min.css">
   <link rel="stylesheet"  href="dist/css/lightslider.css"/>
  <link rel="stylesheet" href="plugins/daterangepicker/daterangepicker-bs3.css">
  <!-- Select2 -->
  <link rel="stylesheet" href="plugins/select2/select2.min.css">
  <link href="../scripts/css/auto.css" rel="stylesheet">
  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
  <script src="IE 9/html5shiv.min.js"></script>
  <script src="IE 9/respond.min.js"></script>
  <![endif]-->
  <style>
 .box-body img{width: 100%}
	.details{background-color: #ff7d73; padding: 10px 0 10px 0; color: #fff;}
    .details small{opacity: 0.6}
    .small-box .icon{top: 5px; font-size: 70px;}
    .small-box:hover .icon{font-size: 80px;}
    .detail_tomorrow{font-size: 16px; opacity: 0.8; margin-top: 10px;}
    .detail_tomorrow span{padding-left: 15px;}
    .detail_tomorrow i{padding-right: 5px;}
    .lightslider{line-height: 36px; margin-top: 20px;}
    .lightslider h4 span{font-size: 14px;}
    .lightslider span{font-size: 24px;}
    .demo ul li{padding: 0 40px;}
    .demo{ background-color: rgba(90,114,147,1); border-radius: 10px; box-shadow: 0 5px 5px rgba(0,0,0,0.3); padding: 20px 0; position: relative; overflow: hidden;}
    .demo .yuan{position: absolute; background-color: #f97487; width: 80px; height: 80px; border-radius: 50px; right: -40px; top: -40px; padding: 45px 0 0 30px; transform: rotate(45deg);}
    .nav-tabs-custom,.nav-tabs-custom > .tab-content{background: transparent;}
    .nav-tabs-custom > .nav-tabs > li > a{ margin: 10px 0; font-size: 18px;}
    .nav-tabs-custom > .nav-tabs > li > a:hover{ margin: 10px 0;color: #f39c12;}
    .nav-tabs-custom > .nav-tabs > li.active > a,.nav-tabs-custom > .nav-tabs > li.active > a:hover{background: transparent; color: #f39c12; border-bottom: 2px solid #f39c12; font-weight: bold; cursor: pointer;}
    .nav-tabs-custom > .nav-tabs{margin: 0 auto; width: 450px;}
	
    .vertical-example{position: absolute; top: 70px; right: 30px; width: 100px;}
    .navimenu{min-height: 800px; padding-top: 0;}
    #gooey-v .open-button, #gooey-v .gooey-menu-item{margin-top: 0; margin-bottom: 15em;}
      #process_div{ 
		background-color:#292a2b; 
		display:inline; 
		z-index:100000;  
		left:0px; 
		opacity:0.3; top:0; left:0;height:100%; width:100%; z-index:999; position:fixed; _position:absolute; _left: expression_r(documentElement.scrollLeft + documentElement.clientWidth - this.offsetWidth); _top: expression_r(documentElement.scrollTop + documentElement.clientHeight - this.offsetHeight);
		filter:Alpha(Opacity=30); 
		opacity: 0.3; 
	} 
	
	#process_div_pic{
		position:fixed;
		top:50%;
		left:50%; 
		z-index:100000000; 
		margin:-16px 0 0 -50px; 
		width:100px; 
		height:32px;
		color: #fff;
	}
    
  </style>
</head>
<body class="hold-transition skin-blue sidebar-mini">
<!-- Site wrapper -->
<div class="wrapper">
<header class="main-header">
    <nav class="navbar navbar-static-top">
      <div class="container">
			<div class="logo_img pull-left">
				<img src="dist/img/logo.png" height="30">
				<img src="dist/img/title.png" height="20">
			</div>
			<div class="pull-left">
				<div class="logo-lg">
					<ul class="no-margin">
						<li class="current"><em>221专题</em></li>
					</ul>
				</div>
			</div>
      </div>
    </nav>
  </header>
  
  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
    <div class="container">
      <!-- Main content -->
      
      <div class="nav-tabs-custom">
       <ul class="nav nav-tabs">
         <li class="active"><a href="javascript:void(0);" data-toggle="tab">211合计</a></li>
         <li style="padding-top: 20px; color: rgba(0,0,0,0.3)">\</li>
         <li><a href="javascript:void(0);" onclick="toBussiness()" data-toggle="tab">211分业务</a></li>
         <li style="padding-top: 20px; color: rgba(0,0,0,0.3)">\</li>
         <li><a href="javascript:void(0);" onclick="toStore()" data-toggle="tab">221单店</a></li>
       </ul>
      
      <section class="content-header">
        <div class="box box-default details">
          <div class="box-body">
          	<div class="col-sm-12">
          		<h4><b>211服务范围：<span>96店</span></b></h4>
              	<small>产品范围：商品类+服装类+团购</small>
          	</div>
          	<div class="col-sm-6">
              <h5 style="color: #7c4139;">整体完成情况</h5>
              <div class="pull-left col-sm-6">
                <div class="small-box bg-aqua-active">
                  <div class="inner">
                    <h3><sup style="font-size: 20px" id="totalGmv">载入中...</sup></h3>
                    <p>累计GMV</p>
                  </div>
                  <div class="icon">
                    <i class="fa fa-cny"></i>
                  </div>
                  <a href="#" class="small-box-footer">More info <i class="fa fa-arrow-circle-right"></i></a>
                </div>
              </div>
              <div class="pull-left col-sm-6">
                <div class="small-box bg-teal-active">
                  <div class="inner">
                    <h3><sup style="font-size: 20px" id="avgGmv">载入中...</sup></h3>
                    <p>店均GMV</p>
                  </div>
                  <div class="icon">
                    <i class="fa fa-database"></i>
                  </div>
                  <a href="#" class="small-box-footer">More info <i class="fa fa-arrow-circle-right"></i></a>
                </div>
              </div>
<!--               <div class="col-sm-6 detail_tomorrow"><i class="fa fa-credit-card"></i>累计GMV<span id="totalGmv">载入中...</span></div> -->
              <div class="col-sm-6 detail_tomorrow"><i class="fa fa-users"></i>累计社员<span id="memberNum">载入中...</span></div>
            </div>
<!--             <div class="col-sm-6 lightslider"> -->
<!--               <div class="demo"> -->
<!--                 <div class="item"> -->
<!--                   <div class="clearfix" style="max-width:474px;"> -->
<!--                     <ul id="image-gallery" class="gallery list-unstyled cS-hidden"> -->
<!--                     </ul> -->
<!--                   </div> -->
<!--                 </div> -->
<!--               </div> -->
<!--             </div> -->
            <div class="col-sm-6">
              <h5 style="color: #7c4139;">昨日完成情况</h5>
              <div class="col-sm-6 detail_tomorrow"><i class="fa fa-credit-card"></i>合计GMV：<span id="yestodayTotalGmv">载入中...</span></div>
              <div class="col-sm-6 detail_tomorrow"><i class="fa fa-credit-card"></i>商品类GMV：<span id="yestodayProductGmv">载入中...</span></div>
              <div class="col-sm-6 detail_tomorrow"><i class="fa fa-credit-card"></i>服务类GMV：<span id="yestodayServiceGmv">载入中...</span></div>
              <div class="col-sm-6 detail_tomorrow"><i class="fa fa-credit-card"></i>团购GMV：<span id="yestodayGrouponGmv">载入中...</span></div>
            </div>
          </div>
        </div>
       <div class="box box-default">
          <div class="box-body">
          	<div class="col-sm-6 no-padding" id="main5" style="height: 350px;"></div>
          	<div class="col-sm-6 no-padding" id="main1" style="height: 350px;"></div>
          </div>
        </div>
       <div class="box box-default">
          <div class="box-body">
          	<div class="col-sm-12 no-padding" id="main4" style="height: 350px;"></div>
          </div>
        </div>
        <div class="box box-default">
          <div class="box-body">
            <div class="col-sm-12 no-padding" id="main3" style="height: 350px;"></div>
          </div>
        </div>
        <div class="box box-default">
          <div class="box-body">
            <div class="col-sm-6" style="height: 460px;">
              <h4 class="text-red">【商品类】门店排名Top10</h4>
              <table class="table table-bordered">
                <tbody id="yyPro_data">
	                <tr>
	                  <th>门店名称</th>
	                  <th>GMV</th>
	                  <th>占比</th>
	                </tr>
                </tbody>
              </table>
            </div>
            <div class="col-sm-6" style="height: 460px;">
              <h4 class="text-light-blue">【服务类】门店排名Top10</h4>
              <table class="table table-bordered">
                <tbody id="jwsPro_data">
	                <tr>
	                  <th>门店名称</th>
	                  <th>GMV</th>
	                  <th>占比</th>
	                </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
        <div class="box box-default">
          <div class="box-body">
          	<div class="col-sm-12" style="height: 460px;">
              <h4 class="text-red">【团购类】门店排名Top10</h4>
              <table class="table table-bordered">
                <tbody id="grouponPro_data">
	                <tr>
	                  <th>门店名称</th>
	                  <th>GMV</th>
	                  <th>占比</th>
	                </tr>
                </tbody>
              </table>
            </div>
<!--             <div class="col-sm-6" id="main1" style="height: 450px;"></div> -->
          </div>
        </div>
      </section>
      </div>
    </div>
  </div>
</div>
<!-- ./wrapper -->

<!-- jQuery 2.2.0 -->
<script src="plugins/jQuery/jQuery-2.2.0.min.js"></script>
<!-- Bootstrap 3.3.6 -->
<script src="bootstrap/js/bootstrap.min.js"></script>
<!-- FastClick -->
<script src="plugins/fastclick/fastclick.js"></script>
<!-- AdminLTE App -->
<script src="dist/js/app.min.js"></script>
<!-- AdminLTE for demo purposes -->
<script src="dist/js/demo.js"></script>
<script src="dist/js/nav-scroll.js"></script>
<script src="dist/js/lightslider.js"></script>
<!-- Select2 -->
<script src="plugins/select2/select2.full.min.js"></script>
<!-- iCheck 1.0.1 -->
<script src="plugins/iCheck/icheck.min.js"></script>
<!-- page script -->
<script type="text/javascript" src="plugins/jquery.page.js"></script>
<script type="text/javascript" src="plugins/moment.min.js"></script>
<script type="text/javascript" src="plugins/daterangepicker/daterangepicker.js"></script>
<script type="text/javascript" src="../scripts/bidLibjsjquery3.0.js"></script>
<script type="text/javascript" src="../scripts/auto.js"></script>
<script src="https://pv.sohu.com/cityjson?ie=utf-8"></script>
<script src="bootstrap/js/raphael-min.js"></script>
<script src="plugins/morris/morris.min.js"></script>
<script src="plugins/gooey_menu/gooey.min.js"></script>
<script type ="text/javascript">

	$(document).ready(function() {
// 	    $("#content-slider").lightSlider({
// 	      loop:true,
// 	      keyPress:true
// 	    });
// 	    $('#image-gallery').lightSlider({
// 	      gallery:true,
// 	      item:1,
// 	      thumbItem:9,
// 	      slideMargin: 0,
// 	      speed:500,
// 	      auto:true,
// 	      loop:true,
// 	      onSliderLoad: function() {
// 	        $('#image-gallery').removeClass('cS-hidden');
// 	      }
// 	    });
	  });

  Date.prototype.format = function() {  
    var s = '';  
    var mouth = (this.getMonth() + 1)>=10?(this.getMonth() + 1):('0'+(this.getMonth() + 1));  
    var day = this.getDate()>=10?this.getDate():('0'+this.getDate());  
    s += this.getFullYear() + '-'; // 获取年份。  
    s += mouth + "-"; // 获取月份。  
    s += day; // 获取日。  
    return (s); // 返回日期。  
  };
  
</script>
<!-- 引入 ECharts 文件 -->
<script src="dist/js/echarts.common.min.js"></script>  
  <script type ="text/javascript">
  var myChart1 = echarts.init(document.getElementById('main1'));
  var myChart3 = echarts.init(document.getElementById('main3'));
  var myChart4 = echarts.init(document.getElementById('main4'));

  //社员人数
  var memberXData = [];
  var memberYData = [];
  option1 = {
    tooltip: {
      trigger: 'axis',
      axisPointer: { // 坐标轴指示器，坐标轴触发有效
        type: 'shadow' // 默认为直线，可选为：'line' | 'shadow'
      }
    },
    legend: {
      data: ['社员7日增长数'],
      right:0,
      textStyle: {color: '#404a59'}
    },
    grid: {
      left: '3%',
      right: '4%',
      bottom: '3%',
      containLabel: true
    },
    xAxis: [{
      type: 'category',
      data: memberXData,
      axisLabel:{
        textStyle:{color:'#404a59',}
      },
      axisLine:{
        lineStyle:{color:'#404a59',}
      },
    }],
    yAxis: [{
      type: 'value',
      axisLabel: {
        formatter: '{value}',
        textStyle:{color:'#404a59',}
      },
      axisLine:{
        lineStyle:{color:'#404a59',}
      },
    },{
      type: 'value',
      axisLabel: {
        formatter: '{value}',
        textStyle:{color:'#404a59',}
      },
      axisLine:{
        lineStyle:{color:'#404a59',}
      },
      position: 'right',
    }],
    series: [{
      name: '社员7日增长数',
      type: 'bar',
      itemStyle:{normal:{color:'#ffae00'},},
      data: memberYData,
      label: {
        normal: {
          show:true,
          position: 'top',
          textStyle:{
            color:'#ffae00',
          },
        },
        emphasis: {
          textStyle:{
            color:'#ffae00',
          },
        },
      },
    }]
  };

  //门店GMV散点图
  var dataBJ = [];
  var schema = [
    {name: 'order', index: 0, text: '订单量'},
    {name: 'gmv', index: 1, text: 'GMV'},
    {name: 'store', index: 2, text: '门店'}
  ];

  var itemStyle = {
    normal: {
      opacity: 0.8,
      shadowBlur: 10,
      shadowOffsetX: 0,
      shadowOffsetY: 0,
      shadowColor: 'rgba(0, 0, 0, 0.5)'
    }
  };

  option3 = {
    title: {
      text: "昨日门店GMV分布",
      left: "10",
      y: "10",
      textStyle: {
        color: "#666"
      }
    },
    color: [
      '#dd4444', '#fec42c', '#80F1BE'
    ],
    legend: {
      y: 'top',
      data: ['GMV'],
      textStyle: {
        color: '#666',
        fontSize: 16
      }
    },
    grid: {
      //x: '10%',
      //x2: 80,
      y: '28%',
      y2: '20%',
      bottom:'10%',
      left:'5%'
    },
    tooltip: {
      padding: 10,
      backgroundColor: '#222',
      borderColor: '#777',
      borderWidth: 1,
      formatter: function (obj) {
        var value = obj.value;
        return '<div style="border-bottom: 1px solid rgba(255,255,255,.3); font-size: 18px;padding-bottom: 7px;margin-bottom: 7px">'
          + schema[1].text + '：' + value[1] + '万元</div>'
          + schema[0].text + '：' + value[0] + '<br>'
          + schema[2].text + '：' + value[2] + '<br>';
      }
    },
    xAxis: {
      type: 'value',
      name: '订单量',
      nameGap: 16,
      nameTextStyle: {
        color: '#666',
        fontSize: 14
      },
      min: function(value){
  	   	 return parseInt(value.min);
  	   },
      splitLine: {
        show: false
      },
      axisLine: {
        lineStyle: {
          color: '#666'
        }
      }
    },
    yAxis: {
      type: 'value',
      name: 'GMV（万元）',
      nameLocation: 'end',
      nameGap: 20,
      min: function(value){
 	   	 return parseInt(value.min);
   	   },
      nameTextStyle: {
        color: '#666',
        fontSize: 16
      },
      axisLine: {
        lineStyle: {
          color: '#666'
        }
      },
      splitLine: {
        show: false
      }
    },
    visualMap: [
      {
        left: 'right',
        top: '10%',
        dimension: 1,
        min: 0,
        max: 10,
        itemWidth: 30,
        itemHeight: 100,
        calculable: true,
        precision: 0.1,
        text: ['圆形大小：门店GMV'],
        textGap: 30,
        textStyle: {
          color: '#666'
        },
        inRange: {
          symbolSize: [10, 70]
        },
        outOfRange: {
          symbolSize: [10, 70],
          color: ['rgba(255,255,255,.2)']
        },
        controller: {
          inRange: {
            color: ['#c23531']
          },
          outOfRange: {
            color: ['#666']
          }
        }
      },
      {
        left: 'right',
        bottom: '5%',
        dimension: 0,
        min: 0,
        max: 500,
        itemHeight: 100,
        calculable: true,
        precision: 0.1,
        text: ['明暗：订单量'],
        textGap: 30,
        textStyle: {
          color: '#666'
        },
        inRange: {
          colorLightness: [1, 0.5]
        },
        outOfRange: {
          color: ['rgba(255,255,255,.2)']
        },
        controller: {
          inRange: {
            color: ['#c23531']
          },
          outOfRange: {
            color: ['#666']
          }
        }
      }
    ],
    series: [
      {
        name: '门店GMV',
        type: 'scatter',
        itemStyle: itemStyle,
        data: dataBJ,
      },
    ]
  };

  //总GMV走势图
  var gmvXData = [];
  var gmvYData = [];
  
  var option4 = {
	  title: {
		  text: "近7日GMV走势",
		  left: "10",
		  y: "10",
		  textStyle: {
			  color: "#666"
		  }
	  },
	  color: "#BF3EFF",
	  tooltip: {
		  trigger: "axis",
		  axisPointer: {
			  type: "cross",
			  crossStyle: {
				  color: "#BF3EFF"
			  }
		  }
	  },
	  legend: {
		  data: [
			  {
				  name: "总GMV",
				  icon: "circle",
				  textStyle: {
					  color: "#666"
				  }
			  },
		  ],
		  top: "5%",
		  textStyle: {
			  color: "#CD0000"
		  }
	  },
	  xAxis: [
		  {
			data: gmvXData,
			type: 'category',
// 	        boundaryGap: false,
	        axisLine: {
	          lineStyle: {
	            color: '#666'
	          }
	        },
	        splitLine: {
	          show: false
	        },
	        axisTick: {
	          show: true
	        },
	        splitArea: {
	          show: false
	        },
	        axisLabel: {
	          interval: 0,
	        },
		  }
	  ],
	  yAxis: [
		  {
			type: 'value',
			name: 'GMV（万元）',
			min: 0,
	        splitLine: {
	          show: false
	        },
	        axisLine: {
	          lineStyle: {
	            color: '#333'
	          }
	        },
	        axisTick: {
	          show: false
	        },
	        axisLabel: {
	          interval: 1,
	        },
	        splitArea: {
	          show: false
	        },
		  }
	  ],
	  grid: {
		  top: "25%",
		  left: '5%',
		  right: '5%',
		  bottom: '10%'
	  },
	  series: [
		  {
			  name: "总GMV",
			  type: "bar",
			  data: gmvYData,
			  barWidth: "50",
			  itemStyle: {
				  normal: {
					  color: '#CD5555',
				  }
			  },
		  	  markPoint : {
			  	data : [
					  {type : 'max', name: '最大值'},
					  {type : 'min', name: '最小值'},
				  ],
				  itemStyle:{normal: {color:'#CD0000'}},
				  emphasis: {
				      itemStyle:{normal: {color:'#CD0000'}}
				  }
			  },
		  },
	  ]
  };
  
  myChart1.setOption(option1);
  myChart3.setOption(option3);
  myChart4.setOption(option4);
</script>
<script>

	$(function(){
		gmvXData = initgmvXData();
		initScatterplot();
		initGmvTrend();
		inintMemberData();
		inintYYGmvData();
		inintJWSGmvData();
 		inintGrouponGmvData();
		inintYestodayGmvData();
		doTypeGMV();
		//单店昨日情况
// 		initStoreCompleteInfo();
// 		inintYestodayGrouponGmvData();
// 		inintYestodayJWSGmvData();
		showStoreRanking();
		initMemberTrend();
		
	});
    
	
	var totalGMV = '0';
	var start_time = '2018-07-01';
	var cur_date = new Date();
	cur_date.setTime(cur_date.getTime()+24*60*60*1000);
	var end_month = cur_date.getMonth()+1;
	var end_date = cur_date.getDate();
	var end_time = cur_date.getFullYear()+"-" + (end_month < 10 ? '0' + end_month : '' + end_month) + "-" + (end_date < 10 ? '0' + end_date : '' + end_date);
	
	cur_date.setTime(cur_date.getTime()-2*24*60*60*1000);
	var yestoday_month = cur_date.getMonth()+1;
	var yestoday_date = cur_date.getDate();
	var yestoday_time = cur_date.getFullYear()+"-" + (yestoday_month < 10 ? '0' + yestoday_month : '' + yestoday_month) + "-" + (yestoday_date < 10 ? '0' + yestoday_date : '' + yestoday_date);
	
	var newMemberNum = '0';
	var totalMembernum = '0';
	function inintMemberData(){
		  doManager("strategyActivityManager","queryNewMember",[null,start_time,end_time],
				function(datax,textStatus,XmlHttpRequest){
					if (datax.result) {
						var jsonData = $.fromJSON(datax.data);
						if(Object.keys(jsonData).length!=0){
							newMemberNum = jsonData.membernum;
							$("#memberNum").html(parseFloat(newMemberNum).toLocaleString()+"人");
						}else{
							$("#memberNum").html('0');
						}
					}
			});
// 		  doManager("strategyActivityManager","queryTotalMember",null,
// 				function(datax,textStatus,XmlHttpRequest){
// 					if (datax.result) {
// 						var jsonData = $.fromJSON(datax.data);
// 						if(Object.keys(jsonData).length!=0){
// 							totalMembernum = jsonData.totalnum;
// 							$("#memberNum").html(parseFloat(newMemberNum).toLocaleString()+"/"+parseFloat(totalMembernum).toLocaleString()+"人");
// 						}else{
// 							$("#memberNum").html('0');
// 						}
// 					}
// 			});
	}
	
	var yyGMV = '0';
	var yy_dept_id = "1";//优易+老年之家（养老餐）
	function inintYYGmvData(){
		  doManager("strategyActivityManager","queryStrategyGMV",[yy_dept_id,null,start_time,end_time],
				function(datax,textStatus,XmlHttpRequest){
					if (datax.result) {
						var jsonData = $.fromJSON(datax.data);
						if(Object.keys(jsonData).length!=0){
							yyGMV = jsonData.total_gmv;
							$("#yyGmv").html(changeMoney(parseInt(yyGMV)));
						}else{
							$("#yyGmv").html('0');
						}
					}
			},false);
	}
	
	var jwsGMV = '0';
	var jws_dept_id = "2";//家务事
	function inintJWSGmvData(){
		  doManager("strategyActivityManager","queryStrategyGMV",[jws_dept_id,null,start_time,end_time],
				function(datax,textStatus,XmlHttpRequest){
					if (datax.result) {
						var jsonData = $.fromJSON(datax.data);
						if(Object.keys(jsonData).length!=0){
							jwsGMV = jsonData.total_gmv;
							$("#jwsGmv").html(changeMoney(parseInt(jwsGMV)));
						}else{
							$("#jwsGmv").html('0');
						}
					}
			},false);
	}
	
	var grouponGMV = '0';
	var groupon_dept_id = "3";
	function inintGrouponGmvData(){
		  doManager("strategyActivityManager","queryStrategyGMV",[groupon_dept_id,null,start_time,end_time],
				function(datax,textStatus,XmlHttpRequest){
					if (datax.result) {
						var jsonData = $.fromJSON(datax.data);
						if(Object.keys(jsonData).length!=0){
							grouponGMV = jsonData.total_gmv;
						}
					}
			},false);
		  $("#totalGmv").html(changeMoney(parseInt(yyGMV)+parseInt(jwsGMV)+parseInt(grouponGMV)));
		  $("#avgGmv").html(changeMoney(((parseInt(yyGMV)+parseInt(jwsGMV)+parseInt(grouponGMV))/96).toFixed(2)));
	}
	
	var yestoday_yyGMV = '0';
	function inintYestodayGmvData(){
		  doManager("strategyActivityManager","queryStrategyGMV",[yy_dept_id,null,yestoday_time,yestoday_time],
				function(datax,textStatus,XmlHttpRequest){
					if (datax.result) {
						var jsonData = $.fromJSON(datax.data);
						if(Object.keys(jsonData).length!=0){
							yestoday_yyGMV = jsonData.total_gmv;
							$("#yestodayProductGmv").html(changeMoney(parseInt(yestoday_yyGMV)));
						}else{
							$("#yestodayProductGmv").html('0');
						}
					}
			},false);
		  
		  doManager("strategyActivityManager","queryStrategyGMV",[jws_dept_id,null,yestoday_time,yestoday_time],
				function(datax,textStatus,XmlHttpRequest){
					if (datax.result) {
						var jsonData = $.fromJSON(datax.data);
						if(Object.keys(jsonData).length!=0){
							yestoday_jwsGMV = jsonData.total_gmv;
							$("#yestodayServiceGmv").html(changeMoney(parseInt(yestoday_jwsGMV)));
						}else{
							$("#yestodayServiceGmv").html('0');
						}
					}
			},false);
		  
		  doManager("strategyActivityManager","queryStrategyGMV",[groupon_dept_id,null,yestoday_time,yestoday_time],
				function(datax,textStatus,XmlHttpRequest){
					if (datax.result) {
						var jsonData = $.fromJSON(datax.data);
						if(Object.keys(jsonData).length!=0){
							yestoday_grouponGMV = jsonData.total_gmv;
							$("#yestodayGrouponGmv").html(changeMoney(parseInt(yestoday_grouponGMV)));
							$("#yestodayTotalGmv").html(changeMoney(parseInt(yestoday_yyGMV)+parseInt(yestoday_jwsGMV)+parseInt(yestoday_grouponGMV)));
						}else{
							$("#yestodayGrouponGmv").html('0');
						}
					}
			});
	}
	
// 	function initStoreCompleteInfo(){
// 		  doManager("strategyActivityManager","queryStoreCompleteInfo",null,
// 			function(datax,textStatus,XmlHttpRequest){
// 				if (datax.result) {
// 					var jsonData = $.fromJSON(datax.data);
// 					if(jsonData!=null&&jsonData.length>0){
// 						var infoStr="";
// 						for(var i=0;i<jsonData.length;i++){
// 							infoStr=infoStr+ '<li data-thumb="img/thumb/cS-1.jpg">';
// 							infoStr=infoStr+'<h5>'+jsonData[i].store_name+'<span class="pull-right">店长：'+jsonData[i].store_user+'</span></h5>';
// 							infoStr=infoStr+'<div class="col-sm-12">';
// 							infoStr=infoStr+'<div class="col-sm-6 no-padding">昨日GMV：<span>￥'+(jsonData[i].pro_total_gmv+jsonData[i].ser_total_gmv+jsonData[i].gro_total_gmv)+'</span></div>';
// 							infoStr=infoStr+'<div class="col-sm-6 no-padding">商品类GMV：<span>￥'+jsonData[i].pro_total_gmv+'</span></div>';
// 							infoStr=infoStr+'<div class="col-sm-6 no-padding">服务类GMV：<span>￥'+jsonData[i].ser_total_gmv+'</span></div>';
// 							infoStr=infoStr+'<div class="col-sm-6 no-padding">团购GMV：<span>￥'+jsonData[i].gro_total_gmv+'</span></div>';
// 							infoStr=infoStr+'</div>';
// 							infoStr=infoStr+'<div class="col-sm-6">社员新增：<span>'+jsonData[i].member_num+'人</span></div>';
// 		                    infoStr=infoStr+'</li>';
// 						}
// 						$("#image-gallery").append(infoStr); 
// 					}else{
// 		        		crm_alert(5,"系统查无此条件的数据");
// 		        		return;
// 					}
// 				}
// 		},false);
// 	}
	
	function initScatterplot(){
		  doManager("strategyActivityManager","queryDataOfScatterplot",null,
				function(data,textStatus,XmlHttpRequest){
					if (data.result) {
						var jsonData = $.fromJSON(data.data);
						if(jsonData.length!=0){
							$(jsonData).each(function(index,element){
								var temp = [];
								temp.push(element.ordernum);
								temp.push((element.ordergmv/10000).toFixed(2));
								temp.push(element.store_name);
								dataBJ.push(temp);
		                 	});
							option3.series[0].data = dataBJ;
							myChart3.setOption(option3,true);
						}else{
							dataBJ = [];
							option3.series[0].data = dataBJ;
							myChart3.setOption(option3,true);	
						}
					}
			});
	  }
	
	var productGmv = "0";
	var serviceGmv = "0";
	
	function showStoreRanking(){
		var yyStr="";
		doManager("strategyActivityManager","queryStoreRanking",[yy_dept_id],
			function(data,textStatus,XmlHttpRequest){
				if (data.result) {
					var jsonData = $.fromJSON(data.data);
					if(jsonData.length!=0){
						for(var i=0;i<jsonData.length;i++){
							yyStr= "<tr>"
			                   +"<td>"+jsonData[i].store_name+"</td>"
			                   +"<td>"+jsonData[i].ordergmv+"</td>";
			                   
								var rate = 0;
		   			    		if(yyGMV!=0){
		   			    			rate = (jsonData[i].ordergmv/yyGMV) * 100;
		   			    		}
		   			    	
			                   switch(i)
			                   {
				                   case 0:
				                	 yyStr += "<td><span class='badge bg-red'>"+rate.toFixed(2)+"%</span></td>";
				                     break;
				                   case 1:
				                	   yyStr += "<td><span class='badge bg-yellow'>"+rate.toFixed(2)+"%</span></td>";
				                     break;
				                   case 2:
				                	   yyStr += "<td><span class='badge bg-blue'>"+rate.toFixed(2)+"%</span></td>";
				                     break;
				                   case 3:
				                	   yyStr += "<td><span class='badge bg-green'>"+rate.toFixed(2)+"%</span></td>";
				                     break;
				                   case 4:
				                	   yyStr += "<td><span class='badge bg-purple'>"+rate.toFixed(2)+"%</span></td>";
				                     break;
				                   default:
				                	   yyStr += "<td><span class='badge bg-brown'>"+rate.toFixed(2)+"%</span></td>";
			                   }
			                   yyStr += "</tr>";
			                   $("#yyPro_data").append(yyStr); 
	                 	}
					}else{
						yyStr = "<tr>没有符合条件的数据</tr>";
						$("#yyPro_data").append(yyStr); 
					}
				}
		});
		
	   var jwsStr="";
	   doManager("strategyActivityManager","queryStoreRanking",[jws_dept_id],
			function(data,textStatus,XmlHttpRequest){
				if (data.result) {
					var jsonData = $.fromJSON(data.data);
					if(jsonData.length!=0){
						for(var i=0;i<jsonData.length;i++){
							jwsStr= "<tr>"
			                   +"<td>"+jsonData[i].store_name+"</td>"
			                   +"<td>"+jsonData[i].ordergmv+"</td>";
			                   
								var rate = 0;
		   			    		if(jwsGMV!=0){
		   			    			rate = (jsonData[i].ordergmv/jwsGMV) * 100;
		   			    		}
		   			    	
			                   switch(i)
			                   {
				                   case 0:
				                	   jwsStr += "<td><span class='badge bg-red'>"+rate.toFixed(2)+"%</span></td>";
				                     break;
				                   case 1:
				                	   jwsStr += "<td><span class='badge bg-yellow'>"+rate.toFixed(2)+"%</span></td>";
				                     break;
				                   case 2:
				                	   jwsStr += "<td><span class='badge bg-blue'>"+rate.toFixed(2)+"%</span></td>";
				                     break;
				                   case 3:
				                	   jwsStr += "<td><span class='badge bg-green'>"+rate.toFixed(2)+"%</span></td>";
				                     break;
				                   case 4:
				                	   jwsStr += "<td><span class='badge bg-purple'>"+rate.toFixed(2)+"%</span></td>";
				                     break;
				                   default:
				                	   jwsStr += "<td><span class='badge bg-brown'>"+rate.toFixed(2)+"%</span></td>";
			                   }
			                   jwsStr += "</tr>";
			                   $("#jwsPro_data").append(jwsStr); 
	                 	}
					}else{
						jwsStr = "<tr>没有符合条件的数据</tr>";
						$("#jwsPro_data").append(jwsStr); 
					}
				}
		});
	   	
	   var grouponStr="";
	   doManager("strategyActivityManager","queryStoreRanking",[groupon_dept_id],
			function(data,textStatus,XmlHttpRequest){
				if (data.result) {
					var jsonData = $.fromJSON(data.data);
					if(jsonData.length!=0){
						for(var i=0;i<jsonData.length;i++){
							grouponStr= "<tr>"
			                   +"<td>"+jsonData[i].store_name+"</td>"
			                   +"<td>"+jsonData[i].ordergmv+"</td>";
			                   
								var rate = 0;
		   			    		if(grouponGMV!=0){
		   			    			rate = (jsonData[i].ordergmv/grouponGMV) * 100;
		   			    		}
		   			    	
			                   switch(i)
			                   {
				                   case 0:
				                	   grouponStr += "<td><span class='badge bg-red'>"+rate.toFixed(2)+"%</span></td>";
				                     break;
				                   case 1:
				                	   grouponStr += "<td><span class='badge bg-yellow'>"+rate.toFixed(2)+"%</span></td>";
				                     break;
				                   case 2:
				                	   grouponStr += "<td><span class='badge bg-blue'>"+rate.toFixed(2)+"%</span></td>";
				                     break;
				                   case 3:
				                	   grouponStr += "<td><span class='badge bg-green'>"+rate.toFixed(2)+"%</span></td>";
				                     break;
				                   case 4:
				                	   grouponStr += "<td><span class='badge bg-purple'>"+rate.toFixed(2)+"%</span></td>";
				                     break;
				                   default:
				                	   grouponStr += "<td><span class='badge bg-brown'>"+rate.toFixed(2)+"%</span></td>";
			                   }
			                   grouponStr += "</tr>";
			                   $("#grouponPro_data").append(grouponStr); 
	                 	}
					}else{
						grouponStr = "<tr>没有符合条件的数据</tr>";
						$("#grouponPro_data").append(grouponStr); 
					}
				}
		});
	}
	
	function initMemberTrend(){
	  doManager("strategyActivityManager","queryMemberTrend",null,
			function(data,textStatus,XmlHttpRequest){
				if (data.result) {
					var jsonData = $.fromJSON(data.data);
					if(jsonData.length!=0){
						$(jsonData).each(function(index,element){
							memberXData[index]=element.datetime;
							memberYData[index]=element.membernum;
	                 	});
						option1.series[0].data = memberYData;
						myChart1.setOption(option1,true);
					}else{
						memberYData = [];
						option1.series[0].data = memberYData;
						myChart1.setOption(option1,true);	
					}
				}
		});
    }
	
	function initGmvTrend(){
	  gmvYData = new Array(gmvXData.length+1).join(0).split('');
		doManager("strategyActivityManager","queryGmvTrend",null,
			function(data,textStatus,XmlHttpRequest){
				if (data.result) {
					var jsonData = $.fromJSON(data.data);
					if(jsonData.length!=0){
						$(jsonData).each(function(index,element){
							var dateTemp = element.datetime;
							var indexTemp = jQuery.inArray(dateTemp,gmvXData);
							gmvYData[indexTemp]=(element.total_gmv/10000).toFixed(2);
	                    });
						option4.xAxis[0].data=gmvXData;
						option4.series[0].data=gmvYData;
						myChart4.setOption(option4);
					}else{
						gmvYData = [];
						option4.series[0].data=gmvYData;
						myChart4.setOption(option4);
					}
				}
		});
	}
	
	function doTypeGMV(){
	    doManager('strategyActivityManager','queryTypeGmv',null,function(data){
	        if(data.result){
	        	var resultJson= JSON.parse(data.data);
	        	showGMV(resultJson);
	        }
	    },false);
	}
	function showGMV(dataServer){
		var myChart5 = echarts.init(document.getElementById('main5'));
	    var option5 = {
    		  	title: {
    			  text: "近7日GMV走势（万元）",
    			  left: "10",
    			  y: "10",
    			  textStyle: {
    				  color: "#666"
    			  }
    		  	},
    		  	color: "#BF3EFF",
	    		tooltip : {
	    	        trigger: 'axis',
	    	        axisPointer : {            // 坐标轴指示器，坐标轴触发有效
	    	            type : 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
	    	        }
	    	    },
	    	    legend: {
	    	        data:['商品','服务','团购']
	    	    },
	    	    calculable : true,
	    	    xAxis : [
	    	        {
	    	            type : 'category',
	    	            data : dataServer.jsonDateMem

	    	        }
	    	    ],
	    	    yAxis : [
	    	        {
	    	            type : 'value'
	    	        }
	    	    ],
	    	    series : [
	    	       
	    	        {
	    	            name:'商品',
	    	            type:'bar',
	    	            stack: 'type',
	    	            color:'#8BC8F3',
	    	           itemStyle: {
	    	              normal: {
	    	            	color: '#8BC8F3',
	    	                label : {
	    	                  show: true, position: 'inside'
	    	                }
	    	              }
	    	            },
	    	            data:dataServer.jsonproductCounts
	    	        },
	    	        {
	    	            name:'服务',
	    	            type:'bar',
	    	            stack: 'type',
	    	            itemStyle: {
	    	              normal: {
	    	            	color: '#B6A2DE',
	    	                label : {
	    	                  show: true, position: 'inside'
	    	                }
	    	              }
	    	            },
	    	            data:dataServer.jsonserviceCounts
	    	        },
	    	        {
	    	            name:'团购',
	    	            type:'bar',
	    	            stack: 'type',
	    	             itemStyle: {
	    	              normal: {
	    	                color: '#FFB980',
	    	                label : {
	    	                  show: true, position: 'inside'
	    	                }
	    	              }
	    	            },
	    	            data:dataServer.jsonfroupCounts
	    	        }
	    	    ]
	    };
	    
	    myChart5.setOption(option5);
	    }
	
	function toBussiness(){
 		window.location.href="221_bussiness.html";
 	}
 	
 	function toStore(){
 		window.location.href="221_store.html";
 	}
	
	function initgmvXData() {
      var data = [];
      var day1 = new Date();
      day1.setTime(day1.getTime()-6*24*60*60*1000);
      var fistDay = day1.getFullYear()+"-" + (day1.getMonth()+1) + "-" + day1.getDate();
      var now = new Date();
      var curDay = now.getFullYear() + "-" + (now.getMonth() + 1) + "-" + now.getDate();
      data = getAllDate(fistDay,curDay);
      return data;
    }
	
  //获取当年所有的日期
  function getAllDate(begin, end) {  
	  var result = [];
      var ab = begin.split("-");  
      var ae = end.split("-");  
      var db = new Date();  
      db.setUTCFullYear(ab[0], ab[1] - 1, ab[2]);  
      var de = new Date();  
      de.setUTCFullYear(ae[0], ae[1] - 1, ae[2]);  
      var unixDb = db.getTime();  
      var unixDe = de.getTime();  
      for (var k = unixDb; k <= unixDe;) {  
          result.push((new Date(parseInt(k))).format());
          k = k + 24 * 60 * 60 * 1000;  
      }  
      return result;
  } 

  Date.prototype.toLocaleString = function() {
      return this.getFullYear() + "-" + (this.getMonth() + 1) + "-" + this.getDate();
  }; 
  
  function changeMoney (x) {
	    x=x/10000;
	    var y = '';
	    if(parseInt(x)/10000<=1){
	    	y=ForDight(x,2)+"万";
	    }else if(parseInt(x)/10000>1){
	    	x=x/10000+'';
	    	y=ForDight(x,2)+"亿";
	    }
	    return y;
  }
  function ForDight(str,How){  
    Dight = Math.round(str*Math.pow(10,How))/Math.pow(10,How);  
    return Dight;  
  }
</script>
</body>
</html>