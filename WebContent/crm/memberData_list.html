<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>社员档案</title>
    <link rel="shortcut icon" type="image/x-icon" href="../icon.png" />
    <!-- Tell the browser to be responsive to screen width -->
    <meta content="width=device-width, initial-scale=0.3, maximum-scale=1, user-scalable=yes" name="viewport">  <!-- Bootstrap 3.3.6 -->
    <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="bootstrap/css/font-awesome.min.css">
    <!-- Ionicons -->
    <link rel="stylesheet" href="bootstrap/css/ionicons.min.css">
    <!-- Morris charts -->
    <link rel="stylesheet" href="plugins/morris/morris.css">
    <!-- Theme style -->
    <link rel="stylesheet" href="dist/css/AdminLTE.min.css">
    <!-- AdminLTE Skins. Choose a skin from the css/skins
         folder instead of downloading all of them to reduce the load. -->
    <link rel="stylesheet" href="dist/css/skins/_all-skins.min.css">
    <link rel="stylesheet" href="plugins/daterangepicker/daterangepicker-bs3.css">
    <!-- Select2 -->
    <link rel="stylesheet" href="plugins/select2/select2.min.css">
    <link href="../scripts/css/auto.css" rel="stylesheet">
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="IE 9/html5shiv.min.js"></script>
    <script src="IE 9/respond.min.js"></script>
    <![endif]-->
    <style>
        .box-default{border-bottom: 1px solid #e1e1e1;}
        .info_head{padding: 25px 0 35px 0;}
        .info_head img{width:123px; margin-top:10px;}
        .info_head span{padding-left: 20px;}
        .info_bottom{padding: 35px 20px 0 35px; font-size: 12px;}
        .info_bottom .text-right span{padding: 6px 12px; margin:0 20px 0 3px; display: inline-block;}
        .box .h4{padding-left:20px;}
        .nav-tabs-custom{padding:0 20px;}
        .nav-tabs{border:0;}
        .logo-lg li{float: left; position: relative;}

        .logo-lg i{color: #fff;}
        .nav_dropdown{ position: absolute;z-index: 10000; top: 70px; left: -10px; line-height: 22px; padding: 15px 25px; background-color: #15b092; display: none;}
        .nav_dropdown li{padding: 5px 0; line-height: 20px; white-space: nowrap; font-size: 14px;}
        .logo-lg > ul > li:hover > a{color: #001f3f; font-weight: bold;}
        .logo-lg > ul > li:hover i{ transform: rotate(180deg); transition: all 0.3s linear; color: #001f3f;}
        .table button{padding: 3px 20px; margin: 0 5px;}

        .tcdPageCode{padding: 15px 20px;text-align: left;color: #ccc;text-align:center;}
        .tcdPageCode a{display: inline-block;color: #428bca;display: inline-block;height: 25px;	line-height: 25px;	padding: 0 10px;border: 1px solid #ddd;	margin: 0 2px;border-radius: 4px;vertical-align: middle;}
        .tcdPageCode a:hover{text-decoration: none;border: 1px solid #428bca;}
        .tcdPageCode span.current{display: inline-block;height: 25px;line-height: 25px;padding: 0 10px;margin: 0 2px;color: #fff;background-color: #428bca;	border: 1px solid #428bca;border-radius: 4px;vertical-align: middle;}
        .tcdPageCode span.disabled{	display: inline-block;height: 25px;line-height: 25px;padding: 0 10px;margin: 0 2px;	color: #bfbfbf;background: #f2f2f2;border: 1px solid #bfbfbf;border-radius: 4px;vertical-align: middle;}
        .audit_process{ overflow-y: auto;  background: #f9f9f9; border-radius: 5px; padding:15px 0 20px 0;}
        .audit_process .clearfix{ padding:10px 30px;}
        .audit_margin{margin-right: 15px;}

        .box-header{margin-bottom: -15px;}
        #process_div{
            background-color:#292a2b;
            display:inline;
            z-index:100000;
            left:0px;
            opacity:0.3; top:0; left:0;height:100%; width:100%; z-index:999; position:fixed; _position:absolute; _left: expression_r(documentElement.scrollLeft + documentElement.clientWidth - this.offsetWidth); _top: expression_r(documentElement.scrollTop + documentElement.clientHeight - this.offsetHeight);
            filter:Alpha(Opacity=30);
            opacity: 0.3;
        }

        #process_div_pic{
            position:fixed;
            top:50%;
            left:50%;
            z-index:100000000;
            margin:-16px 0 0 -50px;
            width:100px;
            height:32px;
            color: #fff;
        }

        .auto{max-height:200px; overflow-y:scroll;}
    </style>
</head>
<body class="hold-transition skin-blue sidebar-mini">
<div id="process_div" style="display:none"></div>
<div id="process_div_pic" style="display:none"><img style="width:50px;height: 50px;" src="dist/img/376884043677306248.png"><i class="fa fa-refresh fa-spin"></i></div>
<!-- Site wrapper -->
<div class="wrapper">

    <header class="main-header">
        <nav class="navbar navbar-static-top">
            <div class="container">
                <div class="logo_img pull-left">
                    <img src="dist/img/logo.png" height="30">
                    <img src="dist/img/title.png" height="20">
                </div>
                <div class="pull-left">
                    <div class="logo-lg">
                        <ul class="no-margin">
                            <li class="current"><em>社员档案</em></li>
                        </ul>
                    </div>
                </div>
            </div>
        </nav>
    </header>


    <!-- =============================================== -->

    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">
        <!--  <div class="container"> -->
        <div>
            <!-- Main content -->

            <section class="content-header">
                <div class="box box-default">
                    <div class="box-header h4 text-light-blue">
                        <div class="pull-left "><strong>社员档案查询</strong></div>
                    </div>
                    <div class="box-body">
                        <form id="can_appeal_form" class="clearfix">
                            <div class="clearfix">
                                <div class="form-group col-lg-3">
                                    <select class="form-control select2" id="citySelect">
                                    </select>
                                </div>
                                <div class="form-group col-lg-3"><input id="store_id_manual" name="store_id_manual" type="hidden" bidTableFlag="true" value=""/>
                                    <input type="text" class="form-control"  placeholder="门店" id="store_name_manual" />
                                    <div class="auto hidden" id="auto" style="width: 94%;z-index: 99999;">
                                    </div>
                                </div>
                            </div>

                            <div class="clearfix">
                                <div class="form-group col-lg-3"><span style="font-weight:700">邀请码</span>：&nbsp; <input type="text" class="form-control" id="member_invite_code"  placeholder="邀请码" onkeyup="value=value.replace(/(\s*)|(\s*)/g,'').replace(/[ ]/g,'')" style="border-radius: 6px; box-shadow: 0 1px 1px rgba(0,0,0,0.3);"/>
                                </div>
                            </div>
                        </form>
                        <div class="clearfix">
                            <div class="form-group col-lg-2 pull-right" style="padding-top: 0px;">
                                <button type="button" onclick="resetSerachParam(1)" style="border-color:#00a65a;background-color:#00a652;color:white" class="btn btn-block">重置</button>
                            </div>

                            <div class="col-lg-2 pull-right" style="padding-top: 0px;" id="exportnormal">
                                <button type="button" style="display:block" id="export_auto_publicOrder_button" onclick="export_auto_human('normal')" class="btn btn-block btn-warning">导出</button>
                            </div>
                            <div class="col-lg-2 pull-right" style="padding-top: 0px;display:none" id="exportall">
                                <button type="button" id="export_manual_massOrder_button" onclick="export_auto_human('all')" class="btn btn-block btn-warning">完整数据导出</button>
                            </div>
                            <div class="form-group col-lg-2 pull-right" style="padding-top: 0px;">
                                <button type="button" onclick="search_auto_abnormalOrder(1)" class="btn btn-block btn-primary">查询</button>
                            </div>

                        </div>

                    </div>

                    <div class="box-body">
                        <div class="tab-content">
                            <table class="table table-striped no-margin">
                                <tbody id="manual_tbody">
                                <tr id="auto_title">
                                    <th width="10%">社员手机号</th>
                                    <th width="10%">社员注册时间</th>
                                    <th width="10%">社员开卡时间</th>
                                    <th width="10%">邀请码</th>
                                    <th width="10%">城市</th>
                                    <th width="10%">社员开卡门店</th>
                                </tr>

                                </tbody>
                            </table>

                            <!-- /.tab-pane -->
                        </div>

                        <div style="position:absolute;bottom:6px;left:27px;width:25%">显示 <select id="pageRecords_manual" name="pageRecords_manual" onchange="chnagePageRecords(2)"  style="height:25px;line-height:25px;border-radius:4px;"><option value="10" selected="selected">10</option><option value="50">50</option><option value="100">100</option></select> 条 &nbsp;&nbsp; 共  <span id="totalRecord_cannot"></span> 条</div>
                        <div class="tcdPageCode" id="page_manual"></div>

                        </div>
                </div>

            </section>

        </div>
    </div>
    <!-- /.content-wrapper -->


</div>
<!-- ./wrapper -->

<!-- jQuery 2.2.0 -->
<script src="plugins/jQuery/jQuery-2.2.0.min.js"></script>
<!-- Bootstrap 3.3.6 -->
<script src="bootstrap/js/bootstrap.min.js"></script>
<!-- Morris.js charts -->
<script src="bootstrap/js/raphael-min.js"></script>
<script src="plugins/morris/morris.min.js"></script>
<!-- FastClick -->
<script src="plugins/fastclick/fastclick.js"></script>
<!-- AdminLTE App -->
<script src="dist/js/app.min.js"></script>
<!-- AdminLTE for demo purposes -->
<script src="dist/js/demo.js"></script>
<!-- page script -->
<script type="text/javascript" src="plugins/jquery.page.js"></script>
<script type="text/javascript" src="plugins/moment.min.js"></script>
<script type="text/javascript" src="plugins/daterangepicker/daterangepicker.js"></script>
<script type="text/javascript" src="../scripts/bidLibjsjquery3.0.js"></script>
<script type="text/javascript" src="../scripts/auto.js"></script>

<script tyle="text/javascript">
    Date.prototype.format=function(fmt) {
        var o = {
            "M+" : this.getMonth()+1, //月份
            "d+" : this.getDate(), //日
            "h+" : this.getHours()%12 == 0 ? 12 : this.getHours()%12, //小时
            "H+" : this.getHours(), //小时
            "m+" : this.getMinutes(), //分
            "s+" : this.getSeconds(), //秒
            "q+" : Math.floor((this.getMonth()+3)/3), //季度
            "S" : this.getMilliseconds() //毫秒
        };
        var week = {
            "0" : "\u65e5",
            "1" : "\u4e00",
            "2" : "\u4e8c",
            "3" : "\u4e09",
            "4" : "\u56db",
            "5" : "\u4e94",
            "6" : "\u516d"
        };
        if(/(y+)/.test(fmt)){
            fmt=fmt.replace(RegExp.$1, (this.getFullYear()+"").substr(4 - RegExp.$1.length));
        }
        if(/(E+)/.test(fmt)){
            fmt=fmt.replace(RegExp.$1, ((RegExp.$1.length>1) ? (RegExp.$1.length>2 ? "\u661f\u671f" : "\u5468") : "")+week[this.getDay()+""]);
        }
        for(var k in o){
            if(new RegExp("("+ k +")").test(fmt)){
                fmt = fmt.replace(RegExp.$1, (RegExp.$1.length==1) ? (o[k]) : (("00"+ o[k]).substr((""+ o[k]).length)));
            }
        }
        return fmt;
    }


    layer.config({

        extend: 'skin/crmskin/style.css' //加载新皮肤

    });

    var cityId = decode64(getUrlParamByKey("c"));//城市ID
    var employeeId = decode64(getUrlParamByKey("e"));//员工ID
    var storeId = decode64(getUrlParamByKey("s"));//门店ID
    var target = decode64(getUrlParamByKey("t"));//执行人级别
    var storeName=decode64(getUrlParamByKey("sn"));//门店名称
    var storeno = decode64(getUrlParamByKey("so"));//门店编号
    var role = decode64(getUrlParamByKey("r"));//角色 code
    var cityname = decode64(getUrlParamByKey("cn"));//城市名称
    var deptname = decode64(getUrlParamByKey("dn"));//事业部名称
    var employeeName = decode64(getUrlParamByKey("en"));//员工姓名
    var employeePhone = decode64(getUrlParamByKey("ep"));//员工手机号

    /* 	$('#sign_time').datepicker({
              autoclose: true
            }); */

    $(function () {

        $(".logo-lg > ul > li").mouseenter(function(){
            $(this).children(".nav_dropdown").show();
        });
        $(".logo-lg > ul > li").mouseleave(function(){
            $(this).children(".nav_dropdown").hide();
        });

        initcurruser();//初始化登录人信息
        var isManager = currentUser.usergroup.code;
        if(isManager=="GLY"){
            var exportnormal = document.getElementById("exportnormal");
            exportnormal.style.display = "none";
            var exportall = document.getElementById("exportall");
            exportall.style.display = "block";
        }

        if(target==0){//总部
            initallcity();
            initallstore();
        }else if(target==1){//城市
            initcurcity();
            $("#citySelect option[value='"+cityId+"']").attr('selected',true);
            initStoreSelectcomplate();
        }else if(target==2) {//门店
            initcurcity();
            $("#citySelect").prop("disabled", true);
            $("#citySelect").append('<option value="'+cityId+'">'+cityname+'</option>');
            initStoreSelectcomplate();
            $("#store_id_manual").val(storeId);
            $("#store_name_manual").val(storeName);
            $("#store_name_manual").attr("readonly",true);
        }

        var autoComplete = new AutoComplete("store_name_manual","auto",array);
        document.getElementById("store_name_manual").onkeyup = function(event){
            autoComplete.start(event);
            if($("#store_name_manual").val().trim() == ""){
                $("#store_id_manual").val("");
            }
            for(var key in storeJson){
                if(document.getElementById("store_name_manual").value==key){
                    document.getElementById("store_id_manual").value=storeJson[key];
                }
            }
        }
        $("#auto").on("click",function(event){
            for(var key in storeJson){
                if(document.getElementById("store_name_manual").value==key){
                    document.getElementById("store_id_manual").value=storeJson[key];
                }
            }
        });

    });

    function initallcity(){
        doManager("DistCityCodeManager","queryAllDistCityList",null,
            function(data,textStatus,XmlHttpRequest){
                if (data.result) {
                    var jsonData = $.fromJSON(data.data);
                    $("#citySelect").append("<option value=''>全部城市</option>");
                    $(jsonData).each(function(index,element){
                        $("#citySelect").append('<option value="'+element.cityno+'">'+element.cityname+'</option>');
                    });
                }
            },false);
    }

    var array=new Array();
    //初始化所有门店
    function initallstore() {
        doManager("StoreManager", "findStoreAll", null,
            function(data, textStatus, XMLHttpRequest) {
                if (data.result) {
                    var jsonData = $.fromJSON(data.data);
                    array = new Array();
                    var storeString = "";
                    for(var i=0;i<jsonData.length;i++){
                        array.push(jsonData[i].name);
                        if(i == 0){
                            storeString = "{'"+jsonData[i].name+"'"+":"+"'"+jsonData[i].id+"'"+",";
                        }else if(i == jsonData.length-1){
                            storeString = storeString+"'"+jsonData[i].name+"'"+":"+"'"+jsonData[i].id+"'"+"}";
                        }else{
                            storeString = storeString+"'"+jsonData[i].name+"'"+":"+"'"+jsonData[i].id+"'"+",";
                        }
                    }
                    storeJson=$.fromJSON(storeString);
                    var autoComplete = new AutoComplete("store_name_manual","auto",array);
                    document.getElementById("store_name_manual").onkeyup = function(event){
                        autoComplete.start(event);
                        if($("#store_name_manual").val().trim() == ""){
                            $("#store_id_manual").val("");
                        }
                        document.getElementById("store_name_manual").value=document.getElementById("store_name_manual").value.replace(/(\s*)|(\s*)/g,'').replace(/[ ]/g,'');
                    }
                }
            }, false);
    }

    function initcurcity(){
        doManager("userManager","getCurrentUserCity",null,
            function(data,textStatus,XmlHttpRequest){
                if (data.result) {
                    var jsonData = $.fromJSON(data.data);
                    $(jsonData).each(function(index,element){
                        doManager("massOrderManager","queryCitynoByCode",element.citycode,
                            function(data2,textStatus,XmlHttpRequest){
                                if (data2.result) {
                                    var jsonData2 = $.fromJSON(data2.data);
                                    $("#citySelect").append('<option value="'+jsonData2.cityno+'">'+element.cityname+'</option>');
                                }
                            },false);
                    });
                }
            },false);
    }

    $("#citySelect").change(function(){
        $("#store_id_manual").val("");
        $("#store_name_manual").val("");
        initStoreSelectcomplate();
    });

    var storeJson;
    function initStoreSelectcomplate(){
        var citySelect = $("#citySelect").find("option:selected").text();
        $("#auto").val("");
        if(citySelect=="" || citySelect=="全部城市"){
            initallstore();
        }else{
            //根据城市查询门店 信息
            var cityname = "'"+citySelect+"'";
            doManager("StoreManager","findStoreByCityData",[cityname],
                function(data,textStatus,XmlHttpRequest){
                    if (data.result) {
                        var jsonData = $.fromJSON(data.data);
                        array=new Array();
                        var storeString = "";
                        $(jsonData).each(function(index,element){
                            var storeName = element.name;
                            var storeid = element.id;
                            array.push(storeName);
                            if(index == 0){
                                storeString = "{'"+storeName+"'"+":"+"'"+storeid+"'"+",";
                            }else if(index == jsonData.length-1){
                                storeString = storeString+"'"+storeName+"'"+":"+"'"+storeid+"'"+"}";
                            }else{
                                storeString = storeString+"'"+storeName+"'"+":"+"'"+storeid+"'"+",";
                            }
                        });
                        storeJson=$.fromJSON(storeString);
                        var autoCompleteName = new AutoComplete("store_name_manual","auto",array);
                        document.getElementById("store_name_manual").onkeyup = function(event){
                            autoCompleteName.start(event);
                            if($("#store_name_manual").val().trim() == ""){
                                $("#store_id_manual").val("");
                            }
                            document.getElementById("store_name_manual").value=document.getElementById("store_name_manual").value.replace(/(\s*)|(\s*)/g,'').replace(/[ ]/g,'');
                        }
                    }
                },false);
        }

    }

    function isCityStore(sname){
        var cityStore = false;
        $(array).each(function(index,element){
            if(element==sname){
                cityStore=true;
            }
        });
        return cityStore;
    }

    var currentUser;
    function initcurruser(){
        //取得当前登录人的门店
        doManager("UserManager", "getCurrentUserDTO",null,
            function(data, textStatus, XMLHttpRequest) {
                if (data.result) {
                    var curr_user = JSON.parse(data.data);
                    currentUser = curr_user;
                }
            },false);
    }

    var isCreatePage=false;
    function search_auto_abnormalOrder(cur_page){
        isCreatePage=false;
        search_auto_abnormalOrder1(cur_page);

    }

    //查询上
    var currentPage_auto= 1;
    var totalPage_auto = 1;
    function  search_auto_abnormalOrder1(cur_page){

        var cityName = $("#citySelect option:selected").val();
        var number_str = $("#store_id_manual").val();
        var storeName = $("#store_name_manual").val();
        if(storeName!=""){
            if($.inArray(storeName, array) == -1){
                crm_alert(0,"该门店不存在！");
                return;
            }
        }
        if(number_str==""&&storeName!=""){
            number_str=-10000;
        }

        $("#process_div").show();
        $("#process_div_pic").show();

        var memberInviteCode = $("#member_invite_code").val();

        var memberDataDto=null;
        memberDataDto = {
            cityName:cityName,
            storeNo:number_str,
            inviteCode:memberInviteCode
        }

        var pageInfo = new Object();
        pageInfo.currentPage = cur_page;
        pageInfo.recordsPerPage = manualPageRecordes;
        $("#totalRecord_cannot").html("0");

        doManager('communeMember','queryMemberDataList',[memberDataDto,pageInfo],function(data){
            if(data.result){
                var result= JSON.parse(data.data);
                if(result.status=='success'){
                    $("#manual_tbody").find("tr:gt(0)").remove();
                    var jData = result.data;
                    if(jData==null||jData.length==0){
                        crm_alert(5,"系统查无此条件的数据");
                        $("#page_manual").createPage({
                            pageCount:0,
                            current:0,
                            backFn:function(p){

                            }
                        });
                        $("#process_div").hide();
                        $("#process_div_pic").hide();
                        return;
                    }
                    totalPage_manual = result.total_pages;
                    $("#totalRecord_cannot").html(result.pageinfo.totalRecords);
                    if(!isCreatePage){

                        $("#page_manual").createPage({
                            pageCount:totalPage_manual,
                            current:1,
                            backFn:function(p){

                                search_auto_abnormalOrder1(p);
                            }
                        });
                        isCreatePage=true;
                    }

                    var infoStr="";
                    for(var i=0;i<jData.length;i++){
                        var regist="";
                        var opencard="";
                        if(jData[i].regist_time!=null){
                            var d=	new Date();
                            d.setTime(jData[i].regist_time);
                            regist=d.format('yyyy-MM-dd HH:mm:ss')
                        }
                        if(jData[i].opencard_time!=null){
                            var d=	new Date();
                            d.setTime(jData[i].opencard_time);
                            opencard=d.format('yyyy-MM-dd HH:mm:ss')
                        }

                        var mobilephone = jData[i].mobilephone;
                        var cphone="<strong>手机号：</strong>"+mobilephone+"<br>";
                        var phonecontent =cphone+"@phonetips"+i;
                        var phoneid = "phonetips"+i;

                        infoStr= "<tr>";
                        infoStr= infoStr
                            +"<td><a href=\"#\" onmouseover=\"showphone('"+phonecontent+"');\" id=\""+phoneid+"\">"+mobilephone.replace(/(\d{3})\d{4}(\d{4})/, '$1****$2')+"</a></td>"
                            +"<td>"+regist+"</td>"
                            +"<td>"+opencard+"</a></td>";
                        if(target==0 || target==1){
                            infoStr= infoStr
                                +"<td><a href=\"javascript:showemployee('"+jData[i].inviteCode+"')\">"+jData[i].inviteCode+"</a></td>";
                        }else{
                            infoStr= infoStr
                                +"<td>"+jData[i].inviteCode+"</td>";
                        }
                        infoStr= infoStr
                            +"<td>"+jData[i].city_name+"</td>"
                            +"<td>"+jData[i].store_name+"</td>";

                        infoStr= infoStr
                            +"</tr>";

                        $("#manual_tbody").append(infoStr);
                    }
                }else{
                    crm_alert(5,"请稍后重新请求！");
                }

            }else{
                crm_alert(5,"请稍后重新请求！");
            }
            $("#process_div").hide();
            $("#process_div_pic").hide();
        });

    }

    //社员手机号信息显示
    function showphone(obj){
        var msg = obj.split("@")[0];
        var id = obj.split("@")[1];
        layer.tips(msg, '#'+id, {
            tips: [4, '#0FA6D8'], //还可配置颜色
            time:5000
        });
    }

    //数据查找-员工数据
    function showemployee(inviteCode){
        var url = "humanresources_list.html?t="+encode64(target)+"&sn="+encode64(storeName)+"&cn="+encode64(cityname)+"&ic="+encode64(inviteCode);
        window.open(url,"humanresources_list");
    }

    function isnull(str) {
        return str == null || str == "null" || str == "" || str == "undefined" || typeof(str) == "undefined";
    }


    function resetSerachParam(t){
        if(target==0){//总部
            var a = document.getElementById("citySelect");
            a.options[0].selected = true;
            $("#store_name_manual").val("");
            initallstore();
        }else if(target==1){
            $("#store_name_manual").val("");
            initStoreSelectcomplate();
        }
        $("#store_id_manual").val("");
        $("#member_invite_code").val("");
    }

    var autoPageRecordes=10;
    var manualPageRecordes=10;
    //切换每页显示的数据量
    function chnagePageRecords(t){
        $("#page_manual").empty();
        manualPageRecordes  = $("#pageRecords_manual").val();
        search_manual_abnormalOrder(1);
    }

    function export_auto_human(hiddenvalue){

        var cityName = $("#citySelect option:selected").val();
        var number_str = $("#store_id_manual").val();
        var storeName = $("#store_name_manual").val();
        if(storeName!=""){
            if($.inArray(storeName, array) == -1){
                crm_alert(0,"该门店不存在！");
                return;
            }
        }
        if(number_str==""&&storeName!=""){
            number_str=-10000;
        }

        $("#process_div").show();
        $("#process_div_pic").show();

        var memberInviteCode = $("#member_invite_code").val();

        var memberDataDto=null;
        memberDataDto = {
            cityName:cityName,
            storeNo:number_str,
            inviteCode:memberInviteCode,
            hidden_flag:hiddenvalue
        }

        doManager('communeMember','exportMemeData',[memberDataDto],function(data){
            if(data.result){
                var result= JSON.parse(data.data);
                if(result.status=='success'){
                    window.location.href=result.data;
                }else if(result.status=='more'){
                    crm_alert(0,"单次导出不能超过5万条记录，请调整搜索条件，确认结果条数后再试。");
                    $("#process_div").hide();
                    $("#process_div_pic").hide();
                    return;
                }else{
                    crm_alert(0,"请先确认是否有符合条件的数据，重新请求！");
                    $("#process_div").hide();
                    $("#process_div_pic").hide();
                    return;
                }

            }else{
                crm_alert(5,"请稍后重新请求！");
            }
            $("#process_div").hide();
            $("#process_div_pic").hide();
        });
    }


</script>
</body>

<div class="audit_process" id="taskDetailDiv" style="display:none">
</div>


<div id="errorOrder_detail_div" style="height:247px;display:none">

</div>
</html>