<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>国安数据平台</title>
  <link rel="shortcut icon" type="image/x-icon" href="../icon.png" />
  <!-- Tell the browser to be responsive to screen width -->
<meta content="width=device-width, initial-scale=0.3, maximum-scale=1, user-scalable=yes" name="viewport">  <!-- Bootstrap 3.3.6 -->
  <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="bootstrap/css/font-awesome.min.css">
  <!-- Ionicons -->
  <link rel="stylesheet" href="bootstrap/css/ionicons.min.css">
  <!-- Theme style -->
  <link rel="stylesheet" href="dist/css/AdminLTE.min.css">
  <!-- iCheck -->
  <link rel="stylesheet" href="plugins/iCheck/square/blue.css">
  <link rel="stylesheet" href="plugins/iCheck/square/green.css">
   <script src="https://pv.sohu.com/cityjson?ie=utf-8"></script>
  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
  <script src="IE 9/html5shiv.min.js"></script>
  <script src="IE 9/respond.min.js"></script>
  <![endif]-->
  <style>
   html,body{height:100%; position: relative;}
    .col-lg-4{width: 32.5%;}
    .login-page{background: url("dist/img/logo_new_bg.jpg") no-repeat center top; background-size: cover;}
    .logo_choose{position: fixed; bottom: 0px; width: 250px; height: 40px; line-height: 20px; background: rgba(0,0,0,0.5); color: #fff; text-align: center; border-top-left-radius: 5px; border-bottom-left-radius: 5px;}
    .container_con{overflow: hidden; padding: 30px 0 50px 0; width: 630px; position: absolute; left: 50%; top: 50%; margin: -300px 0 0 -20px;}
    .container_con i{font-size: 70px;}
    .introduce-pop{ text-align: left; font-size: 12px; margin-top: 30px;}
	.bgcolor-mr{width: 215px; text-align: center; overflow: hidden; color: #333; margin: 35px auto 20px auto; padding: 15px 20px;transition:All 0.3s ease-in-out; -webkit-transition:All 0.3s ease-in-out; -moz-transition:All 0.3s ease-in-out; -o-transition:All 0.3s ease-in-out; cursor: pointer;}
    .bgcolor-mr:hover{box-shadow:0 2px 16px 0 rgba(53,64,82,.14);ransform:scale(1.05); -webkit-transform:scale(1.05); -moz-transform:scale(1.05); -o-transform:scale(1.05); -ms-transform:scale(1.05);}
	
	.subwrap{vertical-align:middle;}
    .subwrap h3{margin: 25px 0 20px 0; font-family: "STKaiti"; font-weight: 900; font-size: 26px;}
    .subwrap_line1{height: 1px; overflow: hidden; background: -webkit-linear-gradient(left, #fff , #ffbd9a , #fff); background: -o-linear-gradient(right, #fff , #ffbd9a , #fff); background: -moz-linear-gradient(right, #fff , #ffbd9a , #fff); background: linear-gradient(to right, #fff , #ffbd9a , #fff);}
    .subwrap_line2{height: 1px; overflow: hidden; background: -webkit-linear-gradient(left, #fff , #26baff , #fff); background: -o-linear-gradient(right, #fff , #26baff , #fff); background: -moz-linear-gradient(right, #fff , #26baff , #fff); background: linear-gradient(to right, #fff , #26baff , #fff);}
    .subwrap_line3{height: 1px; overflow: hidden; background: -webkit-linear-gradient(left, #fff , #605ca8 , #fff); background: -o-linear-gradient(right, #fff , #605ca8 , #fff); background: -moz-linear-gradient(right, #fff , #605ca8 , #fff); background: linear-gradient(to right, #fff , #605ca8 , #fff);}
    .subwrap_line4{height: 1px; overflow: hidden; background: -webkit-linear-gradient(left, #fff , #83e4b8 , #fff); background: -o-linear-gradient(right, #fff , #83e4b8 , #fff); background: -moz-linear-gradient(right, #fff , #83e4b8 , #fff); background: linear-gradient(to right, #fff , #83e4b8 , #fff);}
    .subwrap_line5{height: 1px; overflow: hidden; background: -webkit-linear-gradient(left, #fff , #fed598 , #fff); background: -o-linear-gradient(right, #fff , #fed598 , #fff); background: -moz-linear-gradient(right, #fff , #fed598 , #fff); background: linear-gradient(to right, #fff , #fed598 , #fff);}
    
    .navbar-custom-menu > .navbar-nav > li > .dropdown-menu{width: 140px!important;min-width: 140px; border: 0; background-color: rgba(0,0,0,0.5); right: -25px;}
    .user-body1{padding: 10px 0;}
    .user-body1 a{color: #fff;}
    .dropdown-menu > li > a:hover{background-color: rgba(0,0,0,0.5);}
    .logo-lg > ul > li:hover a{color: #fff; font-weight: normal;}
	.logo-lg img:nth-child(1){width: auto; height: 30px; margin-right: 10px;}
	.logo-lg img:nth-child(2){width: auto; height: 20px; margin-top: 5px;}
    .dongtai{color: #ff813d;}
    .guanli{color: #605ca8;}
    .ditu{color: #26baff;}
    .caiji{color: #12cb77;}
    .jixiao{color: #feae3a;}
  </style>
</head>
<body class="hold-transition login-page">
<header class="main-header">
  <!-- Logo -->

  <!-- Header Navbar: style can be found in header.less -->
  <nav class="navbar navbar-static-top">
    <!-- Sidebar toggle button-->
    <div class="container">

      <div class="pull-left">
        <div class="logo-lg clearfix">
          <ul>
            <li><a href="loginplatform.html" class="h2"> <img src="dist/img/logo1.png"><img src="dist/img/title.png"> </a></li>
          </ul>
        </div>
      </div>
      <div class="navbar-custom-menu">
        <ul class="nav navbar-nav">
<div id="sendboxlogout"></div>
          <li class="dropdown user user-menu">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown">
              <img src="dist/img/376884043677306248.png" class="user-image" alt="User Image">
              <span class="hidden-xs">用户：<label id="username">加载中..</label> | <label id="employee_no"></label></span>
            </a>
            <ul class="dropdown-menu">
              <!-- Menu Body -->
              <li class="user-body1"><a href="javascript:openUpdatepassword()" style="color: #ffffff;">修改密码</a> </li>
              <li class="user-body1"><a href="javascript:doLogout()"  style="color: #ffffff;">退出登录</a> </li>
              <!-- Menu Footer-->
            </ul>
          </li>
        </ul>
      </div>

    </div>
  </nav>
</header>
<div class="container_con">

<!-- <div class="bg-teal-active bgcolor-mr col-lg-4 caiji" id="todaqweb">
      <div class="subwrap">
        <i class="fa fa-file-text"></i>
        <h3>数据管理系统</h3></span>
      </div>
      <div class="introduce-pop"><span><h3>数据管理系统</h3>各种用户数据，活动数据，商业数据，地采数据录入等功能</div>
    </div> -->
    
    
    <div class="clearfix" style="padding: 0 45px;" >
    	<div class="col-md-1"></div>
	    <div class="col-md-5" style="cursor: pointer;"  id="tocrm">
	          <div class="bgcolor-mr dongtai">
	            <div class="subwrap">
	              <i class="fa fa-area-chart"></i>
	              <h3>数据动态系统</h3>
	              <div class="subwrap_line1"></div>
	            </div>
	            <div class="introduce-pop">数据动态统计，数据模型展示，数据查找与下载</div>
	          </div>
        </div>
    
    
     <div class="col-md-5" style="cursor: pointer;" id="tohr">
        <div class="bgcolor-mr ditu" >
          <div class="subwrap">
          <!-- <img alt="" src="dist/img/new.gif" style="position:absolute;width:27px;height:24px;margin-left:60px;"> -->
            <i class="fa fa-globe">
            </i>
            <h3>数据地图系统</h3>
            <div class="subwrap_line2"></div>
          </div>
          <div class="introduce-pop">基于地图实时展示订单，用户的区域密度和变化趋势</div>
        </div>
      </div>
      <div class="col-md-1"></div>

    <!-- <div class="bg-green-active bgcolor-mr col-lg-4 dongtai" id="tocrm">
      <div class="subwrap">
        <i class="fa fa-area-chart"></i>
        <h3>数据动态系统</h3>
      </div>
      <div class="introduce-pop"><span><h3>数据动态系统</h3>提供线上线下数据动态统计，查找，导出，分析等功能</span></div>
    </div> -->
    
      </div>
    

  <!-- <div class="clearfix col-lg-4 no-padding">
    <div class="bg-yellow-active bgcolor-mr renzi"  id="tofour">
      <div class="subwrap">
        <i class="fa fa-database"></i>
        <h3>绩效考核系统</h3>
      </div>
      <div class="introduce-pop"><span><h3>绩效考核系统</h3>提供门店人员考核目标录入，和绩效考核结果的计算功能</span></div>
    </div>
    <div class="bg-purple-active bgcolor-mr guanli" id="tofive">
      <div class="subwrap">
        <i class="fa fa-cog"></i>
        <h3>数据服务系统</h3>
      </div>
      <div class="introduce-pop"><span><h3>数据服务系统</h3>提供各种数据服务的管理功能</span></div>
    </div>
  </div>
  <div class="bg-orange-active bgcolor-mr jixiao col-lg-12" id="tohr">
    <div class="subwrap">
      <i class="fa fa-globe"></i>
      <h3>数据地图系统</h3>
    </div>
    <div class="introduce-pop"><span><h3>数据地图系统</h3>基于地图实时展示订单、在不同区域范围的密度和变化趋势</span></div>
  </div>
</div> -->





<div class="clearfix">
      <div class="col-md-4" style="cursor: pointer;" id="todaqweb">
          <div class="bgcolor-mr guanli">
            <div class="subwrap">
              <i class="fa fa-database"></i>
              <h3>数据管理系统</h3>
              <div class="subwrap_line3"></div>
            </div>
            <div class="introduce-pop">门店基础数据，门店人员数据，地采数据的录入与管理</div>
          </div>
     	</div>

      <div class="col-md-4" style="cursor: pointer;" id="tofive">
        <div class="bgcolor-mr caiji">
          <div class="subwrap">
            <i class="fa fa-cog"></i>
            <h3>数据服务系统</h3></span>
            <div class="subwrap_line4"></div>
          </div>
          <div class="introduce-pop">提供各种数据服务的管理功能</div>
        </div>
      </div>

      <div class="col-md-4" style="cursor: pointer;" id="tofour">
        <div class="bgcolor-mr jixiao">
          <div class="subwrap">
            <i class="fa fa-cloud"></i>
            <!--  <h3>数据报表系统</h3> -->
            <h3>云表单系统</h3>
            <div class="subwrap_line5"></div>
          </div>
          <div class="introduce-pop">云表单是国安数据平台提供的公有云服务，提供与表单相关的工具和应用。</div>
        </div>
      </div>
    </div>
    









</div>


<div class="logo_choose">
  <div class="checkbox icheck">
    <label>
      <input type="checkbox" id="default_check" name="optionsRadios" class="input2"> 记住本次选择，下次默认进入
    </label>
  </div>
</div>
<!-- jQuery 2.2.0 -->	
<script src="plugins/jQuery/jQuery-2.2.0.min.js"></script>
<!-- Bootstrap 3.3.6 -->
<script src="bootstrap/js/bootstrap.min.js"></script>
<!-- iCheck -->
<script src="plugins/iCheck/icheck.min.js"></script>
<script type="text/javascript" src="../scripts/bidLibjsjquery2.0.js"></script>
<script type="text/javascript" src="plugins/iCheck/icheck.min.js"></script>
<script>
var iscrmgax=false;
var iscrmdz = false;
var iscrmcszj=false;//城市总监
var iscrmqyjl=false;//区域经理
var iscareergp=false;
var isfqzycareer=false;//门店 服务专员 事业群人员 
var iscrmzbjs = false;//总部人员

function isLogincrm(){
	doManager("AreaManager", "queryAreaByCurrEmployeeNo",null,
			function(data, textStatus, XMLHttpRequest) {
				if (data.result) {
					var curr_u = JSON.parse(data.data);
					if(curr_u!=null&&curr_u.name!=null&&curr_u.employee_a_name!=null){
						iscrmgax = true;
					}
				}
	},false);
}


function todaqWeb(){
	
	saveAccessLog(currentUser,'数据管理系统');
	
	var default_system_val = $("#default_check")[0].checked;
	
	 if(default_system_val){
		var defaultConfig ={
				default_system:1,
				employee_no:currentUser.employeeId,
				employee_name:currentUser.name
		}
		doManager("DefaultConfigManager", "saveOrUpdateDefaultConfig",[defaultConfig],
				function(data, textStatus, XMLHttpRequest) {
					if (data.result) {
						window.parent.location = getRootPath()+"/bizbase/indexMain.html";
					}
		},false);
	}else{
		var defaultConfig ={
				default_system:-1,
				employee_no:currentUser.employeeId,
				employee_name:currentUser.name
		}
		doManager("DefaultConfigManager", "saveOrUpdateDefaultConfig",[defaultConfig],
				function(data, textStatus, XMLHttpRequest) {
					if (data.result) {
						window.parent.location = getRootPath()+"/bizbase/indexMain.html";
					}
		},false);
		window.parent.location = getRootPath()+"/bizbase/indexMain.html";
	} 
	
	
}



function toCrm(){
	
	saveAccessLog(currentUser,'数据动态系统');
	
	var default_system_val = $("#default_check")[0].checked;
	
	if(default_system_val){
		var defaultConfig ={
				default_system:0,
				employee_no:currentUser.employeeId,
				employee_name:currentUser.name
		}
		doManager("DefaultConfigManager", "saveOrUpdateDefaultConfig",[defaultConfig],
				function(data, textStatus, XMLHttpRequest) {
					if (data.result) {
						toCrm_role();
					}
		},false);
	}else{
		var defaultConfig ={
				default_system:-1,
				employee_no:currentUser.employeeId,
				employee_name:currentUser.name
		}
		doManager("DefaultConfigManager", "saveOrUpdateDefaultConfig",[defaultConfig],
				function(data, textStatus, XMLHttpRequest) {
					if (data.result) {
						toCrm_role();
					}
		},false);
		toCrm_role();
	}
}





//根据不同角色进入crm
function toCrm_role(){
	var myDate = new Date();
	var c_year = myDate.getFullYear(); //当前年
	var c_month = myDate.getMonth()+1;//当前月
	var q_date = c_year+"-"+c_month;
	var q_month=myDate.getMonth()+1;
// 	if(c_month>1){
// 		q_date = c_year+"-"+(c_month-1);
// 		q_month = c_month-1;
// 	}
	if(iscrmzbjs){
		window.parent.location=getRootPath() + "/crm/index_headquarters.html";
	}else if(iscrmgax){
		window.parent.location=getRootPath() + "/crm/index.html";
	}else if(iscrmdz){
		window.parent.location=getRootPath() + "/crm/current_shopkeeper.html";
	}else if(iscrmcszj){
		
		window.parent.location=getRootPath() + "/crm/index_headquarters.html?d="+encode64(c_month);
	}else if(iscrmqyjl){
		window.parent.location=getRootPath() + "/crm/manager_QYJL.html?q_date="+encode64(q_date);
	}else if(iscareergp){
		window.parent.location=getRootPath() + "/crm/index_BU.html";
	}else if(isfqzycareer){
		var open_url ="?employee_no="+encode64(currentUser.employeeId);
		window.parent.location=getRootPath() + "/crm/Service_user.html"+open_url;
	}else{
		//window.parent.location=getRootPath() + "/crm/index.html";
		var URL="?"+"employee_no="+encode64($("#employee_no").html());
		window.parent.location=getRootPath() + "/crm/user.html"+URL;
		/* layer.alert("暂无权限访问！ ",
				{
				
				id:'auth_crm',
			  	icon:4,
			  	closeBtn:0,
			  	skin: 'layer-ext-otherskin',
				move:false, 
			    title:'提示',
			    shadeClose:true,
			    offset:['100px','550px']
				}
		); */
	}
}


function toHr(){
	
	saveAccessLog(currentUser,'数据地图系统');
	
var default_system_val = $("#default_check")[0].checked;
	
	if(default_system_val){
		var defaultConfig ={
				default_system:2,
				employee_no:currentUser.employeeId,
				employee_name:currentUser.name
		}
		doManager("DefaultConfigManager", "saveOrUpdateDefaultConfig",[defaultConfig],
				function(data, textStatus, XMLHttpRequest) {
					if (data.result) {
						//城市地图系统  
						var c=0;
						if(iscrmcszj){c=1}//如果城市总监  传个标识1 
						window.parent.location=getRootPath() + "/aboutMap/data_index.html?c="+encode64(c);
					}
		},false);
	}else{
		var defaultConfig ={
				default_system:-1,
				employee_no:currentUser.employeeId,
				employee_name:currentUser.name
		}
		doManager("DefaultConfigManager", "saveOrUpdateDefaultConfig",[defaultConfig],
				function(data, textStatus, XMLHttpRequest) {
					if (data.result) {
						//城市地图系统  
						var c=0;
						if(iscrmcszj){c=1}//如果城市总监  传个标识1 
						window.parent.location=getRootPath() + "/aboutMap/data_index.html?c="+encode64(c);
					}
		},false);
		//城市地图系统  
		var c=0;
		if(iscrmcszj){c=1}//如果城市总监  传个标识1 
		window.parent.location=getRootPath() + "/aboutMap/data_index.html?c="+encode64(c);
	}
	
	
}

var sendboxid;
function initsendboxbutton(){
	var sendboxlogout = "<a href=\"javascript:logoutsendbox()\">退出沙箱</a>";
	var sendsign = currentUser.bpCode;
	if(sendsign!=null&&sendsign.indexOf("SENDBOX-")==0&&sendsign.length>8){
		sendboxid=sendsign.split('-')[1];
		$("#sendboxlogout").append(sendboxlogout);
		$(".subwrap").css("background","#EAEAEA");
	}else{
		$("#sendboxlogout").html("");
	}
}

function logoutsendbox(){
	currentUser=null;
	var reObj = new PMSRequestObject("userManager", "isValidUserBox", [ sendboxid,null ]);
    var callback = function callback(data, textStatus, XMLHttpRequest) {
    	window.parent.location=getRootPath() + "/crm/loginplatform.html";
	};
    var failureCallback = function failureCallback(data, textStatus, XMLHttpRequest) {
		alert("登录信息错误，请确认输入或联系管理员!");
		return false;
	}
    var url = "../login.do";
    $$.ajax(url, "requestString=" + reObj.toJsonString(), callback, failureCallback);
}


$(document).ready(function(){
 	initcurruser();//初始化登录人信息 
 	
 	isLogincrm();
 	
 	//initsendboxbutton();//初始化是否沙箱用户 
 	 $(".bgcolor-mr").hover(function(){
 	      $(this).find(".introduce-pop").stop().animate({top:'0'}, {duration: 500})
 	    },function(){

 	      $(this).find(".introduce-pop").stop().animate({top:'410'}, {duration: "fast"})
 	      $(this).find(".introduce-pop").animate({top:'410'}, {duration: 0})
 	    });

 	
 	
 	 var sysauth = currentUser.usergroup.sys_auth;
     var isManager = currentUser.usergroup.code;
     if(sysauth==null){
    	 sysauth = "";
    	 if(isManager=="GLY"){
    		 //第一次 是管理员 可访问数据 
    		 sysauth="dataSys";
    	 }
     }
    
	 $("#todaqweb").click(function(){
		if(sysauth.indexOf('dataSys')>-1){
			todaqWeb();
		}else{
			layer.alert("您没有此系统的使用权限！");
		}
    });
    
    $("#tocrm").click(function(){
   	 if(sysauth.indexOf('dataCrm')>-1){
		 	toCrm();
		 }else{
			layer.alert("您没有此系统的使用权限！");
		 }
    	
    });
    
    $("#tohr").click(function(){
   	 if(sysauth.indexOf('dataHr')>-1){
		    toHr();
		 }else{
			layer.alert("您没有此系统的使用权限！");
		 }
		  
    });

    $("#tofour").click(function(){
    	layer.alert("尚未开放，敬请期待。");
    	//开通功能后。需要添加 登录选择历史记录 调用  saveAccessLog(currentUser,'云表单系统');
   	 /* if(sysauth.indexOf('dataScore')>-1){
   		 	//开通后，更改此外 添加跳转连接 
   		 	layer.alert("您没有此系统的使用权限！");
		 }else{
			layer.alert("您没有此系统的使用权限！");
		 } */
    });
    
    $("#tofive").click(function(){
    	layer.alert("尚未开放，敬请期待。");
    	//开通功能后。需要添加 登录选择历史记录 调用  saveAccessLog(currentUser,'数据服务系统');
   	 /* if(sysauth.indexOf('dataService')>-1){
   			//开通后，更改此外 添加跳转连接 
   			layer.alert("您没有此系统的使用权限！");
		 }else{
			layer.alert("您没有此系统的使用权限！");
		 } */
    });
 	
	 	/*  $("#todaqweb").click(function(){
	     	todaqWeb();
	     });
	     
	     $("#tocrm").click(function(){
	     	toCrm();
	     });
	     
	     $("#tohr").click(function(){
	     	var groupcode = currentUser.usergroup.code;
	     	if(groupcode=="CSMDKQSPJSZ"){//考勤审批角色组 
	     		toHr();
	     	}else{
	     		layer.alert("您没有此系统的使用权限！");
	     	}
	     });
     
	     $("#tofour").click(function(){
	     	layer.alert("您没有此系统的使用权限！");
	     });
	     
	     $("#tofive").click(function(){
	     	layer.alert("您没有此系统的使用权限！");
	     }); */
	     
    saveLoginLog(currentUser); 
 	
});
  
  
  
 	  $(function () {
 	    $('.input1').iCheck({
 	      checkboxClass: 'icheckbox_square-green',
 	      radioClass: 'iradio_square-green',
 	      increaseArea: '20%' // optional
 	    });
 	    $('.input2').iCheck({
 	      checkboxClass: 'icheckbox_square-blue',
 	      radioClass: 'iradio_square-blue',
 	      increaseArea: '20%' // optional
 	    });
 	  });
    
    
  
  
  
  
  var currentUser;
	function initcurruser(){
		//取得当前登录人的门店
		doManager("UserManager", "getCurrentUserDTO",null,
  				function(data, textStatus, XMLHttpRequest) {
  					if (data.result) {
  						var curr_user = JSON.parse(data.data);
  						currentUser = curr_user;
  						//alert(curr_user.employeeId+""+curr_user.store_name+""+curr_user.name);
  						$('#username').html(curr_user.name);
  						$("#employee_no").html(curr_user.employeeId);
  						if(curr_user.code=="gasq"){
  							window.location=getRootPath() +  "/demo/index_headquarters_demo.html";
  							return;
  						}
  						 doManager("DefaultConfigManager", "getDefaultConfig",[curr_user.employeeId,curr_user.name],
  									function(data, textStatus, XMLHttpRequest) {
  										if (data.result) {
  											var defaultInfo = $.fromJSON(data.data);
  											if(defaultInfo!=null){
  												if(defaultInfo.default_system==0){//crm
  													/* $("#redio2").removeAttr("checked");
  													$("#redio1").attr("checked","checked"); */
  													//$("#default_check").attr("checked","checked");
  												}else if(defaultInfo.default_system==1){
  													/* $("#redio1").removeAttr("checked");
  													$("#redio2").attr("checked","checked"); */
  													//$("#default_check").attr("checked","checked");
  												}
  												
  												
  											}
  										}
  								},false);
  						 
  						var regex_zb = new RegExp("^(ZB|zb)\w*");//总部角色
  						if(regex_zb.test(curr_user.usergroup.code)){
  							iscrmzbjs = true;
  						}
  						if(curr_user.usergroup.code=="GLY"){
  							iscrmzbjs = true;
  						}
  						if(curr_user.usergroup.code=="DZ"){
							iscrmdz = true;
						}
						var regex_cs = new RegExp("^(CS|cs)\w*");//城市级别
// 						 if(curr_user.usergroup.code=="CSZJJSZ"||curr_user.usergroup.code=="CSZHGLZ"||curr_user.usergroup.code=="CSPTYYZ"||curr_user.usergroup.code=="CSMDGLZ"||curr_user.usergroup.code=="PTYYZXYCDDZ"||curr_user.usergroup.code=="MDKQSPJSZ"){
// 							iscrmcszj =true;
// 						 } 
						if(regex_cs.test(curr_user.usergroup.code)||curr_user.usergroup.code=="PTYYZXYCDDZ"){
							iscrmcszj =true;
						}
  						
  						if(curr_user.usergroup.code=="QYJL"){
  							iscrmqyjl=true;
  						}
  						
  						var regex_yw = new RegExp("^(YW|yw)\w*");//业务（事业部）
//   						if(curr_user.usergroup.code=="ZBJWSSYBJSZ"||curr_user.usergroup.code=="ZBLNZJSYBJSZ"||curr_user.usergroup.code=="ZBGAYYSYBJSZ"||curr_user.usergroup.code=="ZBGGSYBJSZ"||curr_user.usergroup.code=="ZBSYCXSYBJSZ"){
  							
//   							iscareergp=true;
//   						}
						if(regex_yw.test(curr_user.usergroup.code)){
							iscareergp=true;
						}
						
  						if(curr_user.usergroup.code=="ZHGLY"&&curr_user.zw=="服务专员"){
  							isfqzycareer = true;
  						}
  					}
  	},false);
	}
	
	
  function doLogout() {
		layer.confirm('确定退出？', {
			  	title:'提示',
			  	shadeClose:true,
			  	closeBtn:0,
			  	skin: 'layer-ext-otherskin',
			  	offset:['100px','550px'],
			  	move:false,
				btn: ['确定','取消'], //按钮
			}, function(){
				currentUser=null;
				urlStr = "../logout.do";
				window.location.href = urlStr;
			}, function(){
			  
			});
	}
  
  
  function openUpdatepassword(){
	  $("#password_update_div").show();
	  /* layer.open({
		  type: 1,
   		  title:  ['修改密码','color:#fff;background-color:#18bc9c'],
   		  shadeClose: true,
   		  shade:[0.1, '#393D49'],
   		  moveOut:false,
   		  skin: 'layer-ext-crmskin',
   		  area: ['400px','200px'],
   		  offset: ['200px','500px'],
   		  content:$("#password_update_div"),
   		  success:function(layer,index){
   			 
   		  },
   		  cancel: function(index, layero){ 
   			 layer.close(index);
   			}  
   		});   */
  }
  
  function updateUserPassword(){
	  var srcpassword= $("#srcpassword").val();
	  var newpassword = $("#newpassword").val();
	  var confirmpassword = $("#confirmpassword").val();
	 
	  if(srcpassword==null||srcpassword.trim()==""){
		  layer.msg('原密码不能为空！ ');
		  return false;
	  }
	  
  	var regu = /\w*[0-9]+\w*$/;
    var regu2 = /\w*[a-zA-Z]+\w*$/;
    var newPassword = newpassword.replace(/\s+/g,',');
    if (!regu.test(newPassword) || !regu2.test(newPassword)) {
        layer.msg("密码必须包含字母和数字！");
        $("#newpassword").focus();
        return false;
    }

    if($("#newpassword").val().length<8){
        layer.msg("密码必须要8个字符！");
        return false;
    }
	  
	  if(newpassword!=confirmpassword){
		  layer.msg('两次密码不一致，请重新填写！ ');
		  return false;
	  }
	  var obj = new Object();
	  obj.id=currentUser.id;
	  obj.blankPassword=srcpassword;//原密码 
	  obj.password=newpassword;//新密码 
	  if(currentUser!=null&&currentUser.id!=null){
		 doManager("UserManager", "modifyUserPassword",obj,
					function(data, textStatus, XMLHttpRequest) {
						if (data.result) {
							var defaultInfo = $.fromJSON(data.data);
							alert(defaultInfo);
							if(defaultInfo.indexOf('修改成功')>-1){
								urlStr = "../logout.do";
								window.location.href = urlStr;
							}
							
						}
		 },false);
		  
	  }
	  
  }
  
  
  function closeupdatediv(){
	  $("#srcpassword").val("");
	  $("#newpassword").val("");
	  $("#confirmpassword").val("");
	  $("#password_update_div").hide();
  }
  
  //刷新页面 保存 信息 
  function saveLoginLog(rtObj){
		var loguser={};
		loguser.citynames=returnCitySN.cname;
		loguser.loginip=returnCitySN.cip;
		loguser.token=rtObj.token;
		doManager("UserLoginLogManager","saveUserRefreshLog",[loguser], function(data, textStatus, XMLHttpRequest){
		}); 
	}
  
  
  //访问系统记录 保存 信息 
  function saveAccessLog(rtObj,sysName){
		var loguser={};
		loguser.citynames=returnCitySN.cname;
		loguser.loginip=returnCitySN.cip;
		loguser.token=rtObj.token;
		loguser.businessType=sysName;
		doManager("UserLoginLogManager","saveUserAccessLog",[loguser], function(data, textStatus, XMLHttpRequest){
		}); 
	}
  
  
  
</script>

 <style>
    section{width: 400px;margin-left: 35%;margin-top: 10%;z-index: 99999}
    .box{border: 0; font-size: 12px;}
    .box-header{background-color: #18bc9c; color: #fff;}
    .control-label{padding-left: 0; padding-right: 0;}
  </style>
  
</body>

  	 <section class="content-header" id="password_update_div" style="display: none; position: absolute;">
        <div class="box box-default">
          <div class="box-header">密码修改</div>
          <form class="form-horizontal">
          <div class="box-body">

            <div class="form-group">
              <label for="srcpassword" class="col-sm-2 control-label">原密码</label>

              <div class="col-sm-10">
                <input type="password" class="form-control" id="srcpassword" placeholder="原密码">
              </div>
            </div>
            <div class="form-group">
              <label for="newpassword" class="col-sm-2 control-label">新密码</label>

              <div class="col-sm-10">
                <input type="password" class="form-control" id="newpassword" placeholder="新密码">
              </div>
            </div>
            <div class="form-group">
              <label for="confirmpassword" class="col-sm-2 control-label">确认密码</label>

              <div class="col-sm-10">
                <input type="password" class="form-control" id="confirmpassword" placeholder="确认密码">
              </div>
            </div>
            <div style="text-align: right;">
              <button type="button" class="btn btn-default" onclick="updateUserPassword()">保存</button>
              <button type="button" class="btn btn-default" onclick="closeupdatediv()">取消</button>
            </div>

          </div>
          </form>
        </div>
        
      </section>

</html>
