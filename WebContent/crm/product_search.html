<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>商品搜索</title>
    <link rel="shortcut icon" type="image/x-icon" href="../icon.png" />
  <!-- Tell the browser to be responsive to screen width -->
<meta content="width=device-width, initial-scale=0.3, maximum-scale=1, user-scalable=yes" name="viewport">  <!-- Bootstrap 3.3.6 -->
  <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="bootstrap/css/font-awesome.min.css">
  <!-- Ionicons -->
  <link rel="stylesheet" href="bootstrap/css/ionicons.min.css">
  <!-- Morris charts -->
  <link rel="stylesheet" href="plugins/morris/morris.css">
  <!-- Theme style -->
  <link rel="stylesheet" href="dist/css/AdminLTE.min.css">
  <!-- AdminLTE Skins. Choose a skin from the css/skins
       folder instead of downloading all of them to reduce the load. -->
  <link rel="stylesheet" href="dist/css/skins/_all-skins.min.css">
  <link rel="stylesheet" href="plugins/daterangepicker/daterangepicker-bs3.css">
  <!-- Select2 -->
  <link rel="stylesheet" href="plugins/select2/select2.min.css">
  <link href="../scripts/css/auto.css" rel="stylesheet">
  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
  <script src="IE 9/html5shiv.min.js"></script>
  <script src="IE 9/respond.min.js"></script>
  <![endif]-->
  <style>
    .box-default{border-bottom: 1px solid #e1e1e1;}
    .info_head{padding: 25px 0 35px 0;}
    .info_head img{width:123px; margin-top:10px;}
    .info_head span{padding-left: 20px;}
    .info_bottom{padding: 35px 20px 0 35px; font-size: 12px;}
    .info_bottom .text-right span{padding: 6px 12px; margin:0 20px 0 3px; display: inline-block;}
    .box .h4{padding-left:20px;}
    .nav-tabs-custom{padding:0 20px;}
    .nav-tabs{border:0;}
    .logo-lg li{float: left; position: relative;}

    .logo-lg i{color: #fff;}
    .nav_dropdown{ position: absolute;z-index: 10000; top: 70px; left: -10px; line-height: 22px; padding: 15px 25px; background-color: #15b092; display: none;}
    .nav_dropdown li{padding: 5px 0; line-height: 20px; white-space: nowrap; font-size: 14px;}
    .logo-lg > ul > li:hover > a{color: #001f3f; font-weight: bold;}
    .logo-lg > ul > li:hover i{ transform: rotate(180deg); transition: all 0.3s linear; color: #001f3f;}
    
    
    .tcdPageCode{padding: 15px 20px;text-align: left;color: #ccc;text-align:center;}
	.tcdPageCode a{display: inline-block;color: #428bca;display: inline-block;height: 25px;	line-height: 25px;	padding: 0 10px;border: 1px solid #ddd;	margin: 0 2px;border-radius: 4px;vertical-align: middle;}
	.tcdPageCode a:hover{text-decoration: none;border: 1px solid #428bca;}
	.tcdPageCode span.current{display: inline-block;height: 25px;line-height: 25px;padding: 0 10px;margin: 0 2px;color: #fff;background-color: #428bca;	border: 1px solid #428bca;border-radius: 4px;vertical-align: middle;}
	.tcdPageCode span.disabled{	display: inline-block;height: 25px;line-height: 25px;padding: 0 10px;margin: 0 2px;	color: #bfbfbf;background: #f2f2f2;border: 1px solid #bfbfbf;border-radius: 4px;vertical-align: middle;}
 
	 #process_div{ 
			background-color:#292a2b; 
			display:inline; 
			z-index:100000;  
			left:0px; 
			opacity:0.3; top:0; left:0;height:100%; width:100%; z-index:999; position:fixed; _position:absolute; _left: expression_r(documentElement.scrollLeft + documentElement.clientWidth - this.offsetWidth); _top: expression_r(documentElement.scrollTop + documentElement.clientHeight - this.offsetHeight);
			filter:Alpha(Opacity=30); 
			opacity: 0.3; 
		} 
		
		#process_div_pic{
			position:fixed;
			top:50%;
			left:50%; 
			z-index:100000000; 
			margin:-16px 0 0 -50px; 
			width:100px; 
			height:32px;
			color: #fff;
		}
		
		/*搜索框*/
       .form-control{height: 30px; line-height: 30px; border-radius: 6px; padding: 3px 8px;}
       small span:hover{
    	color:#337ab7;
    	}
    	
    .demo-input{padding-left: 10px; height: 38px; min-width: 262px; line-height: 38px; border: 1px solid #e6e6e6;  background-color: #fff;  border-radius: 2px;}
  	.demo-footer{padding: 50px 0; color: #999; font-size: 14px;}
  	.demo-footer a{padding: 0 5px; color: #01AAED;}
    .auto{max-height:200px; overflow-y:scroll;border: 0px solid #dedede;}
  </style>
</head>
<body class="hold-transition skin-blue sidebar-mini">
<div id="process_div" style="display:none"></div>
<div id="process_div_pic" style="display:none"><img style="width:50px;height: 50px;" src="dist/img/376884043677306248.png"><i class="fa fa-refresh fa-spin"></i></div>
<!-- Site wrapper -->
<div class="wrapper">


 <header class="main-header">
    <nav class="navbar navbar-static-top">
      <div class="container">
					<div class="logo_img pull-left">
						<img src="dist/img/logo.png" height="30">
						<img src="dist/img/title.png" height="20">
					</div>
					<div class="pull-left">
						<div class="logo-lg">
							<ul class="no-margin">
								<li class="current"><em>商品搜索</em></li>
							</ul>
						</div>
					</div>
      </div>
    </nav>
  </header>
  
  <!-- =============================================== -->

  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
    <div class="container" style="width:1230px">
      <!-- Main content -->

      <section class="content-header">
        <div class="box box-default">
         	<div class="box-header h4 text-light-blue">
          	<div class="pull-left "><strong>商品搜索</strong></div>
         	<div class="pull-left text-red" style="padding-left:15px;font-size:75%">数据口径：</div>
         	<div class="pull-left text-red" style="font-size:75%">本页面仅供参考，若有什么想知道的而本页面未体现的，欢迎前来提意见，坐标，数据开发中心。</div>
          </div>
          <div class="box-body">
            <form id="searchform">
            <div class="form-group col-lg-3">
               <label>商品名称</label>
               <input type="text" class="form-control"  placeholder="商品名称" id="name_tradetype" style="display: inherit;width: 90%;border-radius: 6px;"/>
            </div>
            <div class="form-group col-lg-3">
                <label>城市</label>
                <select class="form-control select2" id="citySelect">
                </select>
            </div>
            <div class="form-group col-lg-3">
                <label>折扣</label>
                <select class="form-control select2" id="rate">
                    <option value=10>全部</option>
                    <option value=8>8折以下（含）</option>
                    <option value=5>5折以下（含）</option>
                    <option value=3>3折以下（含）</option>
                    <option value=1>1折以下（含）</option>
                </select>
            </div>
            </form>
            <div class="form-group col-lg-6" style="margin-top: 20px; padding: 0 25px;">
            </div>
            <div class="form-group col-lg-2" style="margin-top: 20px; padding: 0 25px;">
              <button type="button" class="btn btn-block btn-primary" onclick="searchInfo_tradeprofit_step1(1)">查询</button>
            </div>
            <div class="col-lg-2" style="margin-top: 20px; padding: 0 25px;">
              <button type="button" onclick="export_tradetype()" class="btn btn-block btn-warning">导出</button>
            </div>
            <div class="col-lg-2" style="margin-top: 20px; padding: 0 25px;">
              <button type="button" onclick="resetSerachParam()" style="border-color:#00a65a;background-color:#00a652;color:white" class="btn btn-block">重置</button>
            </div>

          </div>
          <div class="box-body">
            <div class="nav-tabs-custom">
              <div class="tab-content">
                <div>
                  <table class="table table-striped">
                    <tbody id="tradeType_tbody">
	                    <tr>
	                      <th width="15%">商品名称</th>
	                      <th width="15%">门店名称</th>
                          <th width="20%">门店地址</th>
                          <th width="10%">原价<br/></th>
                          <th width="10%">社员价<br/></th>
                          <th width="10%">库存<br/></th>
                          <th width="10%">折扣<br/></th>
	                    </tr>
                    </tbody>
                  </table>
                </div>
                <!-- /.tab-pane -->
              </div>
              
              <!-- /.tab-content -->
            </div>
            <div class="tcdPageCode" id="page_tradetype"></div>
          </div>
        </div>
      </section>
    </div>
  </div>
  <!-- /.content-wrapper -->
</div>

<!-- ./wrapper -->
<!-- jQuery 2.2.0 -->
<script src="plugins/jQuery/jQuery-2.2.0.min.js"></script>
<script type="text/javascript" src="laydate/laydate.js"></script>
<!-- Bootstrap 3.3.6 -->
<script src="bootstrap/js/bootstrap.min.js"></script>
<!-- Morris.js charts -->
<script src="bootstrap/js/raphael-min.js"></script>
<script src="plugins/morris/morris.min.js"></script>
<!-- FastClick -->
<script src="plugins/fastclick/fastclick.js"></script>
<!-- AdminLTE App -->
<script src="dist/js/app.min.js"></script>
<!-- AdminLTE for demo purposes -->
<script src="dist/js/demo.js"></script>

<!-- page script -->
<script type="text/javascript" src="plugins/jquery.page.js"></script>
<script type="text/javascript" src="plugins/moment.min.js"></script>
<script src="plugins/daterangepicker/daterangepicker.js"></script>

<script type="text/javascript" src="../scripts/bidLibjsjquery3.0.js"></script>
<script type="text/javascript" src="../scripts/auto.js"></script> 
 

<script type="text/javascript">
<!--target(数据查询层级标识) 0：总部  1:城市级别 2：门店-->
	layer.config({
	
	  extend: 'skin/crmskin/style.css' //加载新皮肤
	  
	});
    /*默认显示上个月的日期*/
    var cur_date = new Date();
    var now_month =cur_date.getMonth();
    var max_year = cur_date.getFullYear();
    var now_date =cur_date.getDate();
    var max_month = "";
    var year_month = max_year+"-"+(now_month+1)+"-"+now_date;
    if(now_month>0&&now_month<10){
        max_month = "0"+now_month;
        if(now_month<9){
            now_month ="0"+(now_month+1);
        }else{
            now_month = now_month+1;
        }
    }else{
        if(now_month==0){
            max_year =cur_date.getFullYear()-1;
            max_month = "12";
            now_month = now_month+1;
        }else{
            max_month = now_month;
            now_month = now_month+1;
        }

    }
    var last_month_date = max_year+"-"+max_month;
    var max_date = "";
    var max_month1 =max_month;
    var max_month =max_year+"-"+max_month +"-"+(cur_date.getDate());
    if(now_date==1){
        if(now_month==4||now_month==6||now_month==9||now_month==11){
            now_date =30;
        }else
        if(max_year%4==0&&now_month==2){
            now_date=29;
        }else{
            now_date=31;
        }
        if(max_month=="12"){
            max_date = max_year+"-"+now_month +"-"+now_date;

        }else{
            max_date = cur_date.getFullYear()+"-"+now_month +"-"+now_date;
        }
    }else{
        max_date = cur_date.getFullYear()+"-"+now_month +"-"+(now_date-1);
    }
    laydate.render({//月份控件
        elem:'#be_date1',
        value:last_month_date,
        type:"month",
        btns: ['confirm','now'],
        theme: '#11214e',
        min: '2018-10-1',
        max:year_month,
    });
	
	var cityId = decode64(getUrlParamByKey("c"));//城市ID
	var initCity = cityId;
	var cityName = decode64(getUrlParamByKey("cn"));//城市名称
	var employeeId = decode64(getUrlParamByKey("e"));//员工编号/id
	var storeId = decode64(getUrlParamByKey("s"));//门店编号
	var target = decode64(getUrlParamByKey("t"));//target 0：总部  1:城市级别 2：门店
	var storeName=decode64(getUrlParamByKey("sn"));
	var storeNo=decode64(getUrlParamByKey("so"));
	var role = decode64(getUrlParamByKey("r"));
    var screenlogin=getUrlParamByKey("su");
	$(function () {
        loginShow();
        initallcity();
        $("#citySelect option[value='0010']").attr('selected',true);
        $("#rate option[value='5']").attr('selected',true);
  });

    function loginShow(){
        if(screenlogin!=null&&screenlogin!=''&&screenlogin!=undefined){
            var b = new Base64();
            screenlogin=b.decode(screenlogin);
            var obj=JSON.parse(screenlogin);
            var reObj = new PMSRequestObject("userManager", "isAppScreenUser", [obj.code,obj.employeeId,obj.password]);
            var callback = function callback(data, textStatus, XMLHttpRequest) {
                localStorage.clear();
                window.parent.location=getRootPath() + "/crm/product_search.html";
            };
            var failureCallback = function failureCallback(data, textStatus, XMLHttpRequest) {
                alert("登录信息错误，请确认输入或联系管理员!");
                return false;
            }
            var url = "../login.do";
            $$.ajax(url, "requestString=" + reObj.toJsonString(), callback, failureCallback);
        }
    }

    function initallcity(){
        doManager("DistCityCodeManager","queryAllDistCityList",null,
            function(data,textStatus,XmlHttpRequest){
                if (data.result) {
                    var jsonData = $.fromJSON(data.data);
                    $("#citySelect").append("<option value=''>全部城市</option>");
                    $(jsonData).each(function(index,element){
                        $("#citySelect").append('<option value="'+element.cityno+'">'+element.cityname+'</option>');
                    });
                }
            },false);
    }

    <!-------------------------------------------------------点击查询----------------------------------------------------------------->
   
    var isCreatePage1=false;
    function searchInfo_tradeprofit_step1(cur_page){
    	isCreatePage1=false;
  		searchInfo_tradeprofit_step2(cur_page);
  	}
    
    //查询上
    var currentPage_tradetype = 1;
    var totalPage_tradetype = 1;
    var recordsPerPage_tradetype = 20;
    function   searchInfo_tradeprofit_step2(cur_page){
    	var begin_end_date = $("#be_date1").val();
    	if(begin_end_date==""){
      		 crm_alert(0,"请选择时间！");
      		 return;
      	}

    	searchInfo_tradeprofit_step3(cur_page,begin_end_date);
    }
      
    function searchInfo_tradeprofit_step3(cur_page,begin_end_date){
    	$("#process_div").show();
   	 	$("#process_div_pic").show();
        var name = $("#name_tradetype").val();
        var cityName = $("#citySelect  option:selected").val();
        var rate = $("#rate").val();
        var dynamicDto=null;
        dynamicDto = {
            searchstr:name,
            cityName:cityName,
            target:rate
        }
 	    var pageInfo = new Object();
 	    pageInfo.currentPage = cur_page;
 	    pageInfo.recordsPerPage = recordsPerPage_tradetype;
	    doManager('productSearchManager','queryProductList',[dynamicDto,pageInfo],function(data){
           if(data.result){
               var result= JSON.parse(data.data);
	           if(result.status=='success'){
	        	   $("#tradeType_tbody").find("tr:gt(0)").remove();
	        	   var jData = result.data;
	        	   if(jData==null||jData.length==0){
	        		   crm_alert(5,"没有符合条件的数据！");
	        		   $("#page_tradetype").createPage({
	        	 	  	    pageCount:0,
	        	 	  	    current:0,
	        	 	  	    backFn:function(p){
	        	 	  	    	
	        	 	  	    }
	        	 	  	});
	        		   $("#process_div").hide();
	        	       $("#process_div_pic").hide();
	        		   return;
	        	   }
	        	   totalPage_tradetype = result.total_pages;
	        	  
	        	   if(!isCreatePage1){
	        		   $("#page_tradetype").createPage({
	   	       	  	    pageCount:totalPage_tradetype,
	   	       	  	    current:cur_page,
	   	       	  	    backFn:function(p){
                            searchInfo_tradeprofit_step3(p,begin_end_date);
	   	       	  	    }
	   	       	  	  });
	        		   isCreatePage1=true;
	        	   }
	        	   
	        	   var infoStr="";
	        	   for(var i=0;i<jData.length;i++){
	        		   infoStr= "<tr>"
		                       +"<td>"+jData[i].content_name+"</td>"
		                       +"<td>"+jData[i].name+"</td>"
                               +"<td>"+jData[i].address+"</td>"
                               +"<td>"+jData[i].content_price.toFixed(2)+"</td>"
                               +"<td><font color=\"red\">"+jData[i].member_price.toFixed(2)+"</font></td>"
                               +"<td>"+jData[i].pro_number+"</td>";
                       if(jData[i].member_price==jData[i].content_price && jData[i].member_price!=0.00){
                           infoStr = infoStr +"<td>不打折</td>"
                       }else{
                           infoStr = infoStr +"<td>"+jData[i].rate.toFixed(1)+"折</td>";
                       }
                       infoStr = infoStr + +"</tr>";
		               $("#tradeType_tbody").append(infoStr);
	        	   }
	           }else{
	        	   crm_alert(5,"请稍后重新请求！");
	        	   $("#process_div").hide();
        	       $("#process_div_pic").hide();
	        	   return;
	           }
           
           }else{
        	   crm_alert(5,"请稍后重新请求！");
           }
          $("#process_div").hide();
     	  $("#process_div_pic").hide();
       }); 
    }
    
    //导出上
    function   export_tradetype(){
    	var begin_end_date = $("#be_date1").val();
    	if(begin_end_date==""){
     		 crm_alert(0,"请选择时间！");
     		 return;
     	}
		var cur_page;

        
      export_tradetype1(begin_end_date);
     

   }
    //导出上第二步
    function export_tradetype1(begin_end_date){
    	$("#process_div").show();
  	 	$("#process_div_pic").show();
        var name = $("#name_tradetype").val();
        var cityName = $("#citySelect  option:selected").val();
        var rate = $("#rate").val();
        var dynamicDto=null;
        dynamicDto = {
            searchstr:name,
            cityName:cityName,
            target:rate
        }
	    doManager('productSearchManager','exportProductList',[dynamicDto],function(data){
          if(data.result){
          	   var result= JSON.parse(data.data);
	           if(result.status=='success'){
	        	   window.location.href=result.data;
	           }else if(result.status=='null'){
	        	   crm_alert(0,"请先确认是否有符合条件的数据，重新请求！");
	        	   $("#process_div").hide();
        	       $("#process_div_pic").hide();
	        	   return;
	           }else{
	        	   crm_alert(5,"请稍后重新请求！");
	        	   $("#process_div").hide();
        	       $("#process_div_pic").hide();
	           }
          
          }else{
       	   crm_alert(5,"请稍后重新请求！");
          }
         $("#process_div").hide();
    	 $("#process_div_pic").hide();
      }); 
    }
    
function resetSerachParam(){
    laydate.render({//月份控件
        elem:'#be_date1',
        value:last_month_date,
        type:"month",
        btns: ['confirm','now'],
        theme: '#11214e',
        min: '2018-10-1',
        max:year_month,
    });
    $("#name_tradetype").val("");
}
   
</script>

</body>
</html>